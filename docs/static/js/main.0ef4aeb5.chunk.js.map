{"version":3,"sources":["three/libs/fflate.module.js","three/loaders/FBXLoader.js","three/curves/NURBSUtils.js","three/curves/NURBSCurve.js","scenes/sabor.js","three/controls/OrbitControls.js","components/saborScene.js","App.js","reportWebVitals.js","index.js"],"names":["ch2","durl","c","URL","createObjectURL","Blob","type","cwk","u","Worker","revokeObjectURL","e","encodeURI","u8","Uint8Array","u16","Uint16Array","u32","Uint32Array","fleb","fdeb","clim","freb","eb","start","b","i","r","j","_a","fl","revfl","_b","fd","revfd","rev","x","hMap","cd","mb","s","length","l","co","le","rvb","sv","r_1","v","m","flt","fdt","flm","flrm","fdm","fdrm","max","a","bits","d","p","o","bits16","shft","slc","n","set","subarray","inflt","dat","buf","st","sl","noBuf","noSt","cbuf","bl","nbuf","Math","final","f","pos","bt","lm","dm","lbt","dbt","tbts","t","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","lt","dt","lms","dms","lpos","sym","add","dsym","end","wbits","wbits16","hTree","push","t2","slice","et","sort","i0","i1","i2","maxSym","tr","mbt","ln","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","w","clen","cf","wfblk","out","wblk","syms","lf","df","li","bs","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","ll","dl","flen","ftlen","dtlen","llm","lcts","it","clct","len","dst","deo","dflt","lvl","plvl","pre","post","lst","ceil","opt","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","min","maxd","ml","nl","mmd","md","ti","lin","din","crct","k","crc","cr","adler","dopt","level","mem","log","mrg","wcln","fn","fnStr","td","toString","ks","indexOf","lastIndexOf","replace","split","st_1","prototype","spInd","ch","wrkr","fns","init","id","cb","td_1","msg","transfer","onerror","error","onmessage","data","postMessage","wk","constructor","buffer","cbfs","bInflt","inflateSync","pbf","gu8","bDflt","deflateSync","gze","gzh","gzhl","wbytes","guze","gzs","gzl","zle","zlh","zule","zlv","size","cbify","opts","err","terminate","consume","astrm","strm","ondata","ev","astrmify","call","b2","b4","b8","filename","mtime","floor","Date","now","charCodeAt","flg","zs","lv","AsyncCmpStrm","this","Deflate","chunk","AsyncDeflate","deflate","Inflate","bts","AsyncInflate","inflate","Gzip","raw","AsyncGzip","gzip","gzipSync","Gunzip","AsyncGunzip","gunzip","gunzipSync","Zlib","AsyncZlib","zlib","zlibSync","Unzlib","AsyncUnzlib","unzlib","unzlibSync","Decompress","G","I","Z","_this_1","apply","arguments","AsyncDecompress","decompress","decompressSync","fltn","val","Array","isArray","te","TextEncoder","TextDecoder","tds","decode","stream","dutf8","String","fromCharCode","DecodeUTF8","np","EncodeUTF8","strToU8","str","latin1","ar_1","encode","ar","ai","strFromU8","dbf","slzh","zh","z","fnl","es","z64e","sc","su","off","exfl","ex","wzh","ce","extra","col","exl","os","flag","compression","y","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","attrs","exf","wzf","ZipPassThrough","process","ZipDeflate","AsyncZipDeflate","Zip","file","com","comment","hl","header","chks","pAll","_i","chks_1","chk","ind","uf","nxt","dd","splice","zip","Object","keys","tot","slft","files","term","tAll","cbf","oe","cdl","badd","loc","_loop_1","ms","cbl","zipSync","UnzipPassThrough","UnzipInflate","AsyncUnzipInflate","_","sz","Unzip","onfile","toAdd","is","oc","_loop_2","sig","this_1","bf","cmp_1","chks_2","unshift","d_1","sc_1","su_1","fn_1","file_1","name","ctr","chks_3","originalSize","register","decoder","unzip","_loop_3","c_1","no","infl","unzipSync","c_2","fbxTree","connections","sceneGraph","NURBSUtils","U","low","high","mid","span","N","left","right","saved","rv","temp","P","findSpan","calcBasisFunctions","C","Vector4","point","Nj","wNj","zeroArr","ders","ndu","s1","s2","rk","pk","j2","nd","du","CK","nders","calcBasisFunctionDerivatives","Pw","clone","multiplyScalar","nom","denom","Pders","Aders","wders","Vector3","sub","calcKoverI","divideScalar","calcBSplineDerivatives","calcRationalCurveDerivatives","q","V","target","uspan","vspan","Nu","Nv","Sw","NURBSCurve","degree","knots","controlPoints","startKnot","endKnot","optionalTarget","hpoint","calcBSplinePoint","tangent","calcNURBSDerivatives","copy","normalize","Curve","FBXLoader","manager","url","onLoad","onProgress","onError","scope","path","LoaderUtils","extractUrlBase","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","load","parse","console","itemError","FBXBuffer","CORRECT","byteLength","convertArrayBufferToString","isFbxFormatBinary","BinaryParser","FBXText","text","cursor","read","offset","result","isFbxFormatASCII","Error","getFbxVersion","TextParser","textureLoader","TextureLoader","resourcePath","setCrossOrigin","crossOrigin","FBXTreeParser","Loader","parseConnections","images","parseImages","textures","parseTextures","materials","parseMaterials","deformers","parseDeformers","geometryMap","GeometryParser","parseScene","connectionMap","Map","Connections","forEach","rawConnection","fromID","toID","relationship","has","parents","children","parentRelationship","ID","get","childRelationship","blobs","Objects","videoNodes","Video","nodeID","videoNode","parseInt","RelativeFilename","Filename","arrayBufferContent","Content","ArrayBuffer","base64Content","image","parseImage","undefined","pop","content","fileName","extension","toLowerCase","getHandler","warn","array","window","textureMap","textureNodes","Texture","texture","parseTexture","textureNode","loadTexture","attrName","wrapModeU","WrapModeU","wrapModeV","WrapModeV","valueU","value","valueV","wrapS","RepeatWrapping","ClampToEdgeWrapping","wrapT","values","Scaling","repeat","currentPath","FileName","materialMap","materialNodes","Material","material","parseMaterial","materialNode","ShadingModel","parameters","parseParameters","MeshPhongMaterial","MeshLambertMaterial","setValues","BumpFactor","bumpScale","Diffuse","color","Color","fromArray","DiffuseColor","DisplacementFactor","displacementScale","Emissive","emissive","EmissiveColor","EmissiveFactor","emissiveIntensity","parseFloat","Opacity","opacity","transparent","ReflectionFactor","reflectivity","Shininess","shininess","Specular","specular","SpecularColor","child","bumpMap","getTexture","aoMap","map","encoding","sRGBEncoding","displacementMap","emissiveMap","normalMap","envMap","mapping","EquirectangularReflectionMapping","specularMap","alphaMap","LayeredTexture","skeletons","morphTargets","DeformerNodes","Deformer","deformerNode","relationships","attrType","skeleton","parseSkeleton","geometryID","morphTarget","rawTargets","parseMorphTargets","deformerNodes","rawBones","boneNode","rawBone","indices","weights","transformLink","Matrix4","TransformLink","Indexes","Weights","bones","rawMorphTargets","morphTargetNode","rawMorphTarget","initialWeight","DeformPercent","fullWeights","FullWeights","geoID","filter","Group","modelMap","parseModels","modelNodes","Model","model","modelNode","setLookAtProperties","connection","parent","bindSkeleton","createAmbientLight","traverse","node","userData","transformData","parentMatrix","matrix","parentMatrixWorld","matrixWorld","transform","generateTransform","applyMatrix4","updateWorldMatrix","animations","AnimationParser","isGroup","buildSkeleton","createCamera","createLight","createMesh","createCurve","Bone","PropertyBinding","sanitizeNodeName","getTransformData","bone","subBone","cameraAttribute","attr","NodeAttribute","Object3D","CameraProjectionType","nearClippingPlane","NearPlane","farClippingPlane","FarPlane","width","innerWidth","height","innerHeight","AspectWidth","AspectHeight","aspect","fov","FieldOfView","focalLength","FocalLength","PerspectiveCamera","setFocalLength","OrthographicCamera","lightAttribute","LightType","intensity","Intensity","CastLightOnObject","distance","FarAttenuationEnd","EnableFarAttenuation","PointLight","DirectionalLight","angle","PI","InnerAngle","MathUtils","degToRad","penumbra","OuterAngle","SpotLight","CastShadows","castShadow","geometry","attributes","vertexColors","FBX_Deformer","SkinnedMesh","normalizeSkinWeights","Mesh","reduce","geo","LineBasicMaterial","linewidth","Line","inheritType","InheritType","eulerOrder","getEulerOrder","RotationOrder","translation","Lcl_Translation","preRotation","PreRotation","rotation","Lcl_Rotation","postRotation","PostRotation","scale","Lcl_Scaling","scalingOffset","ScalingOffset","scalingPivot","ScalingPivot","rotationOffset","RotationOffset","rotationPivot","RotationPivot","lookAtTarget","position","lookAt","bindMatrices","parsePoseNodes","geoConnParent","bind","Skeleton","BindPoseNode","Pose","poseNodes","PoseNode","poseNode","Node","Matrix","GlobalSettings","ambientColor","AmbientColor","g","AmbientLight","geoNodes","Geometry","parseGeometry","geoNode","parseMeshGeometry","parseNurbsGeometry","GeometricTranslation","GeometricRotation","GeometricScaling","genGeometry","preTransform","BufferGeometry","geoInfo","parseGeoNode","buffers","genBuffers","positionAttribute","Float32BufferAttribute","vertex","setAttribute","colors","Uint16BufferAttribute","weightsIndices","vertexWeights","normal","normalMatrix","Matrix3","getNormalMatrix","normalAttribute","applyNormalMatrix","uvs","uvBuffer","mappingType","prevMaterialIndex","materialIndex","startIndex","currentIndex","addGroup","groups","lastGroup","lastIndex","count","addMorphTargets","vertexPositions","Vertices","vertexIndices","PolygonVertexIndex","LayerElementColor","parseVertexColors","LayerElementMaterial","parseMaterialIndices","LayerElementNormal","parseNormals","LayerElementUV","uv","UV","parseUVs","weightTable","index","weight","polygonIndex","faceLength","displayedWeightsWarning","facePositionIndexes","faceNormals","faceColors","faceUVs","faceWeights","faceWeightIndices","vertexIndex","polygonVertexIndex","endOfFace","weightIndices","getData","wt","wIndex","Weight","weightIndex","currentWeight","comparedWeight","comparedWeightIndex","comparedWeightArray","tmp","genFace","parentGeo","parentGeoNode","morphTargetsRelative","morphAttributes","rawTarget","morphGeoNode","genMorphGeometry","morphPositionsSparse","morphPositions","Float32Array","morphIndex","morphGeoInfo","morphBuffers","NormalNode","MappingInformationType","referenceType","ReferenceInformationType","Normals","indexBuffer","NormalIndex","NormalsIndex","dataSize","UVNode","UVIndex","ColorNode","Colors","ColorIndex","MaterialNode","materialIndexBuffer","Materials","materialIndices","order","Order","isNaN","KnotVector","pointsValues","Points","Form","points","getPoints","setFromPoints","animationClips","rawClips","parseClips","key","rawClip","clip","addClip","AnimationCurve","curveNodesMap","parseAnimationCurveNodes","parseAnimationCurves","layersMap","parseAnimationLayers","parseAnimStacks","rawCurveNodes","AnimationCurveNode","rawCurveNode","match","curveNode","curves","rawCurves","animationCurve","times","KeyTime","convertFBXTimeToSeconds","KeyValueFloat","animationCurveID","animationCurveRelationship","rawLayers","AnimationLayer","layerCurveNodes","modelID","rawModel","modelName","initialPosition","initialRotation","initialScale","morph","deformerID","morpherID","morphName","rawStacks","AnimationStack","layer","tracks","rawTracks","concat","generateTracks","AnimationClip","Quaternion","decompose","toArray","Euler","setFromQuaternion","T","positionTrack","generateVectorTrack","R","rotationTrack","generateRotationTrack","S","scaleTrack","morphTrack","generateMorphTrack","initialValue","getTimesForAllAxes","getKeyframeTrackValues","VectorKeyframeTrack","interpolateRotations","setFromEuler","invert","quaternion","euler","quaternionValues","premultiply","multiply","QuaternionKeyframeTrack","morphNum","getObjectByName","morphTargetDictionary","NumberKeyframeTrack","targetIndex","lastValue","currentValue","prevValue","xIndex","yIndex","zIndex","time","xValue","yValue","zValue","curve","valuesSpan","absoluteSpan","abs","numSubIntervals","step","nextValue","initialTime","interval","nextTime","interpolatedTimes","interpolatedValues","inject","nodeStack","currentIndent","currentProp","currentPropName","allNodes","FBXTree","line","matchComment","matchEmpty","matchBeginning","matchProperty","matchEnd","parseNodeBegin","parseNodeProperty","popStack","parseNodePropertyContinued","property","nodeName","trim","nodeAttrs","parseNodeAttr","currentNode","getCurrentNode","pushStack","contentLine","propName","propValue","connProps","from","to","rest","append","elem","setCurrentProp","parseNumberArray","parseNodeSpecialProperty","props","prop","innerPropName","innerPropType1","innerPropType2","innerPropFlag","innerPropValue","getPrevNode","reader","BinaryReader","skip","version","getUint32","endOfContent","parseNode","getOffset","endOffset","getUint64","numProperties","nameLen","getUint8","getString","propertyList","parseProperty","singleProperty","subNode","parseSubNode","getBoolean","getFloat64","getFloat32","getInt32","getInt64","getArrayBuffer","getInt16","arrayLength","compressedLength","getBooleanArray","getFloat64Array","getFloat32Array","getInt32Array","getInt64Array","fflate","reader2","littleEndian","dv","DataView","nullByte","decodeText","dataArray","infoObject","tempEuler","tempVec","lTranslationM","lPreRotationM","lRotationM","lPostRotationM","lScalingM","lScalingPivotM","lScalingOffsetM","lRotationOffsetM","lRotationPivotM","lParentGX","lParentLX","lGlobalT","setPosition","makeRotationFromEuler","lLRM","lParentGRM","extractRotation","lParentTM","copyPosition","lParentGRSM","lParentGSM","lLSM","lGlobalRS","lParentLSM_inv","setFromMatrixScale","lParentGSM_noLocal","lRotationPivotM_inv","lScalingPivotM_inv","lTransform","lLocalTWithAllPivotAndOffsetInfo","lGlobalTranslation","enums","a1","a2","camera","scene","renderer","mixer","_changeEvent","_startEvent","_endEvent","OrbitControls","object","domElement","document","style","touchAction","enabled","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","position0","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","getDistance","distanceTo","listenToKeyEvents","addEventListener","onKeyDown","saveState","reset","updateProjectionMatrix","dispatchEvent","update","state","STATE","NONE","quat","setFromUnitVectors","up","quatInverse","lastPosition","lastQuaternion","twoPI","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","isFinite","makeSafe","radius","addScaledVector","panOffset","setFromSpherical","zoomChanged","distanceToSquared","EPS","dot","dispose","removeEventListener","onContextMenu","onPointerDown","onPointerCancel","onMouseWheel","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","pointers","pointerPositions","getZoomScale","pow","rotateUp","panLeft","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","clientHeight","isOrthographicCamera","clientWidth","top","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","event","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","getSecondPointerPosition","subVectors","handleTouchMovePan","handleTouchMoveDolly","setPointerCapture","pointerId","addPointer","pointerType","trackPointer","DOLLY_ROTATE","onTouchStart","mouseAction","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","onTouchMove","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","removePointer","releasePointerCapture","preventDefault","handleMouseWheel","needsUpdate","code","handleKeyDown","pointer","passive","EventDispatcher","clock","THREE","onWindowResize","setSize","animate","requestAnimationFrame","delta","getDelta","render","Container","styled","div","Canvas","canvas","SaborSceneComponent","getElementById","h","background","fog","hemiLight","dirLight","shadow","mesh","depthWrite","receiveShadow","grid","clipAction","play","isMesh","antialias","setPixelRatio","devicePixelRatio","shadowMap","controls","Component","SaborScene","App","className","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.0ef4aeb5.chunk.js","sourcesContent":["/*!\r\nfflate - fast JavaScript compression/decompression\r\n<https://101arrowz.github.io/fflate>\r\nLicensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE\r\nversion 0.6.9\r\n*/\r\n\r\n// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\r\n// https://tools.ietf.org/html/rfc1951\r\n// You may also wish to take a look at the guide I made about this program:\r\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\r\n// Some of the following code is similar to that of UZIP.js:\r\n// https://github.com/photopea/UZIP.js\r\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\r\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\r\n// is better for memory in most engines (I *think*).\r\nvar ch2 = {};\r\nvar durl = function (c) { return URL.createObjectURL(new Blob([c], { type: 'text/javascript' })); };\r\nvar cwk = function (u) { return new Worker(u); };\r\ntry {\r\n    URL.revokeObjectURL(durl(''));\r\n}\r\ncatch (e) {\r\n    // We're in Deno or a very old browser\r\n    durl = function (c) { return 'data:application/javascript;charset=UTF-8,' + encodeURI(c); };\r\n    // If Deno, this is necessary; if not, this changes nothing\r\n    cwk = function (u) { return new Worker(u, { type: 'module' }); };\r\n}\r\nvar wk = (function (c, id, msg, transfer, cb) {\r\n    var w = cwk(ch2[id] || (ch2[id] = durl(c)));\r\n    w.onerror = function (e) { return cb(e.error, null); };\r\n    w.onmessage = function (e) { return cb(null, e.data); };\r\n    w.postMessage(msg, transfer);\r\n    return w;\r\n});\r\n\r\n// aliases for shorter compressed code (most minifers don't do this)\r\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\r\n// fixed length extra bits\r\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\r\n// fixed distance extra bits\r\n// see fleb note\r\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\r\n// code length index map\r\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\r\n// get base, reverse index map from extra bits\r\nvar freb = function (eb, start) {\r\n    var b = new u16(31);\r\n    for (var i = 0; i < 31; ++i) {\r\n        b[i] = start += 1 << eb[i - 1];\r\n    }\r\n    // numbers here are at max 18 bits\r\n    var r = new u32(b[30]);\r\n    for (var i = 1; i < 30; ++i) {\r\n        for (var j = b[i]; j < b[i + 1]; ++j) {\r\n            r[j] = ((j - b[i]) << 5) | i;\r\n        }\r\n    }\r\n    return [b, r];\r\n};\r\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\r\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\r\nfl[28] = 258, revfl[258] = 28;\r\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\r\n// map of value to reverse (assuming 16 bits)\r\nvar rev = new u16(32768);\r\nfor (var i = 0; i < 32768; ++i) {\r\n    // reverse table algorithm from SO\r\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\r\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\r\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\r\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\r\n}\r\n// create huffman tree from u8 \"map\": index -> code length for code index\r\n// mb (max bits) must be at most 15\r\n// TODO: optimize/split up?\r\nvar hMap = (function (cd, mb, r) {\r\n    var s = cd.length;\r\n    // index\r\n    var i = 0;\r\n    // u16 \"map\": index -> # of codes with bit length = index\r\n    var l = new u16(mb);\r\n    // length of cd must be 288 (total # of codes)\r\n    for (; i < s; ++i)\r\n        ++l[cd[i] - 1];\r\n    // u16 \"map\": index -> minimum code for bit length = index\r\n    var le = new u16(mb);\r\n    for (i = 0; i < mb; ++i) {\r\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\r\n    }\r\n    var co;\r\n    if (r) {\r\n        // u16 \"map\": index -> number of actual bits, symbol for code\r\n        co = new u16(1 << mb);\r\n        // bits to remove for reverser\r\n        var rvb = 15 - mb;\r\n        for (i = 0; i < s; ++i) {\r\n            // ignore 0 lengths\r\n            if (cd[i]) {\r\n                // num encoding both symbol and bits read\r\n                var sv = (i << 4) | cd[i];\r\n                // free bits\r\n                var r_1 = mb - cd[i];\r\n                // start value\r\n                var v = le[cd[i] - 1]++ << r_1;\r\n                // m is end value\r\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\r\n                    // every 16 bit value starting with the code yields the same result\r\n                    co[rev[v] >>> rvb] = sv;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        co = new u16(s);\r\n        for (i = 0; i < s; ++i) {\r\n            if (cd[i]) {\r\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\r\n            }\r\n        }\r\n    }\r\n    return co;\r\n});\r\n// fixed length tree\r\nvar flt = new u8(288);\r\nfor (var i = 0; i < 144; ++i)\r\n    flt[i] = 8;\r\nfor (var i = 144; i < 256; ++i)\r\n    flt[i] = 9;\r\nfor (var i = 256; i < 280; ++i)\r\n    flt[i] = 7;\r\nfor (var i = 280; i < 288; ++i)\r\n    flt[i] = 8;\r\n// fixed distance tree\r\nvar fdt = new u8(32);\r\nfor (var i = 0; i < 32; ++i)\r\n    fdt[i] = 5;\r\n// fixed length map\r\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\r\n// fixed distance map\r\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\r\n// find max of array\r\nvar max = function (a) {\r\n    var m = a[0];\r\n    for (var i = 1; i < a.length; ++i) {\r\n        if (a[i] > m)\r\n            m = a[i];\r\n    }\r\n    return m;\r\n};\r\n// read d, starting at bit p and mask with m\r\nvar bits = function (d, p, m) {\r\n    var o = (p / 8) | 0;\r\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\r\n};\r\n// read d, starting at bit p continuing for at least 16 bits\r\nvar bits16 = function (d, p) {\r\n    var o = (p / 8) | 0;\r\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\r\n};\r\n// get end of byte\r\nvar shft = function (p) { return ((p / 8) | 0) + (p & 7 && 1); };\r\n// typed array slice - allows garbage collector to free original reference,\r\n// while being more compatible than .slice\r\nvar slc = function (v, s, e) {\r\n    if (s == null || s < 0)\r\n        s = 0;\r\n    if (e == null || e > v.length)\r\n        e = v.length;\r\n    // can't use .constructor in case user-supplied\r\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\r\n    n.set(v.subarray(s, e));\r\n    return n;\r\n};\r\n// expands raw DEFLATE data\r\nvar inflt = function (dat, buf, st) {\r\n    // source length\r\n    var sl = dat.length;\r\n    if (!sl || (st && !st.l && sl < 5))\r\n        return buf || new u8(0);\r\n    // have to estimate size\r\n    var noBuf = !buf || st;\r\n    // no state\r\n    var noSt = !st || st.i;\r\n    if (!st)\r\n        st = {};\r\n    // Assumes roughly 33% compression ratio average\r\n    if (!buf)\r\n        buf = new u8(sl * 3);\r\n    // ensure buffer can fit at least l elements\r\n    var cbuf = function (l) {\r\n        var bl = buf.length;\r\n        // need to increase size to fit\r\n        if (l > bl) {\r\n            // Double or set to necessary, whichever is greater\r\n            var nbuf = new u8(Math.max(bl * 2, l));\r\n            nbuf.set(buf);\r\n            buf = nbuf;\r\n        }\r\n    };\r\n    //  last chunk         bitpos           bytes\r\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\r\n    // total bits\r\n    var tbts = sl * 8;\r\n    do {\r\n        if (!lm) {\r\n            // BFINAL - this is only 1 when last chunk is next\r\n            st.f = final = bits(dat, pos, 1);\r\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\r\n            var type = bits(dat, pos + 1, 3);\r\n            pos += 3;\r\n            if (!type) {\r\n                // go to end of byte boundary\r\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\r\n                if (t > sl) {\r\n                    if (noSt)\r\n                        throw 'unexpected EOF';\r\n                    break;\r\n                }\r\n                // ensure size\r\n                if (noBuf)\r\n                    cbuf(bt + l);\r\n                // Copy over uncompressed data\r\n                buf.set(dat.subarray(s, t), bt);\r\n                // Get new bitpos, update byte count\r\n                st.b = bt += l, st.p = pos = t * 8;\r\n                continue;\r\n            }\r\n            else if (type == 1)\r\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\r\n            else if (type == 2) {\r\n                //  literal                            lengths\r\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\r\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\r\n                pos += 14;\r\n                // length+distance tree\r\n                var ldt = new u8(tl);\r\n                // code length tree\r\n                var clt = new u8(19);\r\n                for (var i = 0; i < hcLen; ++i) {\r\n                    // use index map to get real code\r\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\r\n                }\r\n                pos += hcLen * 3;\r\n                // code lengths bits\r\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\r\n                // code lengths map\r\n                var clm = hMap(clt, clb, 1);\r\n                for (var i = 0; i < tl;) {\r\n                    var r = clm[bits(dat, pos, clbmsk)];\r\n                    // bits read\r\n                    pos += r & 15;\r\n                    // symbol\r\n                    var s = r >>> 4;\r\n                    // code length to copy\r\n                    if (s < 16) {\r\n                        ldt[i++] = s;\r\n                    }\r\n                    else {\r\n                        //  copy   count\r\n                        var c = 0, n = 0;\r\n                        if (s == 16)\r\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\r\n                        else if (s == 17)\r\n                            n = 3 + bits(dat, pos, 7), pos += 3;\r\n                        else if (s == 18)\r\n                            n = 11 + bits(dat, pos, 127), pos += 7;\r\n                        while (n--)\r\n                            ldt[i++] = c;\r\n                    }\r\n                }\r\n                //    length tree                 distance tree\r\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\r\n                // max length bits\r\n                lbt = max(lt);\r\n                // max dist bits\r\n                dbt = max(dt);\r\n                lm = hMap(lt, lbt, 1);\r\n                dm = hMap(dt, dbt, 1);\r\n            }\r\n            else\r\n                throw 'invalid block type';\r\n            if (pos > tbts) {\r\n                if (noSt)\r\n                    throw 'unexpected EOF';\r\n                break;\r\n            }\r\n        }\r\n        // Make sure the buffer can hold this + the largest possible addition\r\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\r\n        if (noBuf)\r\n            cbuf(bt + 131072);\r\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\r\n        var lpos = pos;\r\n        for (;; lpos = pos) {\r\n            // bits read, code\r\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\r\n            pos += c & 15;\r\n            if (pos > tbts) {\r\n                if (noSt)\r\n                    throw 'unexpected EOF';\r\n                break;\r\n            }\r\n            if (!c)\r\n                throw 'invalid length/literal';\r\n            if (sym < 256)\r\n                buf[bt++] = sym;\r\n            else if (sym == 256) {\r\n                lpos = pos, lm = null;\r\n                break;\r\n            }\r\n            else {\r\n                var add = sym - 254;\r\n                // no extra bits needed if less\r\n                if (sym > 264) {\r\n                    // index\r\n                    var i = sym - 257, b = fleb[i];\r\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\r\n                    pos += b;\r\n                }\r\n                // dist\r\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\r\n                if (!d)\r\n                    throw 'invalid distance';\r\n                pos += d & 15;\r\n                var dt = fd[dsym];\r\n                if (dsym > 3) {\r\n                    var b = fdeb[dsym];\r\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\r\n                }\r\n                if (pos > tbts) {\r\n                    if (noSt)\r\n                        throw 'unexpected EOF';\r\n                    break;\r\n                }\r\n                if (noBuf)\r\n                    cbuf(bt + 131072);\r\n                var end = bt + add;\r\n                for (; bt < end; bt += 4) {\r\n                    buf[bt] = buf[bt - dt];\r\n                    buf[bt + 1] = buf[bt + 1 - dt];\r\n                    buf[bt + 2] = buf[bt + 2 - dt];\r\n                    buf[bt + 3] = buf[bt + 3 - dt];\r\n                }\r\n                bt = end;\r\n            }\r\n        }\r\n        st.l = lm, st.p = lpos, st.b = bt;\r\n        if (lm)\r\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\r\n    } while (!final);\r\n    return bt == buf.length ? buf : slc(buf, 0, bt);\r\n};\r\n// starting at p, write the minimum number of bits that can hold v to d\r\nvar wbits = function (d, p, v) {\r\n    v <<= p & 7;\r\n    var o = (p / 8) | 0;\r\n    d[o] |= v;\r\n    d[o + 1] |= v >>> 8;\r\n};\r\n// starting at p, write the minimum number of bits (>8) that can hold v to d\r\nvar wbits16 = function (d, p, v) {\r\n    v <<= p & 7;\r\n    var o = (p / 8) | 0;\r\n    d[o] |= v;\r\n    d[o + 1] |= v >>> 8;\r\n    d[o + 2] |= v >>> 16;\r\n};\r\n// creates code lengths from a frequency table\r\nvar hTree = function (d, mb) {\r\n    // Need extra info to make a tree\r\n    var t = [];\r\n    for (var i = 0; i < d.length; ++i) {\r\n        if (d[i])\r\n            t.push({ s: i, f: d[i] });\r\n    }\r\n    var s = t.length;\r\n    var t2 = t.slice();\r\n    if (!s)\r\n        return [et, 0];\r\n    if (s == 1) {\r\n        var v = new u8(t[0].s + 1);\r\n        v[t[0].s] = 1;\r\n        return [v, 1];\r\n    }\r\n    t.sort(function (a, b) { return a.f - b.f; });\r\n    // after i2 reaches last ind, will be stopped\r\n    // freq must be greater than largest possible number of symbols\r\n    t.push({ s: -1, f: 25001 });\r\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\r\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\r\n    // efficient algorithm from UZIP.js\r\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\r\n    // symbols that combined have high freq, will start processing i2 (high-freq,\r\n    // non-composite) symbols instead\r\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\r\n    while (i1 != s - 1) {\r\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\r\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\r\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\r\n    }\r\n    var maxSym = t2[0].s;\r\n    for (var i = 1; i < s; ++i) {\r\n        if (t2[i].s > maxSym)\r\n            maxSym = t2[i].s;\r\n    }\r\n    // code lengths\r\n    var tr = new u16(maxSym + 1);\r\n    // max bits in tree\r\n    var mbt = ln(t[i1 - 1], tr, 0);\r\n    if (mbt > mb) {\r\n        // more algorithms from UZIP.js\r\n        // TODO: find out how this code works (debt)\r\n        //  ind    debt\r\n        var i = 0, dt = 0;\r\n        //    left            cost\r\n        var lft = mbt - mb, cst = 1 << lft;\r\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\r\n        for (; i < s; ++i) {\r\n            var i2_1 = t2[i].s;\r\n            if (tr[i2_1] > mb) {\r\n                dt += cst - (1 << (mbt - tr[i2_1]));\r\n                tr[i2_1] = mb;\r\n            }\r\n            else\r\n                break;\r\n        }\r\n        dt >>>= lft;\r\n        while (dt > 0) {\r\n            var i2_2 = t2[i].s;\r\n            if (tr[i2_2] < mb)\r\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\r\n            else\r\n                ++i;\r\n        }\r\n        for (; i >= 0 && dt; --i) {\r\n            var i2_3 = t2[i].s;\r\n            if (tr[i2_3] == mb) {\r\n                --tr[i2_3];\r\n                ++dt;\r\n            }\r\n        }\r\n        mbt = mb;\r\n    }\r\n    return [new u8(tr), mbt];\r\n};\r\n// get the max length and assign length codes\r\nvar ln = function (n, l, d) {\r\n    return n.s == -1\r\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\r\n        : (l[n.s] = d);\r\n};\r\n// length codes generation\r\nvar lc = function (c) {\r\n    var s = c.length;\r\n    // Note that the semicolon was intentional\r\n    while (s && !c[--s])\r\n        ;\r\n    var cl = new u16(++s);\r\n    //  ind      num         streak\r\n    var cli = 0, cln = c[0], cls = 1;\r\n    var w = function (v) { cl[cli++] = v; };\r\n    for (var i = 1; i <= s; ++i) {\r\n        if (c[i] == cln && i != s)\r\n            ++cls;\r\n        else {\r\n            if (!cln && cls > 2) {\r\n                for (; cls > 138; cls -= 138)\r\n                    w(32754);\r\n                if (cls > 2) {\r\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\r\n                    cls = 0;\r\n                }\r\n            }\r\n            else if (cls > 3) {\r\n                w(cln), --cls;\r\n                for (; cls > 6; cls -= 6)\r\n                    w(8304);\r\n                if (cls > 2)\r\n                    w(((cls - 3) << 5) | 8208), cls = 0;\r\n            }\r\n            while (cls--)\r\n                w(cln);\r\n            cls = 1;\r\n            cln = c[i];\r\n        }\r\n    }\r\n    return [cl.subarray(0, cli), s];\r\n};\r\n// calculate the length of output from tree, code lengths\r\nvar clen = function (cf, cl) {\r\n    var l = 0;\r\n    for (var i = 0; i < cl.length; ++i)\r\n        l += cf[i] * cl[i];\r\n    return l;\r\n};\r\n// writes a fixed block\r\n// returns the new bit pos\r\nvar wfblk = function (out, pos, dat) {\r\n    // no need to write 00 as type: TypedArray defaults to 0\r\n    var s = dat.length;\r\n    var o = shft(pos + 2);\r\n    out[o] = s & 255;\r\n    out[o + 1] = s >>> 8;\r\n    out[o + 2] = out[o] ^ 255;\r\n    out[o + 3] = out[o + 1] ^ 255;\r\n    for (var i = 0; i < s; ++i)\r\n        out[o + i + 4] = dat[i];\r\n    return (o + 4 + s) * 8;\r\n};\r\n// writes a block\r\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\r\n    wbits(out, p++, final);\r\n    ++lf[256];\r\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\r\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\r\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\r\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\r\n    var lcfreq = new u16(19);\r\n    for (var i = 0; i < lclt.length; ++i)\r\n        lcfreq[lclt[i] & 31]++;\r\n    for (var i = 0; i < lcdt.length; ++i)\r\n        lcfreq[lcdt[i] & 31]++;\r\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\r\n    var nlcc = 19;\r\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\r\n        ;\r\n    var flen = (bl + 5) << 3;\r\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\r\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\r\n    if (flen <= ftlen && flen <= dtlen)\r\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\r\n    var lm, ll, dm, dl;\r\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\r\n    if (dtlen < ftlen) {\r\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\r\n        var llm = hMap(lct, mlcb, 0);\r\n        wbits(out, p, nlc - 257);\r\n        wbits(out, p + 5, ndc - 1);\r\n        wbits(out, p + 10, nlcc - 4);\r\n        p += 14;\r\n        for (var i = 0; i < nlcc; ++i)\r\n            wbits(out, p + 3 * i, lct[clim[i]]);\r\n        p += 3 * nlcc;\r\n        var lcts = [lclt, lcdt];\r\n        for (var it = 0; it < 2; ++it) {\r\n            var clct = lcts[it];\r\n            for (var i = 0; i < clct.length; ++i) {\r\n                var len = clct[i] & 31;\r\n                wbits(out, p, llm[len]), p += lct[len];\r\n                if (len > 15)\r\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\r\n    }\r\n    for (var i = 0; i < li; ++i) {\r\n        if (syms[i] > 255) {\r\n            var len = (syms[i] >>> 18) & 31;\r\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\r\n            if (len > 7)\r\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\r\n            var dst = syms[i] & 31;\r\n            wbits16(out, p, dm[dst]), p += dl[dst];\r\n            if (dst > 3)\r\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\r\n        }\r\n        else {\r\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\r\n        }\r\n    }\r\n    wbits16(out, p, lm[256]);\r\n    return p + ll[256];\r\n};\r\n// deflate options (nice << 13) | chain\r\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\r\n// empty\r\nvar et = /*#__PURE__*/ new u8(0);\r\n// compresses data into a raw DEFLATE buffer\r\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\r\n    var s = dat.length;\r\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\r\n    // writing to this writes to the output buffer\r\n    var w = o.subarray(pre, o.length - post);\r\n    var pos = 0;\r\n    if (!lvl || s < 8) {\r\n        for (var i = 0; i <= s; i += 65535) {\r\n            // end\r\n            var e = i + 65535;\r\n            if (e < s) {\r\n                // write full block\r\n                pos = wfblk(w, pos, dat.subarray(i, e));\r\n            }\r\n            else {\r\n                // write final block\r\n                w[i] = lst;\r\n                pos = wfblk(w, pos, dat.subarray(i, s));\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        var opt = deo[lvl - 1];\r\n        var n = opt >>> 13, c = opt & 8191;\r\n        var msk_1 = (1 << plvl) - 1;\r\n        //    prev 2-byte val map    curr 2-byte val map\r\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\r\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\r\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\r\n        // 24576 is an arbitrary number of maximum symbols per block\r\n        // 424 buffer for last block\r\n        var syms = new u32(25000);\r\n        // length/literal freq   distance freq\r\n        var lf = new u16(288), df = new u16(32);\r\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\r\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\r\n        for (; i < s; ++i) {\r\n            // hash value\r\n            // deopt when i > s - 3 - at end, deopt acceptable\r\n            var hv = hsh(i);\r\n            // index mod 32768    previous index mod\r\n            var imod = i & 32767, pimod = head[hv];\r\n            prev[imod] = pimod;\r\n            head[hv] = imod;\r\n            // We always should modify head and prev, but only add symbols if\r\n            // this data is not yet processed (\"wait\" for wait index)\r\n            if (wi <= i) {\r\n                // bytes remaining\r\n                var rem = s - i;\r\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\r\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\r\n                    li = lc_1 = eb = 0, bs = i;\r\n                    for (var j = 0; j < 286; ++j)\r\n                        lf[j] = 0;\r\n                    for (var j = 0; j < 30; ++j)\r\n                        df[j] = 0;\r\n                }\r\n                //  len    dist   chain\r\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\r\n                if (rem > 2 && hv == hsh(i - dif)) {\r\n                    var maxn = Math.min(n, rem) - 1;\r\n                    var maxd = Math.min(32767, i);\r\n                    // max possible length\r\n                    // not capped at dif because decompressors implement \"rolling\" index population\r\n                    var ml = Math.min(258, rem);\r\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\r\n                        if (dat[i + l] == dat[i + l - dif]) {\r\n                            var nl = 0;\r\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\r\n                                ;\r\n                            if (nl > l) {\r\n                                l = nl, d = dif;\r\n                                // break out early when we reach \"nice\" (we are satisfied enough)\r\n                                if (nl > maxn)\r\n                                    break;\r\n                                // now, find the rarest 2-byte sequence within this\r\n                                // length of literals and search for that instead.\r\n                                // Much faster than just using the start\r\n                                var mmd = Math.min(dif, nl - 2);\r\n                                var md = 0;\r\n                                for (var j = 0; j < mmd; ++j) {\r\n                                    var ti = (i - dif + j + 32768) & 32767;\r\n                                    var pti = prev[ti];\r\n                                    var cd = (ti - pti + 32768) & 32767;\r\n                                    if (cd > md)\r\n                                        md = cd, pimod = ti;\r\n                                }\r\n                            }\r\n                        }\r\n                        // check the previous match\r\n                        imod = pimod, pimod = prev[imod];\r\n                        dif += (imod - pimod + 32768) & 32767;\r\n                    }\r\n                }\r\n                // d will be nonzero only when a match was found\r\n                if (d) {\r\n                    // store both dist and len data in one Uint32\r\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\r\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\r\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\r\n                    eb += fleb[lin] + fdeb[din];\r\n                    ++lf[257 + lin];\r\n                    ++df[din];\r\n                    wi = i + l;\r\n                    ++lc_1;\r\n                }\r\n                else {\r\n                    syms[li++] = dat[i];\r\n                    ++lf[dat[i]];\r\n                }\r\n            }\r\n        }\r\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\r\n        // this is the easiest way to avoid needing to maintain state\r\n        if (!lst && pos & 7)\r\n            pos = wfblk(w, pos + 1, et);\r\n    }\r\n    return slc(o, 0, pre + shft(pos) + post);\r\n};\r\n// CRC32 table\r\nvar crct = /*#__PURE__*/ (function () {\r\n    var t = new u32(256);\r\n    for (var i = 0; i < 256; ++i) {\r\n        var c = i, k = 9;\r\n        while (--k)\r\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\r\n        t[i] = c;\r\n    }\r\n    return t;\r\n})();\r\n// CRC32\r\nvar crc = function () {\r\n    var c = -1;\r\n    return {\r\n        p: function (d) {\r\n            // closures have awful performance\r\n            var cr = c;\r\n            for (var i = 0; i < d.length; ++i)\r\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\r\n            c = cr;\r\n        },\r\n        d: function () { return ~c; }\r\n    };\r\n};\r\n// Alder32\r\nvar adler = function () {\r\n    var a = 1, b = 0;\r\n    return {\r\n        p: function (d) {\r\n            // closures have awful performance\r\n            var n = a, m = b;\r\n            var l = d.length;\r\n            for (var i = 0; i != l;) {\r\n                var e = Math.min(i + 2655, l);\r\n                for (; i < e; ++i)\r\n                    m += n += d[i];\r\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\r\n            }\r\n            a = n, b = m;\r\n        },\r\n        d: function () {\r\n            a %= 65521, b %= 65521;\r\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\r\n        }\r\n    };\r\n};\r\n;\r\n// deflate with opts\r\nvar dopt = function (dat, opt, pre, post, st) {\r\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\r\n};\r\n// Walmart object spread\r\nvar mrg = function (a, b) {\r\n    var o = {};\r\n    for (var k in a)\r\n        o[k] = a[k];\r\n    for (var k in b)\r\n        o[k] = b[k];\r\n    return o;\r\n};\r\n// worker clone\r\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\r\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\r\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\r\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\r\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\r\n// This took me three weeks to figure out how to do.\r\nvar wcln = function (fn, fnStr, td) {\r\n    var dt = fn();\r\n    var st = fn.toString();\r\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\r\n    for (var i = 0; i < dt.length; ++i) {\r\n        var v = dt[i], k = ks[i];\r\n        if (typeof v == 'function') {\r\n            fnStr += ';' + k + '=';\r\n            var st_1 = v.toString();\r\n            if (v.prototype) {\r\n                // for global objects\r\n                if (st_1.indexOf('[native code]') != -1) {\r\n                    var spInd = st_1.indexOf(' ', 8) + 1;\r\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\r\n                }\r\n                else {\r\n                    fnStr += st_1;\r\n                    for (var t in v.prototype)\r\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\r\n                }\r\n            }\r\n            else\r\n                fnStr += st_1;\r\n        }\r\n        else\r\n            td[k] = v;\r\n    }\r\n    return [fnStr, td];\r\n};\r\nvar ch = [];\r\n// clone bufs\r\nvar cbfs = function (v) {\r\n    var tl = [];\r\n    for (var k in v) {\r\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\r\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\r\n    }\r\n    return tl;\r\n};\r\n// use a worker to execute code\r\nvar wrkr = function (fns, init, id, cb) {\r\n    var _a;\r\n    if (!ch[id]) {\r\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\r\n        for (var i = 0; i < m; ++i)\r\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\r\n        ch[id] = wcln(fns[m], fnStr, td_1);\r\n    }\r\n    var td = mrg({}, ch[id][1]);\r\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\r\n};\r\n// base async inflate fn\r\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\r\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\r\n// gzip extra\r\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\r\n// gunzip extra\r\nvar guze = function () { return [gzs, gzl]; };\r\n// zlib extra\r\nvar zle = function () { return [zlh, wbytes, adler]; };\r\n// unzlib extra\r\nvar zule = function () { return [zlv]; };\r\n// post buf\r\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\r\n// get u8\r\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\r\n// async helper\r\nvar cbify = function (dat, opts, fns, init, id, cb) {\r\n    var w = wrkr(fns, init, id, function (err, dat) {\r\n        w.terminate();\r\n        cb(err, dat);\r\n    });\r\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\r\n    return function () { w.terminate(); };\r\n};\r\n// auto stream\r\nvar astrm = function (strm) {\r\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\r\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\r\n};\r\n// async stream attach\r\nvar astrmify = function (fns, strm, opts, init, id) {\r\n    var t;\r\n    var w = wrkr(fns, init, id, function (err, dat) {\r\n        if (err)\r\n            w.terminate(), strm.ondata.call(strm, err);\r\n        else {\r\n            if (dat[1])\r\n                w.terminate();\r\n            strm.ondata.call(strm, err, dat[0], dat[1]);\r\n        }\r\n    });\r\n    w.postMessage(opts);\r\n    strm.push = function (d, f) {\r\n        if (t)\r\n            throw 'stream finished';\r\n        if (!strm.ondata)\r\n            throw 'no stream handler';\r\n        w.postMessage([d, t = f], [d.buffer]);\r\n    };\r\n    strm.terminate = function () { w.terminate(); };\r\n};\r\n// read 2 bytes\r\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\r\n// read 4 bytes\r\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\r\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\r\n// write bytes\r\nvar wbytes = function (d, b, v) {\r\n    for (; v; ++b)\r\n        d[b] = v, v >>>= 8;\r\n};\r\n// gzip header\r\nvar gzh = function (c, o) {\r\n    var fn = o.filename;\r\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\r\n    if (o.mtime != 0)\r\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\r\n    if (fn) {\r\n        c[3] = 8;\r\n        for (var i = 0; i <= fn.length; ++i)\r\n            c[i + 10] = fn.charCodeAt(i);\r\n    }\r\n};\r\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\r\n// gzip start\r\nvar gzs = function (d) {\r\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\r\n        throw 'invalid gzip data';\r\n    var flg = d[3];\r\n    var st = 10;\r\n    if (flg & 4)\r\n        st += d[10] | (d[11] << 8) + 2;\r\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\r\n        ;\r\n    return st + (flg & 2);\r\n};\r\n// gzip length\r\nvar gzl = function (d) {\r\n    var l = d.length;\r\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\r\n};\r\n// gzip header length\r\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\r\n// zlib header\r\nvar zlh = function (c, o) {\r\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\r\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\r\n};\r\n// zlib valid\r\nvar zlv = function (d) {\r\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\r\n        throw 'invalid zlib data';\r\n    if (d[1] & 32)\r\n        throw 'invalid zlib data: preset dictionaries not supported';\r\n};\r\nfunction AsyncCmpStrm(opts, cb) {\r\n    if (!cb && typeof opts == 'function')\r\n        cb = opts, opts = {};\r\n    this.ondata = cb;\r\n    return opts;\r\n}\r\n// zlib footer: -4 to -0 is Adler32\r\n/**\r\n * Streaming DEFLATE compression\r\n */\r\nvar Deflate = /*#__PURE__*/ (function () {\r\n    function Deflate(opts, cb) {\r\n        if (!cb && typeof opts == 'function')\r\n            cb = opts, opts = {};\r\n        this.ondata = cb;\r\n        this.o = opts || {};\r\n    }\r\n    Deflate.prototype.p = function (c, f) {\r\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\r\n    };\r\n    /**\r\n     * Pushes a chunk to be deflated\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Deflate.prototype.push = function (chunk, final) {\r\n        if (this.d)\r\n            throw 'stream finished';\r\n        if (!this.ondata)\r\n            throw 'no stream handler';\r\n        this.d = final;\r\n        this.p(chunk, final || false);\r\n    };\r\n    return Deflate;\r\n}());\r\nexport { Deflate };\r\n/**\r\n * Asynchronous streaming DEFLATE compression\r\n */\r\nvar AsyncDeflate = /*#__PURE__*/ (function () {\r\n    function AsyncDeflate(opts, cb) {\r\n        astrmify([\r\n            bDflt,\r\n            function () { return [astrm, Deflate]; }\r\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\r\n            var strm = new Deflate(ev.data);\r\n            onmessage = astrm(strm);\r\n        }, 6);\r\n    }\r\n    return AsyncDeflate;\r\n}());\r\nexport { AsyncDeflate };\r\nexport function deflate(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bDflt,\r\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\r\n}\r\n/**\r\n * Compresses data with DEFLATE without any wrapper\r\n * @param data The data to compress\r\n * @param opts The compression options\r\n * @returns The deflated version of the data\r\n */\r\nexport function deflateSync(data, opts) {\r\n    return dopt(data, opts || {}, 0, 0);\r\n}\r\n/**\r\n * Streaming DEFLATE decompression\r\n */\r\nvar Inflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates an inflation stream\r\n     * @param cb The callback to call whenever data is inflated\r\n     */\r\n    function Inflate(cb) {\r\n        this.s = {};\r\n        this.p = new u8(0);\r\n        this.ondata = cb;\r\n    }\r\n    Inflate.prototype.e = function (c) {\r\n        if (this.d)\r\n            throw 'stream finished';\r\n        if (!this.ondata)\r\n            throw 'no stream handler';\r\n        var l = this.p.length;\r\n        var n = new u8(l + c.length);\r\n        n.set(this.p), n.set(c, l), this.p = n;\r\n    };\r\n    Inflate.prototype.c = function (final) {\r\n        this.d = this.s.i = final || false;\r\n        var bts = this.s.b;\r\n        var dt = inflt(this.p, this.o, this.s);\r\n        this.ondata(slc(dt, bts, this.s.b), this.d);\r\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\r\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\r\n    };\r\n    /**\r\n     * Pushes a chunk to be inflated\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the final chunk\r\n     */\r\n    Inflate.prototype.push = function (chunk, final) {\r\n        this.e(chunk), this.c(final);\r\n    };\r\n    return Inflate;\r\n}());\r\nexport { Inflate };\r\n/**\r\n * Asynchronous streaming DEFLATE decompression\r\n */\r\nvar AsyncInflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates an asynchronous inflation stream\r\n     * @param cb The callback to call whenever data is deflated\r\n     */\r\n    function AsyncInflate(cb) {\r\n        this.ondata = cb;\r\n        astrmify([\r\n            bInflt,\r\n            function () { return [astrm, Inflate]; }\r\n        ], this, 0, function () {\r\n            var strm = new Inflate();\r\n            onmessage = astrm(strm);\r\n        }, 7);\r\n    }\r\n    return AsyncInflate;\r\n}());\r\nexport { AsyncInflate };\r\nexport function inflate(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bInflt\r\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\r\n}\r\n/**\r\n * Expands DEFLATE data with no wrapper\r\n * @param data The data to decompress\r\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\r\n * @returns The decompressed version of the data\r\n */\r\nexport function inflateSync(data, out) {\r\n    return inflt(data, out);\r\n}\r\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\r\n/**\r\n * Streaming GZIP compression\r\n */\r\nvar Gzip = /*#__PURE__*/ (function () {\r\n    function Gzip(opts, cb) {\r\n        this.c = crc();\r\n        this.l = 0;\r\n        this.v = 1;\r\n        Deflate.call(this, opts, cb);\r\n    }\r\n    /**\r\n     * Pushes a chunk to be GZIPped\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Gzip.prototype.push = function (chunk, final) {\r\n        Deflate.prototype.push.call(this, chunk, final);\r\n    };\r\n    Gzip.prototype.p = function (c, f) {\r\n        this.c.p(c);\r\n        this.l += c.length;\r\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\r\n        if (this.v)\r\n            gzh(raw, this.o), this.v = 0;\r\n        if (f)\r\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\r\n        this.ondata(raw, f);\r\n    };\r\n    return Gzip;\r\n}());\r\nexport { Gzip };\r\n/**\r\n * Asynchronous streaming GZIP compression\r\n */\r\nvar AsyncGzip = /*#__PURE__*/ (function () {\r\n    function AsyncGzip(opts, cb) {\r\n        astrmify([\r\n            bDflt,\r\n            gze,\r\n            function () { return [astrm, Deflate, Gzip]; }\r\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\r\n            var strm = new Gzip(ev.data);\r\n            onmessage = astrm(strm);\r\n        }, 8);\r\n    }\r\n    return AsyncGzip;\r\n}());\r\nexport { AsyncGzip };\r\nexport function gzip(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bDflt,\r\n        gze,\r\n        function () { return [gzipSync]; }\r\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\r\n}\r\n/**\r\n * Compresses data with GZIP\r\n * @param data The data to compress\r\n * @param opts The compression options\r\n * @returns The gzipped version of the data\r\n */\r\nexport function gzipSync(data, opts) {\r\n    if (!opts)\r\n        opts = {};\r\n    var c = crc(), l = data.length;\r\n    c.p(data);\r\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\r\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\r\n}\r\n/**\r\n * Streaming GZIP decompression\r\n */\r\nvar Gunzip = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a GUNZIP stream\r\n     * @param cb The callback to call whenever data is inflated\r\n     */\r\n    function Gunzip(cb) {\r\n        this.v = 1;\r\n        Inflate.call(this, cb);\r\n    }\r\n    /**\r\n     * Pushes a chunk to be GUNZIPped\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Gunzip.prototype.push = function (chunk, final) {\r\n        Inflate.prototype.e.call(this, chunk);\r\n        if (this.v) {\r\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\r\n            if (s >= this.p.length && !final)\r\n                return;\r\n            this.p = this.p.subarray(s), this.v = 0;\r\n        }\r\n        if (final) {\r\n            if (this.p.length < 8)\r\n                throw 'invalid gzip stream';\r\n            this.p = this.p.subarray(0, -8);\r\n        }\r\n        // necessary to prevent TS from using the closure value\r\n        // This allows for workerization to function correctly\r\n        Inflate.prototype.c.call(this, final);\r\n    };\r\n    return Gunzip;\r\n}());\r\nexport { Gunzip };\r\n/**\r\n * Asynchronous streaming GZIP decompression\r\n */\r\nvar AsyncGunzip = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates an asynchronous GUNZIP stream\r\n     * @param cb The callback to call whenever data is deflated\r\n     */\r\n    function AsyncGunzip(cb) {\r\n        this.ondata = cb;\r\n        astrmify([\r\n            bInflt,\r\n            guze,\r\n            function () { return [astrm, Inflate, Gunzip]; }\r\n        ], this, 0, function () {\r\n            var strm = new Gunzip();\r\n            onmessage = astrm(strm);\r\n        }, 9);\r\n    }\r\n    return AsyncGunzip;\r\n}());\r\nexport { AsyncGunzip };\r\nexport function gunzip(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bInflt,\r\n        guze,\r\n        function () { return [gunzipSync]; }\r\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\r\n}\r\n/**\r\n * Expands GZIP data\r\n * @param data The data to decompress\r\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\r\n * @returns The decompressed version of the data\r\n */\r\nexport function gunzipSync(data, out) {\r\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\r\n}\r\n/**\r\n * Streaming Zlib compression\r\n */\r\nvar Zlib = /*#__PURE__*/ (function () {\r\n    function Zlib(opts, cb) {\r\n        this.c = adler();\r\n        this.v = 1;\r\n        Deflate.call(this, opts, cb);\r\n    }\r\n    /**\r\n     * Pushes a chunk to be zlibbed\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Zlib.prototype.push = function (chunk, final) {\r\n        Deflate.prototype.push.call(this, chunk, final);\r\n    };\r\n    Zlib.prototype.p = function (c, f) {\r\n        this.c.p(c);\r\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\r\n        if (this.v)\r\n            zlh(raw, this.o), this.v = 0;\r\n        if (f)\r\n            wbytes(raw, raw.length - 4, this.c.d());\r\n        this.ondata(raw, f);\r\n    };\r\n    return Zlib;\r\n}());\r\nexport { Zlib };\r\n/**\r\n * Asynchronous streaming Zlib compression\r\n */\r\nvar AsyncZlib = /*#__PURE__*/ (function () {\r\n    function AsyncZlib(opts, cb) {\r\n        astrmify([\r\n            bDflt,\r\n            zle,\r\n            function () { return [astrm, Deflate, Zlib]; }\r\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\r\n            var strm = new Zlib(ev.data);\r\n            onmessage = astrm(strm);\r\n        }, 10);\r\n    }\r\n    return AsyncZlib;\r\n}());\r\nexport { AsyncZlib };\r\nexport function zlib(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bDflt,\r\n        zle,\r\n        function () { return [zlibSync]; }\r\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\r\n}\r\n/**\r\n * Compress data with Zlib\r\n * @param data The data to compress\r\n * @param opts The compression options\r\n * @returns The zlib-compressed version of the data\r\n */\r\nexport function zlibSync(data, opts) {\r\n    if (!opts)\r\n        opts = {};\r\n    var a = adler();\r\n    a.p(data);\r\n    var d = dopt(data, opts, 2, 4);\r\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\r\n}\r\n/**\r\n * Streaming Zlib decompression\r\n */\r\nvar Unzlib = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a Zlib decompression stream\r\n     * @param cb The callback to call whenever data is inflated\r\n     */\r\n    function Unzlib(cb) {\r\n        this.v = 1;\r\n        Inflate.call(this, cb);\r\n    }\r\n    /**\r\n     * Pushes a chunk to be unzlibbed\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Unzlib.prototype.push = function (chunk, final) {\r\n        Inflate.prototype.e.call(this, chunk);\r\n        if (this.v) {\r\n            if (this.p.length < 2 && !final)\r\n                return;\r\n            this.p = this.p.subarray(2), this.v = 0;\r\n        }\r\n        if (final) {\r\n            if (this.p.length < 4)\r\n                throw 'invalid zlib stream';\r\n            this.p = this.p.subarray(0, -4);\r\n        }\r\n        // necessary to prevent TS from using the closure value\r\n        // This allows for workerization to function correctly\r\n        Inflate.prototype.c.call(this, final);\r\n    };\r\n    return Unzlib;\r\n}());\r\nexport { Unzlib };\r\n/**\r\n * Asynchronous streaming Zlib decompression\r\n */\r\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates an asynchronous Zlib decompression stream\r\n     * @param cb The callback to call whenever data is deflated\r\n     */\r\n    function AsyncUnzlib(cb) {\r\n        this.ondata = cb;\r\n        astrmify([\r\n            bInflt,\r\n            zule,\r\n            function () { return [astrm, Inflate, Unzlib]; }\r\n        ], this, 0, function () {\r\n            var strm = new Unzlib();\r\n            onmessage = astrm(strm);\r\n        }, 11);\r\n    }\r\n    return AsyncUnzlib;\r\n}());\r\nexport { AsyncUnzlib };\r\nexport function unzlib(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return cbify(data, opts, [\r\n        bInflt,\r\n        zule,\r\n        function () { return [unzlibSync]; }\r\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\r\n}\r\n/**\r\n * Expands Zlib data\r\n * @param data The data to decompress\r\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\r\n * @returns The decompressed version of the data\r\n */\r\nexport function unzlibSync(data, out) {\r\n    return inflt((zlv(data), data.subarray(2, -4)), out);\r\n}\r\n// Default algorithm for compression (used because having a known output size allows faster decompression)\r\nexport { gzip as compress, AsyncGzip as AsyncCompress };\r\n// Default algorithm for compression (used because having a known output size allows faster decompression)\r\nexport { gzipSync as compressSync, Gzip as Compress };\r\n/**\r\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\r\n */\r\nvar Decompress = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a decompression stream\r\n     * @param cb The callback to call whenever data is decompressed\r\n     */\r\n    function Decompress(cb) {\r\n        this.G = Gunzip;\r\n        this.I = Inflate;\r\n        this.Z = Unzlib;\r\n        this.ondata = cb;\r\n    }\r\n    /**\r\n     * Pushes a chunk to be decompressed\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Decompress.prototype.push = function (chunk, final) {\r\n        if (!this.ondata)\r\n            throw 'no stream handler';\r\n        if (!this.s) {\r\n            if (this.p && this.p.length) {\r\n                var n = new u8(this.p.length + chunk.length);\r\n                n.set(this.p), n.set(chunk, this.p.length);\r\n            }\r\n            else\r\n                this.p = chunk;\r\n            if (this.p.length > 2) {\r\n                var _this_1 = this;\r\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\r\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\r\n                    ? new this.G(cb)\r\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\r\n                        ? new this.I(cb)\r\n                        : new this.Z(cb);\r\n                this.s.push(this.p, final);\r\n                this.p = null;\r\n            }\r\n        }\r\n        else\r\n            this.s.push(chunk, final);\r\n    };\r\n    return Decompress;\r\n}());\r\nexport { Decompress };\r\n/**\r\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\r\n */\r\nvar AsyncDecompress = /*#__PURE__*/ (function () {\r\n    /**\r\n   * Creates an asynchronous decompression stream\r\n   * @param cb The callback to call whenever data is decompressed\r\n   */\r\n    function AsyncDecompress(cb) {\r\n        this.G = AsyncGunzip;\r\n        this.I = AsyncInflate;\r\n        this.Z = AsyncUnzlib;\r\n        this.ondata = cb;\r\n    }\r\n    /**\r\n     * Pushes a chunk to be decompressed\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    AsyncDecompress.prototype.push = function (chunk, final) {\r\n        Decompress.prototype.push.call(this, chunk, final);\r\n    };\r\n    return AsyncDecompress;\r\n}());\r\nexport { AsyncDecompress };\r\nexport function decompress(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\r\n        ? gunzip(data, opts, cb)\r\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\r\n            ? inflate(data, opts, cb)\r\n            : unzlib(data, opts, cb);\r\n}\r\n/**\r\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\r\n * @param data The data to decompress\r\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\r\n * @returns The decompressed version of the data\r\n */\r\nexport function decompressSync(data, out) {\r\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\r\n        ? gunzipSync(data, out)\r\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\r\n            ? inflateSync(data, out)\r\n            : unzlibSync(data, out);\r\n}\r\n// flatten a directory structure\r\nvar fltn = function (d, p, t, o) {\r\n    for (var k in d) {\r\n        var val = d[k], n = p + k;\r\n        if (val instanceof u8)\r\n            t[n] = [val, o];\r\n        else if (Array.isArray(val))\r\n            t[n] = [val[0], mrg(o, val[1])];\r\n        else\r\n            fltn(val, n + '/', t, o);\r\n    }\r\n};\r\n// text encoder\r\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\r\n// text decoder\r\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\r\n// text decoder stream\r\nvar tds = 0;\r\ntry {\r\n    td.decode(et, { stream: true });\r\n    tds = 1;\r\n}\r\ncatch (e) { }\r\n// decode UTF8\r\nvar dutf8 = function (d) {\r\n    for (var r = '', i = 0;;) {\r\n        var c = d[i++];\r\n        var eb = (c > 127) + (c > 223) + (c > 239);\r\n        if (i + eb > d.length)\r\n            return [r, slc(d, i - 1)];\r\n        if (!eb)\r\n            r += String.fromCharCode(c);\r\n        else if (eb == 3) {\r\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\r\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\r\n        }\r\n        else if (eb & 1)\r\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\r\n        else\r\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\r\n    }\r\n};\r\n/**\r\n * Streaming UTF-8 decoding\r\n */\r\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a UTF-8 decoding stream\r\n     * @param cb The callback to call whenever data is decoded\r\n     */\r\n    function DecodeUTF8(cb) {\r\n        this.ondata = cb;\r\n        if (tds)\r\n            this.t = new TextDecoder();\r\n        else\r\n            this.p = et;\r\n    }\r\n    /**\r\n     * Pushes a chunk to be decoded from UTF-8 binary\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    DecodeUTF8.prototype.push = function (chunk, final) {\r\n        if (!this.ondata)\r\n            throw 'no callback';\r\n        final = !!final;\r\n        if (this.t) {\r\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\r\n            if (final) {\r\n                if (this.t.decode().length)\r\n                    throw 'invalid utf-8 data';\r\n                this.t = null;\r\n            }\r\n            return;\r\n        }\r\n        if (!this.p)\r\n            throw 'stream finished';\r\n        var dat = new u8(this.p.length + chunk.length);\r\n        dat.set(this.p);\r\n        dat.set(chunk, this.p.length);\r\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\r\n        if (final) {\r\n            if (np.length)\r\n                throw 'invalid utf-8 data';\r\n            this.p = null;\r\n        }\r\n        else\r\n            this.p = np;\r\n        this.ondata(ch, final);\r\n    };\r\n    return DecodeUTF8;\r\n}());\r\nexport { DecodeUTF8 };\r\n/**\r\n * Streaming UTF-8 encoding\r\n */\r\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a UTF-8 decoding stream\r\n     * @param cb The callback to call whenever data is encoded\r\n     */\r\n    function EncodeUTF8(cb) {\r\n        this.ondata = cb;\r\n    }\r\n    /**\r\n     * Pushes a chunk to be encoded to UTF-8\r\n     * @param chunk The string data to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    EncodeUTF8.prototype.push = function (chunk, final) {\r\n        if (!this.ondata)\r\n            throw 'no callback';\r\n        if (this.d)\r\n            throw 'stream finished';\r\n        this.ondata(strToU8(chunk), this.d = final || false);\r\n    };\r\n    return EncodeUTF8;\r\n}());\r\nexport { EncodeUTF8 };\r\n/**\r\n * Converts a string into a Uint8Array for use with compression/decompression methods\r\n * @param str The string to encode\r\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\r\n *               not need to be true unless decoding a binary string.\r\n * @returns The string encoded in UTF-8/Latin-1 binary\r\n */\r\nexport function strToU8(str, latin1) {\r\n    if (latin1) {\r\n        var ar_1 = new u8(str.length);\r\n        for (var i = 0; i < str.length; ++i)\r\n            ar_1[i] = str.charCodeAt(i);\r\n        return ar_1;\r\n    }\r\n    if (te)\r\n        return te.encode(str);\r\n    var l = str.length;\r\n    var ar = new u8(str.length + (str.length >> 1));\r\n    var ai = 0;\r\n    var w = function (v) { ar[ai++] = v; };\r\n    for (var i = 0; i < l; ++i) {\r\n        if (ai + 5 > ar.length) {\r\n            var n = new u8(ai + 8 + ((l - i) << 1));\r\n            n.set(ar);\r\n            ar = n;\r\n        }\r\n        var c = str.charCodeAt(i);\r\n        if (c < 128 || latin1)\r\n            w(c);\r\n        else if (c < 2048)\r\n            w(192 | (c >> 6)), w(128 | (c & 63));\r\n        else if (c > 55295 && c < 57344)\r\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\r\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\r\n        else\r\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\r\n    }\r\n    return slc(ar, 0, ai);\r\n}\r\n/**\r\n * Converts a Uint8Array to a string\r\n * @param dat The data to decode to string\r\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\r\n *               not need to be true unless encoding to binary string.\r\n * @returns The original UTF-8/Latin-1 string\r\n */\r\nexport function strFromU8(dat, latin1) {\r\n    if (latin1) {\r\n        var r = '';\r\n        for (var i = 0; i < dat.length; i += 16384)\r\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\r\n        return r;\r\n    }\r\n    else if (td)\r\n        return td.decode(dat);\r\n    else {\r\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\r\n        if (ext.length)\r\n            throw 'invalid utf-8 data';\r\n        return out;\r\n    }\r\n}\r\n;\r\n// deflate bit flag\r\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\r\n// skip local zip header\r\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\r\n// read zip header\r\nvar zh = function (d, b, z) {\r\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\r\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\r\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\r\n};\r\n// read zip64 extra field\r\nvar z64e = function (d, b) {\r\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\r\n        ;\r\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\r\n};\r\n// extra field length\r\nvar exfl = function (ex) {\r\n    var le = 0;\r\n    if (ex) {\r\n        for (var k in ex) {\r\n            var l = ex[k].length;\r\n            if (l > 65535)\r\n                throw 'extra field too long';\r\n            le += l + 4;\r\n        }\r\n    }\r\n    return le;\r\n};\r\n// write zip header\r\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\r\n    var fl = fn.length, ex = f.extra, col = co && co.length;\r\n    var exl = exfl(ex);\r\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\r\n    if (ce != null)\r\n        d[b++] = 20, d[b++] = f.os;\r\n    d[b] = 20, b += 2; // spec compliance? what's that?\r\n    d[b++] = (f.flag << 1) | (c == null && 8), d[b++] = u && 8;\r\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\r\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\r\n    if (y < 0 || y > 119)\r\n        throw 'date not in range 1980-2099';\r\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\r\n    if (c != null) {\r\n        wbytes(d, b, f.crc);\r\n        wbytes(d, b + 4, c);\r\n        wbytes(d, b + 8, f.size);\r\n    }\r\n    wbytes(d, b + 12, fl);\r\n    wbytes(d, b + 14, exl), b += 16;\r\n    if (ce != null) {\r\n        wbytes(d, b, col);\r\n        wbytes(d, b + 6, f.attrs);\r\n        wbytes(d, b + 10, ce), b += 14;\r\n    }\r\n    d.set(fn, b);\r\n    b += fl;\r\n    if (exl) {\r\n        for (var k in ex) {\r\n            var exf = ex[k], l = exf.length;\r\n            wbytes(d, b, +k);\r\n            wbytes(d, b + 2, l);\r\n            d.set(exf, b + 4), b += 4 + l;\r\n        }\r\n    }\r\n    if (col)\r\n        d.set(co, b), b += col;\r\n    return b;\r\n};\r\n// write zip footer (end of central directory)\r\nvar wzf = function (o, b, c, d, e) {\r\n    wbytes(o, b, 0x6054B50); // skip disk\r\n    wbytes(o, b + 8, c);\r\n    wbytes(o, b + 10, c);\r\n    wbytes(o, b + 12, d);\r\n    wbytes(o, b + 16, e);\r\n};\r\n/**\r\n * A pass-through stream to keep data uncompressed in a ZIP archive.\r\n */\r\nvar ZipPassThrough = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a pass-through stream that can be added to ZIP archives\r\n     * @param filename The filename to associate with this data stream\r\n     */\r\n    function ZipPassThrough(filename) {\r\n        this.filename = filename;\r\n        this.c = crc();\r\n        this.size = 0;\r\n        this.compression = 0;\r\n    }\r\n    /**\r\n     * Processes a chunk and pushes to the output stream. You can override this\r\n     * method in a subclass for custom behavior, but by default this passes\r\n     * the data through. You must call this.ondata(err, chunk, final) at some\r\n     * point in this method.\r\n     * @param chunk The chunk to process\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    ZipPassThrough.prototype.process = function (chunk, final) {\r\n        this.ondata(null, chunk, final);\r\n    };\r\n    /**\r\n     * Pushes a chunk to be added. If you are subclassing this with a custom\r\n     * compression algorithm, note that you must push data from the source\r\n     * file only, pre-compression.\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    ZipPassThrough.prototype.push = function (chunk, final) {\r\n        if (!this.ondata)\r\n            throw 'no callback - add to ZIP archive before pushing';\r\n        this.c.p(chunk);\r\n        this.size += chunk.length;\r\n        if (final)\r\n            this.crc = this.c.d();\r\n        this.process(chunk, final || false);\r\n    };\r\n    return ZipPassThrough;\r\n}());\r\nexport { ZipPassThrough };\r\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\r\n/**\r\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\r\n * for better performance\r\n */\r\nvar ZipDeflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a DEFLATE stream that can be added to ZIP archives\r\n     * @param filename The filename to associate with this data stream\r\n     * @param opts The compression options\r\n     */\r\n    function ZipDeflate(filename, opts) {\r\n        var _this_1 = this;\r\n        if (!opts)\r\n            opts = {};\r\n        ZipPassThrough.call(this, filename);\r\n        this.d = new Deflate(opts, function (dat, final) {\r\n            _this_1.ondata(null, dat, final);\r\n        });\r\n        this.compression = 8;\r\n        this.flag = dbf(opts.level);\r\n    }\r\n    ZipDeflate.prototype.process = function (chunk, final) {\r\n        try {\r\n            this.d.push(chunk, final);\r\n        }\r\n        catch (e) {\r\n            this.ondata(e, null, final);\r\n        }\r\n    };\r\n    /**\r\n     * Pushes a chunk to be deflated\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    ZipDeflate.prototype.push = function (chunk, final) {\r\n        ZipPassThrough.prototype.push.call(this, chunk, final);\r\n    };\r\n    return ZipDeflate;\r\n}());\r\nexport { ZipDeflate };\r\n/**\r\n * Asynchronous streaming DEFLATE compression for ZIP archives\r\n */\r\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a DEFLATE stream that can be added to ZIP archives\r\n     * @param filename The filename to associate with this data stream\r\n     * @param opts The compression options\r\n     */\r\n    function AsyncZipDeflate(filename, opts) {\r\n        var _this_1 = this;\r\n        if (!opts)\r\n            opts = {};\r\n        ZipPassThrough.call(this, filename);\r\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\r\n            _this_1.ondata(err, dat, final);\r\n        });\r\n        this.compression = 8;\r\n        this.flag = dbf(opts.level);\r\n        this.terminate = this.d.terminate;\r\n    }\r\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\r\n        this.d.push(chunk, final);\r\n    };\r\n    /**\r\n     * Pushes a chunk to be deflated\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\r\n        ZipPassThrough.prototype.push.call(this, chunk, final);\r\n    };\r\n    return AsyncZipDeflate;\r\n}());\r\nexport { AsyncZipDeflate };\r\n// TODO: Better tree shaking\r\n/**\r\n * A zippable archive to which files can incrementally be added\r\n */\r\nvar Zip = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates an empty ZIP archive to which files can be added\r\n     * @param cb The callback to call whenever data for the generated ZIP archive\r\n     *           is available\r\n     */\r\n    function Zip(cb) {\r\n        this.ondata = cb;\r\n        this.u = [];\r\n        this.d = 1;\r\n    }\r\n    /**\r\n     * Adds a file to the ZIP archive\r\n     * @param file The file stream to add\r\n     */\r\n    Zip.prototype.add = function (file) {\r\n        var _this_1 = this;\r\n        if (this.d & 2)\r\n            throw 'stream finished';\r\n        var f = strToU8(file.filename), fl = f.length;\r\n        var com = file.comment, o = com && strToU8(com);\r\n        var u = fl != file.filename.length || (o && (com.length != o.length));\r\n        var hl = fl + exfl(file.extra) + 30;\r\n        if (fl > 65535)\r\n            throw 'filename too long';\r\n        var header = new u8(hl);\r\n        wzh(header, 0, file, f, u);\r\n        var chks = [header];\r\n        var pAll = function () {\r\n            for (var _i = 0, chks_1 = chks; _i < chks_1.length; _i++) {\r\n                var chk = chks_1[_i];\r\n                _this_1.ondata(null, chk, false);\r\n            }\r\n            chks = [];\r\n        };\r\n        var tr = this.d;\r\n        this.d = 0;\r\n        var ind = this.u.length;\r\n        var uf = mrg(file, {\r\n            f: f,\r\n            u: u,\r\n            o: o,\r\n            t: function () {\r\n                if (file.terminate)\r\n                    file.terminate();\r\n            },\r\n            r: function () {\r\n                pAll();\r\n                if (tr) {\r\n                    var nxt = _this_1.u[ind + 1];\r\n                    if (nxt)\r\n                        nxt.r();\r\n                    else\r\n                        _this_1.d = 1;\r\n                }\r\n                tr = 1;\r\n            }\r\n        });\r\n        var cl = 0;\r\n        file.ondata = function (err, dat, final) {\r\n            if (err) {\r\n                _this_1.ondata(err, dat, final);\r\n                _this_1.terminate();\r\n            }\r\n            else {\r\n                cl += dat.length;\r\n                chks.push(dat);\r\n                if (final) {\r\n                    var dd = new u8(16);\r\n                    wbytes(dd, 0, 0x8074B50);\r\n                    wbytes(dd, 4, file.crc);\r\n                    wbytes(dd, 8, cl);\r\n                    wbytes(dd, 12, file.size);\r\n                    chks.push(dd);\r\n                    uf.c = cl, uf.b = hl + cl + 16, uf.crc = file.crc, uf.size = file.size;\r\n                    if (tr)\r\n                        uf.r();\r\n                    tr = 1;\r\n                }\r\n                else if (tr)\r\n                    pAll();\r\n            }\r\n        };\r\n        this.u.push(uf);\r\n    };\r\n    /**\r\n     * Ends the process of adding files and prepares to emit the final chunks.\r\n     * This *must* be called after adding all desired files for the resulting\r\n     * ZIP file to work properly.\r\n     */\r\n    Zip.prototype.end = function () {\r\n        var _this_1 = this;\r\n        if (this.d & 2) {\r\n            if (this.d & 1)\r\n                throw 'stream finishing';\r\n            throw 'stream finished';\r\n        }\r\n        if (this.d)\r\n            this.e();\r\n        else\r\n            this.u.push({\r\n                r: function () {\r\n                    if (!(_this_1.d & 1))\r\n                        return;\r\n                    _this_1.u.splice(-1, 1);\r\n                    _this_1.e();\r\n                },\r\n                t: function () { }\r\n            });\r\n        this.d = 3;\r\n    };\r\n    Zip.prototype.e = function () {\r\n        var bt = 0, l = 0, tl = 0;\r\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\r\n            var f = _a[_i];\r\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\r\n        }\r\n        var out = new u8(tl + 22);\r\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\r\n            var f = _c[_b];\r\n            wzh(out, bt, f, f.f, f.u, f.c, l, f.o);\r\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\r\n        }\r\n        wzf(out, bt, this.u.length, tl, l);\r\n        this.ondata(null, out, true);\r\n        this.d = 2;\r\n    };\r\n    /**\r\n     * A method to terminate any internal workers used by the stream. Subsequent\r\n     * calls to add() will fail.\r\n     */\r\n    Zip.prototype.terminate = function () {\r\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\r\n            var f = _a[_i];\r\n            f.t();\r\n        }\r\n        this.d = 2;\r\n    };\r\n    return Zip;\r\n}());\r\nexport { Zip };\r\nexport function zip(data, opts, cb) {\r\n    if (!cb)\r\n        cb = opts, opts = {};\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    var r = {};\r\n    fltn(data, '', r, opts);\r\n    var k = Object.keys(r);\r\n    var lft = k.length, o = 0, tot = 0;\r\n    var slft = lft, files = new Array(lft);\r\n    var term = [];\r\n    var tAll = function () {\r\n        for (var i = 0; i < term.length; ++i)\r\n            term[i]();\r\n    };\r\n    var cbf = function () {\r\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\r\n        tot = 0;\r\n        for (var i = 0; i < slft; ++i) {\r\n            var f = files[i];\r\n            try {\r\n                var l = f.c.length;\r\n                wzh(out, tot, f, f.f, f.u, l);\r\n                var badd = 30 + f.f.length + exfl(f.extra);\r\n                var loc = tot + badd;\r\n                out.set(f.c, loc);\r\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\r\n            }\r\n            catch (e) {\r\n                return cb(e, null);\r\n            }\r\n        }\r\n        wzf(out, o, files.length, cdl, oe);\r\n        cb(null, out);\r\n    };\r\n    if (!lft)\r\n        cbf();\r\n    var _loop_1 = function (i) {\r\n        var fn = k[i];\r\n        var _a = r[fn], file = _a[0], p = _a[1];\r\n        var c = crc(), size = file.length;\r\n        c.p(file);\r\n        var f = strToU8(fn), s = f.length;\r\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\r\n        var exl = exfl(p.extra);\r\n        var compression = p.level == 0 ? 0 : 8;\r\n        var cbl = function (e, d) {\r\n            if (e) {\r\n                tAll();\r\n                cb(e, null);\r\n            }\r\n            else {\r\n                var l = d.length;\r\n                files[i] = mrg(p, {\r\n                    size: size,\r\n                    crc: c.d(),\r\n                    c: d,\r\n                    f: f,\r\n                    m: m,\r\n                    u: s != fn.length || (m && (com.length != ms)),\r\n                    compression: compression\r\n                });\r\n                o += 30 + s + exl + l;\r\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\r\n                if (!--lft)\r\n                    cbf();\r\n            }\r\n        };\r\n        if (s > 65535)\r\n            cbl('filename too long', null);\r\n        if (!compression)\r\n            cbl(null, file);\r\n        else if (size < 160000) {\r\n            try {\r\n                cbl(null, deflateSync(file, p));\r\n            }\r\n            catch (e) {\r\n                cbl(e, null);\r\n            }\r\n        }\r\n        else\r\n            term.push(deflate(file, p, cbl));\r\n    };\r\n    // Cannot use lft because it can decrease\r\n    for (var i = 0; i < slft; ++i) {\r\n        _loop_1(i);\r\n    }\r\n    return tAll;\r\n}\r\n/**\r\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\r\n * with more than one file.\r\n * @param data The directory structure for the ZIP archive\r\n * @param opts The main options, merged with per-file options\r\n * @returns The generated ZIP archive\r\n */\r\nexport function zipSync(data, opts) {\r\n    if (!opts)\r\n        opts = {};\r\n    var r = {};\r\n    var files = [];\r\n    fltn(data, '', r, opts);\r\n    var o = 0;\r\n    var tot = 0;\r\n    for (var fn in r) {\r\n        var _a = r[fn], file = _a[0], p = _a[1];\r\n        var compression = p.level == 0 ? 0 : 8;\r\n        var f = strToU8(fn), s = f.length;\r\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\r\n        var exl = exfl(p.extra);\r\n        if (s > 65535)\r\n            throw 'filename too long';\r\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\r\n        var c = crc();\r\n        c.p(file);\r\n        files.push(mrg(p, {\r\n            size: file.length,\r\n            crc: c.d(),\r\n            c: d,\r\n            f: f,\r\n            m: m,\r\n            u: s != fn.length || (m && (com.length != ms)),\r\n            o: o,\r\n            compression: compression\r\n        }));\r\n        o += 30 + s + exl + l;\r\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\r\n    }\r\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\r\n    for (var i = 0; i < files.length; ++i) {\r\n        var f = files[i];\r\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\r\n        var badd = 30 + f.f.length + exfl(f.extra);\r\n        out.set(f.c, f.o + badd);\r\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\r\n    }\r\n    wzf(out, o, files.length, cdl, oe);\r\n    return out;\r\n}\r\n/**\r\n * Streaming pass-through decompression for ZIP archives\r\n */\r\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\r\n    function UnzipPassThrough() {\r\n    }\r\n    UnzipPassThrough.prototype.push = function (data, final) {\r\n        this.ondata(null, data, final);\r\n    };\r\n    UnzipPassThrough.compression = 0;\r\n    return UnzipPassThrough;\r\n}());\r\nexport { UnzipPassThrough };\r\n/**\r\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\r\n * better performance.\r\n */\r\nvar UnzipInflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a DEFLATE decompression that can be used in ZIP archives\r\n     */\r\n    function UnzipInflate() {\r\n        var _this_1 = this;\r\n        this.i = new Inflate(function (dat, final) {\r\n            _this_1.ondata(null, dat, final);\r\n        });\r\n    }\r\n    UnzipInflate.prototype.push = function (data, final) {\r\n        try {\r\n            this.i.push(data, final);\r\n        }\r\n        catch (e) {\r\n            this.ondata(e, data, final);\r\n        }\r\n    };\r\n    UnzipInflate.compression = 8;\r\n    return UnzipInflate;\r\n}());\r\nexport { UnzipInflate };\r\n/**\r\n * Asynchronous streaming DEFLATE decompression for ZIP archives\r\n */\r\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a DEFLATE decompression that can be used in ZIP archives\r\n     */\r\n    function AsyncUnzipInflate(_, sz) {\r\n        var _this_1 = this;\r\n        if (sz < 320000) {\r\n            this.i = new Inflate(function (dat, final) {\r\n                _this_1.ondata(null, dat, final);\r\n            });\r\n        }\r\n        else {\r\n            this.i = new AsyncInflate(function (err, dat, final) {\r\n                _this_1.ondata(err, dat, final);\r\n            });\r\n            this.terminate = this.i.terminate;\r\n        }\r\n    }\r\n    AsyncUnzipInflate.prototype.push = function (data, final) {\r\n        if (this.i.terminate)\r\n            data = slc(data, 0);\r\n        this.i.push(data, final);\r\n    };\r\n    AsyncUnzipInflate.compression = 8;\r\n    return AsyncUnzipInflate;\r\n}());\r\nexport { AsyncUnzipInflate };\r\n/**\r\n * A ZIP archive decompression stream that emits files as they are discovered\r\n */\r\nvar Unzip = /*#__PURE__*/ (function () {\r\n    /**\r\n     * Creates a ZIP decompression stream\r\n     * @param cb The callback to call whenever a file in the ZIP archive is found\r\n     */\r\n    function Unzip(cb) {\r\n        this.onfile = cb;\r\n        this.k = [];\r\n        this.o = {\r\n            0: UnzipPassThrough\r\n        };\r\n        this.p = et;\r\n    }\r\n    /**\r\n     * Pushes a chunk to be unzipped\r\n     * @param chunk The chunk to push\r\n     * @param final Whether this is the last chunk\r\n     */\r\n    Unzip.prototype.push = function (chunk, final) {\r\n        var _this_1 = this;\r\n        if (!this.onfile)\r\n            throw 'no callback';\r\n        if (!this.p)\r\n            throw 'stream finished';\r\n        if (this.c > 0) {\r\n            var len = Math.min(this.c, chunk.length);\r\n            var toAdd = chunk.subarray(0, len);\r\n            this.c -= len;\r\n            if (this.d)\r\n                this.d.push(toAdd, !this.c);\r\n            else\r\n                this.k[0].push(toAdd);\r\n            chunk = chunk.subarray(len);\r\n            if (chunk.length)\r\n                return this.push(chunk, final);\r\n        }\r\n        else {\r\n            var f = 0, i = 0, is = void 0, buf = void 0;\r\n            if (!this.p.length)\r\n                buf = chunk;\r\n            else if (!chunk.length)\r\n                buf = this.p;\r\n            else {\r\n                buf = new u8(this.p.length + chunk.length);\r\n                buf.set(this.p), buf.set(chunk, this.p.length);\r\n            }\r\n            var l = buf.length, oc = this.c, add = oc && this.d;\r\n            var _loop_2 = function () {\r\n                var _a;\r\n                var sig = b4(buf, i);\r\n                if (sig == 0x4034B50) {\r\n                    f = 1, is = i;\r\n                    this_1.d = null;\r\n                    this_1.c = 0;\r\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\r\n                    if (l > i + 30 + fnl + es) {\r\n                        var chks_2 = [];\r\n                        this_1.k.unshift(chks_2);\r\n                        f = 2;\r\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\r\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\r\n                        if (sc_1 == 4294967295) {\r\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\r\n                        }\r\n                        else if (dd)\r\n                            sc_1 = -1;\r\n                        i += es;\r\n                        this_1.c = sc_1;\r\n                        var d_1;\r\n                        var file_1 = {\r\n                            name: fn_1,\r\n                            compression: cmp_1,\r\n                            start: function () {\r\n                                if (!file_1.ondata)\r\n                                    throw 'no callback';\r\n                                if (!sc_1)\r\n                                    file_1.ondata(null, et, true);\r\n                                else {\r\n                                    var ctr = _this_1.o[cmp_1];\r\n                                    if (!ctr)\r\n                                        throw 'unknown compression type ' + cmp_1;\r\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\r\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\r\n                                    for (var _i = 0, chks_3 = chks_2; _i < chks_3.length; _i++) {\r\n                                        var dat = chks_3[_i];\r\n                                        d_1.push(dat, false);\r\n                                    }\r\n                                    if (_this_1.k[0] == chks_2 && _this_1.c)\r\n                                        _this_1.d = d_1;\r\n                                    else\r\n                                        d_1.push(et, true);\r\n                                }\r\n                            },\r\n                            terminate: function () {\r\n                                if (d_1 && d_1.terminate)\r\n                                    d_1.terminate();\r\n                            }\r\n                        };\r\n                        if (sc_1 >= 0)\r\n                            file_1.size = sc_1, file_1.originalSize = su_1;\r\n                        this_1.onfile(file_1);\r\n                    }\r\n                    return \"break\";\r\n                }\r\n                else if (oc) {\r\n                    if (sig == 0x8074B50) {\r\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\r\n                        return \"break\";\r\n                    }\r\n                    else if (sig == 0x2014B50) {\r\n                        is = i -= 4, f = 3, this_1.c = 0;\r\n                        return \"break\";\r\n                    }\r\n                }\r\n            };\r\n            var this_1 = this;\r\n            for (; i < l - 4; ++i) {\r\n                var state_1 = _loop_2();\r\n                if (state_1 === \"break\")\r\n                    break;\r\n            }\r\n            this.p = et;\r\n            if (oc < 0) {\r\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\r\n                if (add)\r\n                    add.push(dat, !!f);\r\n                else\r\n                    this.k[+(f == 2)].push(dat);\r\n            }\r\n            if (f & 2)\r\n                return this.push(buf.subarray(i), final);\r\n            this.p = buf.subarray(i);\r\n        }\r\n        if (final) {\r\n            if (this.c)\r\n                throw 'invalid zip file';\r\n            this.p = null;\r\n        }\r\n    };\r\n    /**\r\n     * Registers a decoder with the stream, allowing for files compressed with\r\n     * the compression type provided to be expanded correctly\r\n     * @param decoder The decoder constructor\r\n     */\r\n    Unzip.prototype.register = function (decoder) {\r\n        this.o[decoder.compression] = decoder;\r\n    };\r\n    return Unzip;\r\n}());\r\nexport { Unzip };\r\n/**\r\n * Asynchronously decompresses a ZIP archive\r\n * @param data The raw compressed ZIP file\r\n * @param cb The callback to call with the decompressed files\r\n * @returns A function that can be used to immediately terminate the unzipping\r\n */\r\nexport function unzip(data, cb) {\r\n    if (typeof cb != 'function')\r\n        throw 'no callback';\r\n    var term = [];\r\n    var tAll = function () {\r\n        for (var i = 0; i < term.length; ++i)\r\n            term[i]();\r\n    };\r\n    var files = {};\r\n    var e = data.length - 22;\r\n    for (; b4(data, e) != 0x6054B50; --e) {\r\n        if (!e || data.length - e > 65558) {\r\n            cb('invalid zip file', null);\r\n            return;\r\n        }\r\n    }\r\n    ;\r\n    var lft = b2(data, e + 8);\r\n    if (!lft)\r\n        cb(null, {});\r\n    var c = lft;\r\n    var o = b4(data, e + 16);\r\n    var z = o == 4294967295;\r\n    if (z) {\r\n        e = b4(data, e - 12);\r\n        if (b4(data, e) != 0x6064B50) {\r\n            cb('invalid zip file', null);\r\n            return;\r\n        }\r\n        c = lft = b4(data, e + 32);\r\n        o = b4(data, e + 48);\r\n    }\r\n    var _loop_3 = function (i) {\r\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\r\n        o = no;\r\n        var cbl = function (e, d) {\r\n            if (e) {\r\n                tAll();\r\n                cb(e, null);\r\n            }\r\n            else {\r\n                files[fn] = d;\r\n                if (!--lft)\r\n                    cb(null, files);\r\n            }\r\n        };\r\n        if (!c_1)\r\n            cbl(null, slc(data, b, b + sc));\r\n        else if (c_1 == 8) {\r\n            var infl = data.subarray(b, b + sc);\r\n            if (sc < 320000) {\r\n                try {\r\n                    cbl(null, inflateSync(infl, new u8(su)));\r\n                }\r\n                catch (e) {\r\n                    cbl(e, null);\r\n                }\r\n            }\r\n            else\r\n                term.push(inflate(infl, { size: su }, cbl));\r\n        }\r\n        else\r\n            cbl('unknown compression type ' + c_1, null);\r\n    };\r\n    for (var i = 0; i < c; ++i) {\r\n        _loop_3(i);\r\n    }\r\n    return tAll;\r\n}\r\n/**\r\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\r\n * performance with more than one file.\r\n * @param data The raw compressed ZIP file\r\n * @returns The decompressed files\r\n */\r\nexport function unzipSync(data) {\r\n    var files = {};\r\n    var e = data.length - 22;\r\n    for (; b4(data, e) != 0x6054B50; --e) {\r\n        if (!e || data.length - e > 65558)\r\n            throw 'invalid zip file';\r\n    }\r\n    ;\r\n    var c = b2(data, e + 8);\r\n    if (!c)\r\n        return {};\r\n    var o = b4(data, e + 16);\r\n    var z = o == 4294967295;\r\n    if (z) {\r\n        e = b4(data, e - 12);\r\n        if (b4(data, e) != 0x6064B50)\r\n            throw 'invalid zip file';\r\n        c = b4(data, e + 32);\r\n        o = b4(data, e + 48);\r\n    }\r\n    for (var i = 0; i < c; ++i) {\r\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\r\n        o = no;\r\n        if (!c_2)\r\n            files[fn] = slc(data, b, b + sc);\r\n        else if (c_2 == 8)\r\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\r\n        else\r\n            throw 'unknown compression type ' + c_2;\r\n    }\r\n    return files;\r\n}","import {\r\n\tAmbientLight,\r\n\tAnimationClip,\r\n\tBone,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tEquirectangularReflectionMapping,\r\n\tEuler,\r\n\tFileLoader,\r\n\tFloat32BufferAttribute,\r\n\tGroup,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMathUtils,\r\n\tMatrix3,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshLambertMaterial,\r\n\tMeshPhongMaterial,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPropertyBinding,\r\n\tQuaternion,\r\n\tQuaternionKeyframeTrack,\r\n\tRepeatWrapping,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSpotLight,\r\n\tTexture,\r\n\tTextureLoader,\r\n\tUint16BufferAttribute,\r\n\tVector3,\r\n\tVector4,\r\n\tVectorKeyframeTrack,\r\n\tsRGBEncoding\r\n} from 'three';\r\nimport * as fflate from '../libs/fflate.module.js';\r\nimport { NURBSCurve } from '../curves/NURBSCurve';\r\n\r\n/**\r\n * Loader loads FBX file and generates Group representing FBX scene.\r\n * Requires FBX file to be >= 7.0 and in ASCII or >= 6400 in Binary format\r\n * Versions lower than this may load but will probably have errors\r\n *\r\n * Needs Support:\r\n *  Morph normals / blend shape normals\r\n *\r\n * FBX format references:\r\n * \thttps://wiki.blender.org/index.php/User:Mont29/Foundation/FBX_File_Structure\r\n * \thttp://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_index_html (C++ SDK reference)\r\n *\r\n * \tBinary format specification:\r\n *\t\thttps://code.blender.org/2013/08/fbx-binary-file-format-specification/\r\n */\r\n\r\n\r\nlet fbxTree;\r\nlet connections;\r\nlet sceneGraph;\r\n\r\nclass FBXLoader extends Loader {\r\n\r\n\tconstructor( manager ) {\r\n\r\n\t\tsuper( manager );\r\n\r\n\t}\r\n\r\n\tload( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tconst path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\r\n\r\n\t\tconst loader = new FileLoader( this.manager );\r\n\t\tloader.setPath( scope.path );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\t\tloader.setRequestHeader( scope.requestHeader );\r\n\t\tloader.setWithCredentials( scope.withCredentials );\r\n\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tonLoad( scope.parse( buffer, path ) );\r\n\r\n\t\t\t} catch ( e ) {\r\n\r\n\t\t\t\tif ( onError ) {\r\n\r\n\t\t\t\t\tonError( e );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( e );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t}\r\n\r\n\tparse( FBXBuffer, path ) {\r\n\r\n\t\tif ( isFbxFormatBinary( FBXBuffer ) ) {\r\n\r\n\t\t\tfbxTree = new BinaryParser().parse( FBXBuffer );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst FBXText = convertArrayBufferToString( FBXBuffer );\r\n\r\n\t\t\tif ( ! isFbxFormatASCII( FBXText ) ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown format.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( getFbxVersion( FBXText ) < 7000 ) {\r\n\r\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + getFbxVersion( FBXText ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfbxTree = new TextParser().parse( FBXText );\r\n\r\n\t\t}\r\n\r\n\t\t// console.log( fbxTree );\r\n\r\n\t\tconst textureLoader = new TextureLoader( this.manager ).setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\r\n\r\n\t\treturn new FBXTreeParser( textureLoader, this.manager ).parse( fbxTree );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Parse the FBXTree object returned by the BinaryParser or TextParser and return a Group\r\nclass FBXTreeParser {\r\n\r\n\tconstructor( textureLoader, manager ) {\r\n\r\n\t\tthis.textureLoader = textureLoader;\r\n\t\tthis.manager = manager;\r\n\r\n\t}\r\n\r\n\tparse() {\r\n\r\n\t\tconnections = this.parseConnections();\r\n\r\n\t\tconst images = this.parseImages();\r\n\t\tconst textures = this.parseTextures( images );\r\n\t\tconst materials = this.parseMaterials( textures );\r\n\t\tconst deformers = this.parseDeformers();\r\n\t\tconst geometryMap = new GeometryParser().parse( deformers );\r\n\r\n\t\tthis.parseScene( deformers, geometryMap, materials );\r\n\r\n\t\treturn sceneGraph;\r\n\r\n\t}\r\n\r\n\t// Parses FBXTree.Connections which holds parent-child connections between objects (e.g. material -> texture, model->geometry )\r\n\t// and details the connection type\r\n\tparseConnections() {\r\n\r\n\t\tconst connectionMap = new Map();\r\n\r\n\t\tif ( 'Connections' in fbxTree ) {\r\n\r\n\t\t\tconst rawConnections = fbxTree.Connections.connections;\r\n\r\n\t\t\trawConnections.forEach( function ( rawConnection ) {\r\n\r\n\t\t\t\tconst fromID = rawConnection[ 0 ];\r\n\t\t\t\tconst toID = rawConnection[ 1 ];\r\n\t\t\t\tconst relationship = rawConnection[ 2 ];\r\n\r\n\t\t\t\tif ( ! connectionMap.has( fromID ) ) {\r\n\r\n\t\t\t\t\tconnectionMap.set( fromID, {\r\n\t\t\t\t\t\tparents: [],\r\n\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst parentRelationship = { ID: toID, relationship: relationship };\r\n\t\t\t\tconnectionMap.get( fromID ).parents.push( parentRelationship );\r\n\r\n\t\t\t\tif ( ! connectionMap.has( toID ) ) {\r\n\r\n\t\t\t\t\tconnectionMap.set( toID, {\r\n\t\t\t\t\t\tparents: [],\r\n\t\t\t\t\t\tchildren: []\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst childRelationship = { ID: fromID, relationship: relationship };\r\n\t\t\t\tconnectionMap.get( toID ).children.push( childRelationship );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn connectionMap;\r\n\r\n\t}\r\n\r\n\t// Parse FBXTree.Objects.Video for embedded image data\r\n\t// These images are connected to textures in FBXTree.Objects.Textures\r\n\t// via FBXTree.Connections.\r\n\tparseImages() {\r\n\r\n\t\tconst images = {};\r\n\t\tconst blobs = {};\r\n\r\n\t\tif ( 'Video' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst videoNodes = fbxTree.Objects.Video;\r\n\r\n\t\t\tfor ( const nodeID in videoNodes ) {\r\n\r\n\t\t\t\tconst videoNode = videoNodes[ nodeID ];\r\n\r\n\t\t\t\tconst id = parseInt( nodeID );\r\n\r\n\t\t\t\timages[ id ] = videoNode.RelativeFilename || videoNode.Filename;\r\n\r\n\t\t\t\t// raw image data is in videoNode.Content\r\n\t\t\t\tif ( 'Content' in videoNode ) {\r\n\r\n\t\t\t\t\tconst arrayBufferContent = ( videoNode.Content instanceof ArrayBuffer ) && ( videoNode.Content.byteLength > 0 );\r\n\t\t\t\t\tconst base64Content = ( typeof videoNode.Content === 'string' ) && ( videoNode.Content !== '' );\r\n\r\n\t\t\t\t\tif ( arrayBufferContent || base64Content ) {\r\n\r\n\t\t\t\t\t\tconst image = this.parseImage( videoNodes[ nodeID ] );\r\n\r\n\t\t\t\t\t\tblobs[ videoNode.RelativeFilename || videoNode.Filename ] = image;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( const id in images ) {\r\n\r\n\t\t\tconst filename = images[ id ];\r\n\r\n\t\t\tif ( blobs[ filename ] !== undefined ) images[ id ] = blobs[ filename ];\r\n\t\t\telse images[ id ] = images[ id ].split( '\\\\' ).pop();\r\n\r\n\t\t}\r\n\r\n\t\treturn images;\r\n\r\n\t}\r\n\r\n\t// Parse embedded image data in FBXTree.Video.Content\r\n\tparseImage( videoNode ) {\r\n\r\n\t\tconst content = videoNode.Content;\r\n\t\tconst fileName = videoNode.RelativeFilename || videoNode.Filename;\r\n\t\tconst extension = fileName.slice( fileName.lastIndexOf( '.' ) + 1 ).toLowerCase();\r\n\r\n\t\tlet type;\r\n\r\n\t\tswitch ( extension ) {\r\n\r\n\t\t\tcase 'bmp':\r\n\r\n\t\t\t\ttype = 'image/bmp';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'jpg':\r\n\t\t\tcase 'jpeg':\r\n\r\n\t\t\t\ttype = 'image/jpeg';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'png':\r\n\r\n\t\t\t\ttype = 'image/png';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'tif':\r\n\r\n\t\t\t\ttype = 'image/tiff';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'tga':\r\n\r\n\t\t\t\tif ( this.manager.getHandler( '.tga' ) === null ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, skipping ', fileName );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttype = 'image/tga';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tconsole.warn( 'FBXLoader: Image type \"' + extension + '\" is not supported.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( typeof content === 'string' ) { // ASCII format\r\n\r\n\t\t\treturn 'data:' + type + ';base64,' + content;\r\n\r\n\t\t} else { // Binary Format\r\n\r\n\t\t\tconst array = new Uint8Array( content );\r\n\t\t\treturn window.URL.createObjectURL( new Blob( [ array ], { type: type } ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Parse nodes in FBXTree.Objects.Texture\r\n\t// These contain details such as UV scaling, cropping, rotation etc and are connected\r\n\t// to images in FBXTree.Objects.Video\r\n\tparseTextures( images ) {\r\n\r\n\t\tconst textureMap = new Map();\r\n\r\n\t\tif ( 'Texture' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst textureNodes = fbxTree.Objects.Texture;\r\n\t\t\tfor ( const nodeID in textureNodes ) {\r\n\r\n\t\t\t\tconst texture = this.parseTexture( textureNodes[ nodeID ], images );\r\n\t\t\t\ttextureMap.set( parseInt( nodeID ), texture );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn textureMap;\r\n\r\n\t}\r\n\r\n\t// Parse individual node in FBXTree.Objects.Texture\r\n\tparseTexture( textureNode, images ) {\r\n\r\n\t\tconst texture = this.loadTexture( textureNode, images );\r\n\r\n\t\ttexture.ID = textureNode.id;\r\n\r\n\t\ttexture.name = textureNode.attrName;\r\n\r\n\t\tconst wrapModeU = textureNode.WrapModeU;\r\n\t\tconst wrapModeV = textureNode.WrapModeV;\r\n\r\n\t\tconst valueU = wrapModeU !== undefined ? wrapModeU.value : 0;\r\n\t\tconst valueV = wrapModeV !== undefined ? wrapModeV.value : 0;\r\n\r\n\t\t// http://download.autodesk.com/us/fbx/SDKdocs/FBX_SDK_Help/files/fbxsdkref/class_k_fbx_texture.html#889640e63e2e681259ea81061b85143a\r\n\t\t// 0: repeat(default), 1: clamp\r\n\r\n\t\ttexture.wrapS = valueU === 0 ? RepeatWrapping : ClampToEdgeWrapping;\r\n\t\ttexture.wrapT = valueV === 0 ? RepeatWrapping : ClampToEdgeWrapping;\r\n\r\n\t\tif ( 'Scaling' in textureNode ) {\r\n\r\n\t\t\tconst values = textureNode.Scaling.value;\r\n\r\n\t\t\ttexture.repeat.x = values[ 0 ];\r\n\t\t\ttexture.repeat.y = values[ 1 ];\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\t// load a texture specified as a blob or data URI, or via an external URL using TextureLoader\r\n\tloadTexture( textureNode, images ) {\r\n\r\n\t\tlet fileName;\r\n\r\n\t\tconst currentPath = this.textureLoader.path;\r\n\r\n\t\tconst children = connections.get( textureNode.id ).children;\r\n\r\n\t\tif ( children !== undefined && children.length > 0 && images[ children[ 0 ].ID ] !== undefined ) {\r\n\r\n\t\t\tfileName = images[ children[ 0 ].ID ];\r\n\r\n\t\t\tif ( fileName.indexOf( 'blob:' ) === 0 || fileName.indexOf( 'data:' ) === 0 ) {\r\n\r\n\t\t\t\tthis.textureLoader.setPath( undefined );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet texture;\r\n\r\n\t\tconst extension = textureNode.FileName.slice( - 3 ).toLowerCase();\r\n\r\n\t\tif ( extension === 'tga' ) {\r\n\r\n\t\t\tconst loader = this.manager.getHandler( '.tga' );\r\n\r\n\t\t\tif ( loader === null ) {\r\n\r\n\t\t\t\tconsole.warn( 'FBXLoader: TGA loader not found, creating placeholder texture for', textureNode.RelativeFilename );\r\n\t\t\t\ttexture = new Texture();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tloader.setPath( this.textureLoader.path );\r\n\t\t\t\ttexture = loader.load( fileName );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( extension === 'psd' ) {\r\n\r\n\t\t\tconsole.warn( 'FBXLoader: PSD textures are not supported, creating placeholder texture for', textureNode.RelativeFilename );\r\n\t\t\ttexture = new Texture();\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttexture = this.textureLoader.load( fileName );\r\n\r\n\t\t}\r\n\r\n\t\tthis.textureLoader.setPath( currentPath );\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\t// Parse nodes in FBXTree.Objects.Material\r\n\tparseMaterials( textureMap ) {\r\n\r\n\t\tconst materialMap = new Map();\r\n\r\n\t\tif ( 'Material' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst materialNodes = fbxTree.Objects.Material;\r\n\r\n\t\t\tfor ( const nodeID in materialNodes ) {\r\n\r\n\t\t\t\tconst material = this.parseMaterial( materialNodes[ nodeID ], textureMap );\r\n\r\n\t\t\t\tif ( material !== null ) materialMap.set( parseInt( nodeID ), material );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn materialMap;\r\n\r\n\t}\r\n\r\n\t// Parse single node in FBXTree.Objects.Material\r\n\t// Materials are connected to texture maps in FBXTree.Objects.Textures\r\n\t// FBX format currently only supports Lambert and Phong shading models\r\n\tparseMaterial( materialNode, textureMap ) {\r\n\r\n\t\tconst ID = materialNode.id;\r\n\t\tconst name = materialNode.attrName;\r\n\t\tlet type = materialNode.ShadingModel;\r\n\r\n\t\t// Case where FBX wraps shading model in property object.\r\n\t\tif ( typeof type === 'object' ) {\r\n\r\n\t\t\ttype = type.value;\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore unused materials which don't have any connections.\r\n\t\tif ( ! connections.has( ID ) ) return null;\r\n\r\n\t\tconst parameters = this.parseParameters( materialNode, textureMap, ID );\r\n\r\n\t\tlet material;\r\n\r\n\t\tswitch ( type.toLowerCase() ) {\r\n\r\n\t\t\tcase 'phong':\r\n\t\t\t\tmaterial = new MeshPhongMaterial();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'lambert':\r\n\t\t\t\tmaterial = new MeshLambertMaterial();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: unknown material type \"%s\". Defaulting to MeshPhongMaterial.', type );\r\n\t\t\t\tmaterial = new MeshPhongMaterial();\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tmaterial.setValues( parameters );\r\n\t\tmaterial.name = name;\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n\t// Parse FBX material and return parameters suitable for a three.js material\r\n\t// Also parse the texture map and return any textures associated with the material\r\n\tparseParameters( materialNode, textureMap, ID ) {\r\n\r\n\t\tconst parameters = {};\r\n\r\n\t\tif ( materialNode.BumpFactor ) {\r\n\r\n\t\t\tparameters.bumpScale = materialNode.BumpFactor.value;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.Diffuse ) {\r\n\r\n\t\t\tparameters.color = new Color().fromArray( materialNode.Diffuse.value );\r\n\r\n\t\t} else if ( materialNode.DiffuseColor && ( materialNode.DiffuseColor.type === 'Color' || materialNode.DiffuseColor.type === 'ColorRGB' ) ) {\r\n\r\n\t\t\t// The blender exporter exports diffuse here instead of in materialNode.Diffuse\r\n\t\t\tparameters.color = new Color().fromArray( materialNode.DiffuseColor.value );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.DisplacementFactor ) {\r\n\r\n\t\t\tparameters.displacementScale = materialNode.DisplacementFactor.value;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.Emissive ) {\r\n\r\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.Emissive.value );\r\n\r\n\t\t} else if ( materialNode.EmissiveColor && ( materialNode.EmissiveColor.type === 'Color' || materialNode.EmissiveColor.type === 'ColorRGB' ) ) {\r\n\r\n\t\t\t// The blender exporter exports emissive color here instead of in materialNode.Emissive\r\n\t\t\tparameters.emissive = new Color().fromArray( materialNode.EmissiveColor.value );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.EmissiveFactor ) {\r\n\r\n\t\t\tparameters.emissiveIntensity = parseFloat( materialNode.EmissiveFactor.value );\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.Opacity ) {\r\n\r\n\t\t\tparameters.opacity = parseFloat( materialNode.Opacity.value );\r\n\r\n\t\t}\r\n\r\n\t\tif ( parameters.opacity < 1.0 ) {\r\n\r\n\t\t\tparameters.transparent = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.ReflectionFactor ) {\r\n\r\n\t\t\tparameters.reflectivity = materialNode.ReflectionFactor.value;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.Shininess ) {\r\n\r\n\t\t\tparameters.shininess = materialNode.Shininess.value;\r\n\r\n\t\t}\r\n\r\n\t\tif ( materialNode.Specular ) {\r\n\r\n\t\t\tparameters.specular = new Color().fromArray( materialNode.Specular.value );\r\n\r\n\t\t} else if ( materialNode.SpecularColor && materialNode.SpecularColor.type === 'Color' ) {\r\n\r\n\t\t\t// The blender exporter exports specular color here instead of in materialNode.Specular\r\n\t\t\tparameters.specular = new Color().fromArray( materialNode.SpecularColor.value );\r\n\r\n\t\t}\r\n\r\n\t\tconst scope = this;\r\n\t\tconnections.get( ID ).children.forEach( function ( child ) {\r\n\r\n\t\t\tconst type = child.relationship;\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 'Bump':\r\n\t\t\t\t\tparameters.bumpMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Maya|TEX_ao_map':\r\n\t\t\t\t\tparameters.aoMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'DiffuseColor':\r\n\t\t\t\tcase 'Maya|TEX_color_map':\r\n\t\t\t\t\tparameters.map = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tif ( parameters.map !== undefined ) {\r\n\r\n\t\t\t\t\t\tparameters.map.encoding = sRGBEncoding;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'DisplacementColor':\r\n\t\t\t\t\tparameters.displacementMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'EmissiveColor':\r\n\t\t\t\t\tparameters.emissiveMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tif ( parameters.emissiveMap !== undefined ) {\r\n\r\n\t\t\t\t\t\tparameters.emissiveMap.encoding = sRGBEncoding;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'NormalMap':\r\n\t\t\t\tcase 'Maya|TEX_normal_map':\r\n\t\t\t\t\tparameters.normalMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ReflectionColor':\r\n\t\t\t\t\tparameters.envMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tif ( parameters.envMap !== undefined ) {\r\n\r\n\t\t\t\t\t\tparameters.envMap.mapping = EquirectangularReflectionMapping;\r\n\t\t\t\t\t\tparameters.envMap.encoding = sRGBEncoding;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'SpecularColor':\r\n\t\t\t\t\tparameters.specularMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tif ( parameters.specularMap !== undefined ) {\r\n\r\n\t\t\t\t\t\tparameters.specularMap.encoding = sRGBEncoding;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'TransparentColor':\r\n\t\t\t\tcase 'TransparencyFactor':\r\n\t\t\t\t\tparameters.alphaMap = scope.getTexture( textureMap, child.ID );\r\n\t\t\t\t\tparameters.transparent = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AmbientColor':\r\n\t\t\t\tcase 'ShininessExponent': // AKA glossiness map\r\n\t\t\t\tcase 'SpecularFactor': // AKA specularLevel\r\n\t\t\t\tcase 'VectorDisplacementColor': // NOTE: Seems to be a copy of DisplacementColor\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: %s map is not supported in three.js, skipping texture.', type );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn parameters;\r\n\r\n\t}\r\n\r\n\t// get a texture from the textureMap for use by a material.\r\n\tgetTexture( textureMap, id ) {\r\n\r\n\t\t// if the texture is a layered texture, just use the first layer and issue a warning\r\n\t\tif ( 'LayeredTexture' in fbxTree.Objects && id in fbxTree.Objects.LayeredTexture ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer.' );\r\n\t\t\tid = connections.get( id ).children[ 0 ].ID;\r\n\r\n\t\t}\r\n\r\n\t\tconst texture = textureMap.get( id );\r\n\r\n\t\tif ( texture.image !== undefined ) {\r\n\r\n\t\t\treturn texture;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Parse nodes in FBXTree.Objects.Deformer\r\n\t// Deformer node can contain skinning or Vertex Cache animation data, however only skinning is supported here\r\n\t// Generates map of Skeleton-like objects for use later when generating and binding skeletons.\r\n\tparseDeformers() {\r\n\r\n\t\tconst skeletons = {};\r\n\t\tconst morphTargets = {};\r\n\r\n\t\tif ( 'Deformer' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst DeformerNodes = fbxTree.Objects.Deformer;\r\n\r\n\t\t\tfor ( const nodeID in DeformerNodes ) {\r\n\r\n\t\t\t\tconst deformerNode = DeformerNodes[ nodeID ];\r\n\r\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\r\n\r\n\t\t\t\tif ( deformerNode.attrType === 'Skin' ) {\r\n\r\n\t\t\t\t\tconst skeleton = this.parseSkeleton( relationships, DeformerNodes );\r\n\t\t\t\t\tskeleton.ID = nodeID;\r\n\r\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: skeleton attached to more than one geometry is not supported.' );\r\n\t\t\t\t\tskeleton.geometryID = relationships.parents[ 0 ].ID;\r\n\r\n\t\t\t\t\tskeletons[ nodeID ] = skeleton;\r\n\r\n\t\t\t\t} else if ( deformerNode.attrType === 'BlendShape' ) {\r\n\r\n\t\t\t\t\tconst morphTarget = {\r\n\t\t\t\t\t\tid: nodeID,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tmorphTarget.rawTargets = this.parseMorphTargets( relationships, DeformerNodes );\r\n\t\t\t\t\tmorphTarget.id = nodeID;\r\n\r\n\t\t\t\t\tif ( relationships.parents.length > 1 ) console.warn( 'THREE.FBXLoader: morph target attached to more than one geometry is not supported.' );\r\n\r\n\t\t\t\t\tmorphTargets[ nodeID ] = morphTarget;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\r\n\t\t\tskeletons: skeletons,\r\n\t\t\tmorphTargets: morphTargets,\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Parse single nodes in FBXTree.Objects.Deformer\r\n\t// The top level skeleton node has type 'Skin' and sub nodes have type 'Cluster'\r\n\t// Each skin node represents a skeleton and each cluster node represents a bone\r\n\tparseSkeleton( relationships, deformerNodes ) {\r\n\r\n\t\tconst rawBones = [];\r\n\r\n\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\tconst boneNode = deformerNodes[ child.ID ];\r\n\r\n\t\t\tif ( boneNode.attrType !== 'Cluster' ) return;\r\n\r\n\t\t\tconst rawBone = {\r\n\r\n\t\t\t\tID: child.ID,\r\n\t\t\t\tindices: [],\r\n\t\t\t\tweights: [],\r\n\t\t\t\ttransformLink: new Matrix4().fromArray( boneNode.TransformLink.a ),\r\n\t\t\t\t// transform: new Matrix4().fromArray( boneNode.Transform.a ),\r\n\t\t\t\t// linkMode: boneNode.Mode,\r\n\r\n\t\t\t};\r\n\r\n\t\t\tif ( 'Indexes' in boneNode ) {\r\n\r\n\t\t\t\trawBone.indices = boneNode.Indexes.a;\r\n\t\t\t\trawBone.weights = boneNode.Weights.a;\r\n\r\n\t\t\t}\r\n\r\n\t\t\trawBones.push( rawBone );\r\n\r\n\t\t} );\r\n\r\n\t\treturn {\r\n\r\n\t\t\trawBones: rawBones,\r\n\t\t\tbones: []\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// The top level morph deformer node has type \"BlendShape\" and sub nodes have type \"BlendShapeChannel\"\r\n\tparseMorphTargets( relationships, deformerNodes ) {\r\n\r\n\t\tconst rawMorphTargets = [];\r\n\r\n\t\tfor ( let i = 0; i < relationships.children.length; i ++ ) {\r\n\r\n\t\t\tconst child = relationships.children[ i ];\r\n\r\n\t\t\tconst morphTargetNode = deformerNodes[ child.ID ];\r\n\r\n\t\t\tconst rawMorphTarget = {\r\n\r\n\t\t\t\tname: morphTargetNode.attrName,\r\n\t\t\t\tinitialWeight: morphTargetNode.DeformPercent,\r\n\t\t\t\tid: morphTargetNode.id,\r\n\t\t\t\tfullWeights: morphTargetNode.FullWeights.a\r\n\r\n\t\t\t};\r\n\r\n\t\t\tif ( morphTargetNode.attrType !== 'BlendShapeChannel' ) return;\r\n\r\n\t\t\trawMorphTarget.geoID = connections.get( parseInt( child.ID ) ).children.filter( function ( child ) {\r\n\r\n\t\t\t\treturn child.relationship === undefined;\r\n\r\n\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\trawMorphTargets.push( rawMorphTarget );\r\n\r\n\t\t}\r\n\r\n\t\treturn rawMorphTargets;\r\n\r\n\t}\r\n\r\n\t// create the main Group() to be returned by the loader\r\n\tparseScene( deformers, geometryMap, materialMap ) {\r\n\r\n\t\tsceneGraph = new Group();\r\n\r\n\t\tconst modelMap = this.parseModels( deformers.skeletons, geometryMap, materialMap );\r\n\r\n\t\tconst modelNodes = fbxTree.Objects.Model;\r\n\r\n\t\tconst scope = this;\r\n\t\tmodelMap.forEach( function ( model ) {\r\n\r\n\t\t\tconst modelNode = modelNodes[ model.ID ];\r\n\t\t\tscope.setLookAtProperties( model, modelNode );\r\n\r\n\t\t\tconst parentConnections = connections.get( model.ID ).parents;\r\n\r\n\t\t\tparentConnections.forEach( function ( connection ) {\r\n\r\n\t\t\t\tconst parent = modelMap.get( connection.ID );\r\n\t\t\t\tif ( parent !== undefined ) parent.add( model );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( model.parent === null ) {\r\n\r\n\t\t\t\tsceneGraph.add( model );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t} );\r\n\r\n\t\tthis.bindSkeleton( deformers.skeletons, geometryMap, modelMap );\r\n\r\n\t\tthis.createAmbientLight();\r\n\r\n\t\tsceneGraph.traverse( function ( node ) {\r\n\r\n\t\t\tif ( node.userData.transformData ) {\r\n\r\n\t\t\t\tif ( node.parent ) {\r\n\r\n\t\t\t\t\tnode.userData.transformData.parentMatrix = node.parent.matrix;\r\n\t\t\t\t\tnode.userData.transformData.parentMatrixWorld = node.parent.matrixWorld;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst transform = generateTransform( node.userData.transformData );\r\n\r\n\t\t\t\tnode.applyMatrix4( transform );\r\n\t\t\t\tnode.updateWorldMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tconst animations = new AnimationParser().parse();\r\n\r\n\t\t// if all the models where already combined in a single group, just return that\r\n\t\tif ( sceneGraph.children.length === 1 && sceneGraph.children[ 0 ].isGroup ) {\r\n\r\n\t\t\tsceneGraph.children[ 0 ].animations = animations;\r\n\t\t\tsceneGraph = sceneGraph.children[ 0 ];\r\n\r\n\t\t}\r\n\r\n\t\tsceneGraph.animations = animations;\r\n\r\n\t}\r\n\r\n\t// parse nodes in FBXTree.Objects.Model\r\n\tparseModels( skeletons, geometryMap, materialMap ) {\r\n\r\n\t\tconst modelMap = new Map();\r\n\t\tconst modelNodes = fbxTree.Objects.Model;\r\n\r\n\t\tfor ( const nodeID in modelNodes ) {\r\n\r\n\t\t\tconst id = parseInt( nodeID );\r\n\t\t\tconst node = modelNodes[ nodeID ];\r\n\t\t\tconst relationships = connections.get( id );\r\n\r\n\t\t\tlet model = this.buildSkeleton( relationships, skeletons, id, node.attrName );\r\n\r\n\t\t\tif ( ! model ) {\r\n\r\n\t\t\t\tswitch ( node.attrType ) {\r\n\r\n\t\t\t\t\tcase 'Camera':\r\n\t\t\t\t\t\tmodel = this.createCamera( relationships );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Light':\r\n\t\t\t\t\t\tmodel = this.createLight( relationships );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Mesh':\r\n\t\t\t\t\t\tmodel = this.createMesh( relationships, geometryMap, materialMap );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'NurbsCurve':\r\n\t\t\t\t\t\tmodel = this.createCurve( relationships, geometryMap );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'LimbNode':\r\n\t\t\t\t\tcase 'Root':\r\n\t\t\t\t\t\tmodel = new Bone();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'Null':\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tmodel = new Group();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmodel.name = node.attrName ? PropertyBinding.sanitizeNodeName( node.attrName ) : '';\r\n\r\n\t\t\t\tmodel.ID = id;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.getTransformData( model, node );\r\n\t\t\tmodelMap.set( id, model );\r\n\r\n\t\t}\r\n\r\n\t\treturn modelMap;\r\n\r\n\t}\r\n\r\n\tbuildSkeleton( relationships, skeletons, id, name ) {\r\n\r\n\t\tlet bone = null;\r\n\r\n\t\trelationships.parents.forEach( function ( parent ) {\r\n\r\n\t\t\tfor ( const ID in skeletons ) {\r\n\r\n\t\t\t\tconst skeleton = skeletons[ ID ];\r\n\r\n\t\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\r\n\r\n\t\t\t\t\tif ( rawBone.ID === parent.ID ) {\r\n\r\n\t\t\t\t\t\tconst subBone = bone;\r\n\t\t\t\t\t\tbone = new Bone();\r\n\r\n\t\t\t\t\t\tbone.matrixWorld.copy( rawBone.transformLink );\r\n\r\n\t\t\t\t\t\t// set name and id here - otherwise in cases where \"subBone\" is created it will not have a name / id\r\n\r\n\t\t\t\t\t\tbone.name = name ? PropertyBinding.sanitizeNodeName( name ) : '';\r\n\t\t\t\t\t\tbone.ID = id;\r\n\r\n\t\t\t\t\t\tskeleton.bones[ i ] = bone;\r\n\r\n\t\t\t\t\t\t// In cases where a bone is shared between multiple meshes\r\n\t\t\t\t\t\t// duplicate the bone here and and it as a child of the first bone\r\n\t\t\t\t\t\tif ( subBone !== null ) {\r\n\r\n\t\t\t\t\t\t\tbone.add( subBone );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn bone;\r\n\r\n\t}\r\n\r\n\t// create a PerspectiveCamera or OrthographicCamera\r\n\tcreateCamera( relationships ) {\r\n\r\n\t\tlet model;\r\n\t\tlet cameraAttribute;\r\n\r\n\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\r\n\r\n\t\t\tif ( attr !== undefined ) {\r\n\r\n\t\t\t\tcameraAttribute = attr;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( cameraAttribute === undefined ) {\r\n\r\n\t\t\tmodel = new Object3D();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tlet type = 0;\r\n\t\t\tif ( cameraAttribute.CameraProjectionType !== undefined && cameraAttribute.CameraProjectionType.value === 1 ) {\r\n\r\n\t\t\t\ttype = 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet nearClippingPlane = 1;\r\n\t\t\tif ( cameraAttribute.NearPlane !== undefined ) {\r\n\r\n\t\t\t\tnearClippingPlane = cameraAttribute.NearPlane.value / 1000;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet farClippingPlane = 1000;\r\n\t\t\tif ( cameraAttribute.FarPlane !== undefined ) {\r\n\r\n\t\t\t\tfarClippingPlane = cameraAttribute.FarPlane.value / 1000;\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tlet width = window.innerWidth;\r\n\t\t\tlet height = window.innerHeight;\r\n\r\n\t\t\tif ( cameraAttribute.AspectWidth !== undefined && cameraAttribute.AspectHeight !== undefined ) {\r\n\r\n\t\t\t\twidth = cameraAttribute.AspectWidth.value;\r\n\t\t\t\theight = cameraAttribute.AspectHeight.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst aspect = width / height;\r\n\r\n\t\t\tlet fov = 45;\r\n\t\t\tif ( cameraAttribute.FieldOfView !== undefined ) {\r\n\r\n\t\t\t\tfov = cameraAttribute.FieldOfView.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst focalLength = cameraAttribute.FocalLength ? cameraAttribute.FocalLength.value : null;\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 0: // Perspective\r\n\t\t\t\t\tmodel = new PerspectiveCamera( fov, aspect, nearClippingPlane, farClippingPlane );\r\n\t\t\t\t\tif ( focalLength !== null ) model.setFocalLength( focalLength );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1: // Orthographic\r\n\t\t\t\t\tmodel = new OrthographicCamera( - width / 2, width / 2, height / 2, - height / 2, nearClippingPlane, farClippingPlane );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown camera type ' + type + '.' );\r\n\t\t\t\t\tmodel = new Object3D();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn model;\r\n\r\n\t}\r\n\r\n\t// Create a DirectionalLight, PointLight or SpotLight\r\n\tcreateLight( relationships ) {\r\n\r\n\t\tlet model;\r\n\t\tlet lightAttribute;\r\n\r\n\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\tconst attr = fbxTree.Objects.NodeAttribute[ child.ID ];\r\n\r\n\t\t\tif ( attr !== undefined ) {\r\n\r\n\t\t\t\tlightAttribute = attr;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( lightAttribute === undefined ) {\r\n\r\n\t\t\tmodel = new Object3D();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tlet type;\r\n\r\n\t\t\t// LightType can be undefined for Point lights\r\n\t\t\tif ( lightAttribute.LightType === undefined ) {\r\n\r\n\t\t\t\ttype = 0;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttype = lightAttribute.LightType.value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet color = 0xffffff;\r\n\r\n\t\t\tif ( lightAttribute.Color !== undefined ) {\r\n\r\n\t\t\t\tcolor = new Color().fromArray( lightAttribute.Color.value );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet intensity = ( lightAttribute.Intensity === undefined ) ? 1 : lightAttribute.Intensity.value / 100;\r\n\r\n\t\t\t// light disabled\r\n\t\t\tif ( lightAttribute.CastLightOnObject !== undefined && lightAttribute.CastLightOnObject.value === 0 ) {\r\n\r\n\t\t\t\tintensity = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet distance = 0;\r\n\t\t\tif ( lightAttribute.FarAttenuationEnd !== undefined ) {\r\n\r\n\t\t\t\tif ( lightAttribute.EnableFarAttenuation !== undefined && lightAttribute.EnableFarAttenuation.value === 0 ) {\r\n\r\n\t\t\t\t\tdistance = 0;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tdistance = lightAttribute.FarAttenuationEnd.value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: could this be calculated linearly from FarAttenuationStart to FarAttenuationEnd?\r\n\t\t\tconst decay = 1;\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase 0: // Point\r\n\t\t\t\t\tmodel = new PointLight( color, intensity, distance, decay );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1: // Directional\r\n\t\t\t\t\tmodel = new DirectionalLight( color, intensity );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2: // Spot\r\n\t\t\t\t\tlet angle = Math.PI / 3;\r\n\r\n\t\t\t\t\tif ( lightAttribute.InnerAngle !== undefined ) {\r\n\r\n\t\t\t\t\t\tangle = MathUtils.degToRad( lightAttribute.InnerAngle.value );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet penumbra = 0;\r\n\t\t\t\t\tif ( lightAttribute.OuterAngle !== undefined ) {\r\n\r\n\t\t\t\t\t\t// TODO: this is not correct - FBX calculates outer and inner angle in degrees\r\n\t\t\t\t\t\t// with OuterAngle > InnerAngle && OuterAngle <= Math.PI\r\n\t\t\t\t\t\t// while three.js uses a penumbra between (0, 1) to attenuate the inner angle\r\n\t\t\t\t\t\tpenumbra = MathUtils.degToRad( lightAttribute.OuterAngle.value );\r\n\t\t\t\t\t\tpenumbra = Math.max( penumbra, 1 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tmodel = new SpotLight( color, intensity, distance, angle, penumbra, decay );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Unknown light type ' + lightAttribute.LightType.value + ', defaulting to a PointLight.' );\r\n\t\t\t\t\tmodel = new PointLight( color, intensity );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( lightAttribute.CastShadows !== undefined && lightAttribute.CastShadows.value === 1 ) {\r\n\r\n\t\t\t\tmodel.castShadow = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn model;\r\n\r\n\t}\r\n\r\n\tcreateMesh( relationships, geometryMap, materialMap ) {\r\n\r\n\t\tlet model;\r\n\t\tlet geometry = null;\r\n\t\tlet material = null;\r\n\t\tconst materials = [];\r\n\r\n\t\t// get geometry and materials(s) from connections\r\n\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\tif ( geometryMap.has( child.ID ) ) {\r\n\r\n\t\t\t\tgeometry = geometryMap.get( child.ID );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materialMap.has( child.ID ) ) {\r\n\r\n\t\t\t\tmaterials.push( materialMap.get( child.ID ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( materials.length > 1 ) {\r\n\r\n\t\t\tmaterial = materials;\r\n\r\n\t\t} else if ( materials.length > 0 ) {\r\n\r\n\t\t\tmaterial = materials[ 0 ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterial = new MeshPhongMaterial( { color: 0xcccccc } );\r\n\t\t\tmaterials.push( material );\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'color' in geometry.attributes ) {\r\n\r\n\t\t\tmaterials.forEach( function ( material ) {\r\n\r\n\t\t\t\tmaterial.vertexColors = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.FBX_Deformer ) {\r\n\r\n\t\t\tmodel = new SkinnedMesh( geometry, material );\r\n\t\t\tmodel.normalizeSkinWeights();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmodel = new Mesh( geometry, material );\r\n\r\n\t\t}\r\n\r\n\t\treturn model;\r\n\r\n\t}\r\n\r\n\tcreateCurve( relationships, geometryMap ) {\r\n\r\n\t\tconst geometry = relationships.children.reduce( function ( geo, child ) {\r\n\r\n\t\t\tif ( geometryMap.has( child.ID ) ) geo = geometryMap.get( child.ID );\r\n\r\n\t\t\treturn geo;\r\n\r\n\t\t}, null );\r\n\r\n\t\t// FBX does not list materials for Nurbs lines, so we'll just put our own in here.\r\n\t\tconst material = new LineBasicMaterial( { color: 0x3300ff, linewidth: 1 } );\r\n\t\treturn new Line( geometry, material );\r\n\r\n\t}\r\n\r\n\t// parse the model node for transform data\r\n\tgetTransformData( model, modelNode ) {\r\n\r\n\t\tconst transformData = {};\r\n\r\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\r\n\r\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\r\n\t\telse transformData.eulerOrder = 'ZYX';\r\n\r\n\t\tif ( 'Lcl_Translation' in modelNode ) transformData.translation = modelNode.Lcl_Translation.value;\r\n\r\n\t\tif ( 'PreRotation' in modelNode ) transformData.preRotation = modelNode.PreRotation.value;\r\n\t\tif ( 'Lcl_Rotation' in modelNode ) transformData.rotation = modelNode.Lcl_Rotation.value;\r\n\t\tif ( 'PostRotation' in modelNode ) transformData.postRotation = modelNode.PostRotation.value;\r\n\r\n\t\tif ( 'Lcl_Scaling' in modelNode ) transformData.scale = modelNode.Lcl_Scaling.value;\r\n\r\n\t\tif ( 'ScalingOffset' in modelNode ) transformData.scalingOffset = modelNode.ScalingOffset.value;\r\n\t\tif ( 'ScalingPivot' in modelNode ) transformData.scalingPivot = modelNode.ScalingPivot.value;\r\n\r\n\t\tif ( 'RotationOffset' in modelNode ) transformData.rotationOffset = modelNode.RotationOffset.value;\r\n\t\tif ( 'RotationPivot' in modelNode ) transformData.rotationPivot = modelNode.RotationPivot.value;\r\n\r\n\t\tmodel.userData.transformData = transformData;\r\n\r\n\t}\r\n\r\n\tsetLookAtProperties( model, modelNode ) {\r\n\r\n\t\tif ( 'LookAtProperty' in modelNode ) {\r\n\r\n\t\t\tconst children = connections.get( model.ID ).children;\r\n\r\n\t\t\tchildren.forEach( function ( child ) {\r\n\r\n\t\t\t\tif ( child.relationship === 'LookAtProperty' ) {\r\n\r\n\t\t\t\t\tconst lookAtTarget = fbxTree.Objects.Model[ child.ID ];\r\n\r\n\t\t\t\t\tif ( 'Lcl_Translation' in lookAtTarget ) {\r\n\r\n\t\t\t\t\t\tconst pos = lookAtTarget.Lcl_Translation.value;\r\n\r\n\t\t\t\t\t\t// DirectionalLight, SpotLight\r\n\t\t\t\t\t\tif ( model.target !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tmodel.target.position.fromArray( pos );\r\n\t\t\t\t\t\t\tsceneGraph.add( model.target );\r\n\r\n\t\t\t\t\t\t} else { // Cameras and other Object3Ds\r\n\r\n\t\t\t\t\t\t\tmodel.lookAt( new Vector3().fromArray( pos ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tbindSkeleton( skeletons, geometryMap, modelMap ) {\r\n\r\n\t\tconst bindMatrices = this.parsePoseNodes();\r\n\r\n\t\tfor ( const ID in skeletons ) {\r\n\r\n\t\t\tconst skeleton = skeletons[ ID ];\r\n\r\n\t\t\tconst parents = connections.get( parseInt( skeleton.ID ) ).parents;\r\n\r\n\t\t\tparents.forEach( function ( parent ) {\r\n\r\n\t\t\t\tif ( geometryMap.has( parent.ID ) ) {\r\n\r\n\t\t\t\t\tconst geoID = parent.ID;\r\n\t\t\t\t\tconst geoRelationships = connections.get( geoID );\r\n\r\n\t\t\t\t\tgeoRelationships.parents.forEach( function ( geoConnParent ) {\r\n\r\n\t\t\t\t\t\tif ( modelMap.has( geoConnParent.ID ) ) {\r\n\r\n\t\t\t\t\t\t\tconst model = modelMap.get( geoConnParent.ID );\r\n\r\n\t\t\t\t\t\t\tmodel.bind( new Skeleton( skeleton.bones ), bindMatrices[ geoConnParent.ID ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tparsePoseNodes() {\r\n\r\n\t\tconst bindMatrices = {};\r\n\r\n\t\tif ( 'Pose' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst BindPoseNode = fbxTree.Objects.Pose;\r\n\r\n\t\t\tfor ( const nodeID in BindPoseNode ) {\r\n\r\n\t\t\t\tif ( BindPoseNode[ nodeID ].attrType === 'BindPose' ) {\r\n\r\n\t\t\t\t\tconst poseNodes = BindPoseNode[ nodeID ].PoseNode;\r\n\r\n\t\t\t\t\tif ( Array.isArray( poseNodes ) ) {\r\n\r\n\t\t\t\t\t\tposeNodes.forEach( function ( poseNode ) {\r\n\r\n\t\t\t\t\t\t\tbindMatrices[ poseNode.Node ] = new Matrix4().fromArray( poseNode.Matrix.a );\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tbindMatrices[ poseNodes.Node ] = new Matrix4().fromArray( poseNodes.Matrix.a );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn bindMatrices;\r\n\r\n\t}\r\n\r\n\t// Parse ambient color in FBXTree.GlobalSettings - if it's not set to black (default), create an ambient light\r\n\tcreateAmbientLight() {\r\n\r\n\t\tif ( 'GlobalSettings' in fbxTree && 'AmbientColor' in fbxTree.GlobalSettings ) {\r\n\r\n\t\t\tconst ambientColor = fbxTree.GlobalSettings.AmbientColor.value;\r\n\t\t\tconst r = ambientColor[ 0 ];\r\n\t\t\tconst g = ambientColor[ 1 ];\r\n\t\t\tconst b = ambientColor[ 2 ];\r\n\r\n\t\t\tif ( r !== 0 || g !== 0 || b !== 0 ) {\r\n\r\n\t\t\t\tconst color = new Color( r, g, b );\r\n\t\t\t\tsceneGraph.add( new AmbientLight( color, 1 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n// parse Geometry data from FBXTree and return map of BufferGeometries\r\nclass GeometryParser {\r\n\r\n\t// Parse nodes in FBXTree.Objects.Geometry\r\n\tparse( deformers ) {\r\n\r\n\t\tconst geometryMap = new Map();\r\n\r\n\t\tif ( 'Geometry' in fbxTree.Objects ) {\r\n\r\n\t\t\tconst geoNodes = fbxTree.Objects.Geometry;\r\n\r\n\t\t\tfor ( const nodeID in geoNodes ) {\r\n\r\n\t\t\t\tconst relationships = connections.get( parseInt( nodeID ) );\r\n\t\t\t\tconst geo = this.parseGeometry( relationships, geoNodes[ nodeID ], deformers );\r\n\r\n\t\t\t\tgeometryMap.set( parseInt( nodeID ), geo );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn geometryMap;\r\n\r\n\t}\r\n\r\n\t// Parse single node in FBXTree.Objects.Geometry\r\n\tparseGeometry( relationships, geoNode, deformers ) {\r\n\r\n\t\tswitch ( geoNode.attrType ) {\r\n\r\n\t\t\tcase 'Mesh':\r\n\t\t\t\treturn this.parseMeshGeometry( relationships, geoNode, deformers );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NurbsCurve':\r\n\t\t\t\treturn this.parseNurbsGeometry( geoNode );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Parse single node mesh geometry in FBXTree.Objects.Geometry\r\n\tparseMeshGeometry( relationships, geoNode, deformers ) {\r\n\r\n\t\tconst skeletons = deformers.skeletons;\r\n\t\tconst morphTargets = [];\r\n\r\n\t\tconst modelNodes = relationships.parents.map( function ( parent ) {\r\n\r\n\t\t\treturn fbxTree.Objects.Model[ parent.ID ];\r\n\r\n\t\t} );\r\n\r\n\t\t// don't create geometry if it is not associated with any models\r\n\t\tif ( modelNodes.length === 0 ) return;\r\n\r\n\t\tconst skeleton = relationships.children.reduce( function ( skeleton, child ) {\r\n\r\n\t\t\tif ( skeletons[ child.ID ] !== undefined ) skeleton = skeletons[ child.ID ];\r\n\r\n\t\t\treturn skeleton;\r\n\r\n\t\t}, null );\r\n\r\n\t\trelationships.children.forEach( function ( child ) {\r\n\r\n\t\t\tif ( deformers.morphTargets[ child.ID ] !== undefined ) {\r\n\r\n\t\t\t\tmorphTargets.push( deformers.morphTargets[ child.ID ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\t// Assume one model and get the preRotation from that\r\n\t\t// if there is more than one model associated with the geometry this may cause problems\r\n\t\tconst modelNode = modelNodes[ 0 ];\r\n\r\n\t\tconst transformData = {};\r\n\r\n\t\tif ( 'RotationOrder' in modelNode ) transformData.eulerOrder = getEulerOrder( modelNode.RotationOrder.value );\r\n\t\tif ( 'InheritType' in modelNode ) transformData.inheritType = parseInt( modelNode.InheritType.value );\r\n\r\n\t\tif ( 'GeometricTranslation' in modelNode ) transformData.translation = modelNode.GeometricTranslation.value;\r\n\t\tif ( 'GeometricRotation' in modelNode ) transformData.rotation = modelNode.GeometricRotation.value;\r\n\t\tif ( 'GeometricScaling' in modelNode ) transformData.scale = modelNode.GeometricScaling.value;\r\n\r\n\t\tconst transform = generateTransform( transformData );\r\n\r\n\t\treturn this.genGeometry( geoNode, skeleton, morphTargets, transform );\r\n\r\n\t}\r\n\r\n\t// Generate a BufferGeometry from a node in FBXTree.Objects.Geometry\r\n\tgenGeometry( geoNode, skeleton, morphTargets, preTransform ) {\r\n\r\n\t\tconst geo = new BufferGeometry();\r\n\t\tif ( geoNode.attrName ) geo.name = geoNode.attrName;\r\n\r\n\t\tconst geoInfo = this.parseGeoNode( geoNode, skeleton );\r\n\t\tconst buffers = this.genBuffers( geoInfo );\r\n\r\n\t\tconst positionAttribute = new Float32BufferAttribute( buffers.vertex, 3 );\r\n\r\n\t\tpositionAttribute.applyMatrix4( preTransform );\r\n\r\n\t\tgeo.setAttribute( 'position', positionAttribute );\r\n\r\n\t\tif ( buffers.colors.length > 0 ) {\r\n\r\n\t\t\tgeo.setAttribute( 'color', new Float32BufferAttribute( buffers.colors, 3 ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( skeleton ) {\r\n\r\n\t\t\tgeo.setAttribute( 'skinIndex', new Uint16BufferAttribute( buffers.weightsIndices, 4 ) );\r\n\r\n\t\t\tgeo.setAttribute( 'skinWeight', new Float32BufferAttribute( buffers.vertexWeights, 4 ) );\r\n\r\n\t\t\t// used later to bind the skeleton to the model\r\n\t\t\tgeo.FBX_Deformer = skeleton;\r\n\r\n\t\t}\r\n\r\n\t\tif ( buffers.normal.length > 0 ) {\r\n\r\n\t\t\tconst normalMatrix = new Matrix3().getNormalMatrix( preTransform );\r\n\r\n\t\t\tconst normalAttribute = new Float32BufferAttribute( buffers.normal, 3 );\r\n\t\t\tnormalAttribute.applyNormalMatrix( normalMatrix );\r\n\r\n\t\t\tgeo.setAttribute( 'normal', normalAttribute );\r\n\r\n\t\t}\r\n\r\n\t\tbuffers.uvs.forEach( function ( uvBuffer, i ) {\r\n\r\n\t\t\t// subsequent uv buffers are called 'uv1', 'uv2', ...\r\n\t\t\tlet name = 'uv' + ( i + 1 ).toString();\r\n\r\n\t\t\t// the first uv buffer is just called 'uv'\r\n\t\t\tif ( i === 0 ) {\r\n\r\n\t\t\t\tname = 'uv';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeo.setAttribute( name, new Float32BufferAttribute( buffers.uvs[ i ], 2 ) );\r\n\r\n\t\t} );\r\n\r\n\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t// Convert the material indices of each vertex into rendering groups on the geometry.\r\n\t\t\tlet prevMaterialIndex = buffers.materialIndex[ 0 ];\r\n\t\t\tlet startIndex = 0;\r\n\r\n\t\t\tbuffers.materialIndex.forEach( function ( currentIndex, i ) {\r\n\r\n\t\t\t\tif ( currentIndex !== prevMaterialIndex ) {\r\n\r\n\t\t\t\t\tgeo.addGroup( startIndex, i - startIndex, prevMaterialIndex );\r\n\r\n\t\t\t\t\tprevMaterialIndex = currentIndex;\r\n\t\t\t\t\tstartIndex = i;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\t// the loop above doesn't add the last group, do that here.\r\n\t\t\tif ( geo.groups.length > 0 ) {\r\n\r\n\t\t\t\tconst lastGroup = geo.groups[ geo.groups.length - 1 ];\r\n\t\t\t\tconst lastIndex = lastGroup.start + lastGroup.count;\r\n\r\n\t\t\t\tif ( lastIndex !== buffers.materialIndex.length ) {\r\n\r\n\t\t\t\t\tgeo.addGroup( lastIndex, buffers.materialIndex.length - lastIndex, prevMaterialIndex );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// case where there are multiple materials but the whole geometry is only\r\n\t\t\t// using one of them\r\n\t\t\tif ( geo.groups.length === 0 ) {\r\n\r\n\t\t\t\tgeo.addGroup( 0, buffers.materialIndex.length, buffers.materialIndex[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.addMorphTargets( geo, geoNode, morphTargets, preTransform );\r\n\r\n\t\treturn geo;\r\n\r\n\t}\r\n\r\n\tparseGeoNode( geoNode, skeleton ) {\r\n\r\n\t\tconst geoInfo = {};\r\n\r\n\t\tgeoInfo.vertexPositions = ( geoNode.Vertices !== undefined ) ? geoNode.Vertices.a : [];\r\n\t\tgeoInfo.vertexIndices = ( geoNode.PolygonVertexIndex !== undefined ) ? geoNode.PolygonVertexIndex.a : [];\r\n\r\n\t\tif ( geoNode.LayerElementColor ) {\r\n\r\n\t\t\tgeoInfo.color = this.parseVertexColors( geoNode.LayerElementColor[ 0 ] );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geoNode.LayerElementMaterial ) {\r\n\r\n\t\t\tgeoInfo.material = this.parseMaterialIndices( geoNode.LayerElementMaterial[ 0 ] );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geoNode.LayerElementNormal ) {\r\n\r\n\t\t\tgeoInfo.normal = this.parseNormals( geoNode.LayerElementNormal[ 0 ] );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geoNode.LayerElementUV ) {\r\n\r\n\t\t\tgeoInfo.uv = [];\r\n\r\n\t\t\tlet i = 0;\r\n\t\t\twhile ( geoNode.LayerElementUV[ i ] ) {\r\n\r\n\t\t\t\tif ( geoNode.LayerElementUV[ i ].UV ) {\r\n\r\n\t\t\t\t\tgeoInfo.uv.push( this.parseUVs( geoNode.LayerElementUV[ i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ti ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeoInfo.weightTable = {};\r\n\r\n\t\tif ( skeleton !== null ) {\r\n\r\n\t\t\tgeoInfo.skeleton = skeleton;\r\n\r\n\t\t\tskeleton.rawBones.forEach( function ( rawBone, i ) {\r\n\r\n\t\t\t\t// loop over the bone's vertex indices and weights\r\n\t\t\t\trawBone.indices.forEach( function ( index, j ) {\r\n\r\n\t\t\t\t\tif ( geoInfo.weightTable[ index ] === undefined ) geoInfo.weightTable[ index ] = [];\r\n\r\n\t\t\t\t\tgeoInfo.weightTable[ index ].push( {\r\n\r\n\t\t\t\t\t\tid: i,\r\n\t\t\t\t\t\tweight: rawBone.weights[ j ],\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn geoInfo;\r\n\r\n\t}\r\n\r\n\tgenBuffers( geoInfo ) {\r\n\r\n\t\tconst buffers = {\r\n\t\t\tvertex: [],\r\n\t\t\tnormal: [],\r\n\t\t\tcolors: [],\r\n\t\t\tuvs: [],\r\n\t\t\tmaterialIndex: [],\r\n\t\t\tvertexWeights: [],\r\n\t\t\tweightsIndices: [],\r\n\t\t};\r\n\r\n\t\tlet polygonIndex = 0;\r\n\t\tlet faceLength = 0;\r\n\t\tlet displayedWeightsWarning = false;\r\n\r\n\t\t// these will hold data for a single face\r\n\t\tlet facePositionIndexes = [];\r\n\t\tlet faceNormals = [];\r\n\t\tlet faceColors = [];\r\n\t\tlet faceUVs = [];\r\n\t\tlet faceWeights = [];\r\n\t\tlet faceWeightIndices = [];\r\n\r\n\t\tconst scope = this;\r\n\t\tgeoInfo.vertexIndices.forEach( function ( vertexIndex, polygonVertexIndex ) {\r\n\r\n\t\t\tlet materialIndex;\r\n\t\t\tlet endOfFace = false;\r\n\r\n\t\t\t// Face index and vertex index arrays are combined in a single array\r\n\t\t\t// A cube with quad faces looks like this:\r\n\t\t\t// PolygonVertexIndex: *24 {\r\n\t\t\t//  a: 0, 1, 3, -3, 2, 3, 5, -5, 4, 5, 7, -7, 6, 7, 1, -1, 1, 7, 5, -4, 6, 0, 2, -5\r\n\t\t\t//  }\r\n\t\t\t// Negative numbers mark the end of a face - first face here is 0, 1, 3, -3\r\n\t\t\t// to find index of last vertex bit shift the index: ^ - 1\r\n\t\t\tif ( vertexIndex < 0 ) {\r\n\r\n\t\t\t\tvertexIndex = vertexIndex ^ - 1; // equivalent to ( x * -1 ) - 1\r\n\t\t\t\tendOfFace = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet weightIndices = [];\r\n\t\t\tlet weights = [];\r\n\r\n\t\t\tfacePositionIndexes.push( vertexIndex * 3, vertexIndex * 3 + 1, vertexIndex * 3 + 2 );\r\n\r\n\t\t\tif ( geoInfo.color ) {\r\n\r\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.color );\r\n\r\n\t\t\t\tfaceColors.push( data[ 0 ], data[ 1 ], data[ 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.skeleton ) {\r\n\r\n\t\t\t\tif ( geoInfo.weightTable[ vertexIndex ] !== undefined ) {\r\n\r\n\t\t\t\t\tgeoInfo.weightTable[ vertexIndex ].forEach( function ( wt ) {\r\n\r\n\t\t\t\t\t\tweights.push( wt.weight );\r\n\t\t\t\t\t\tweightIndices.push( wt.id );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( weights.length > 4 ) {\r\n\r\n\t\t\t\t\tif ( ! displayedWeightsWarning ) {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights.' );\r\n\t\t\t\t\t\tdisplayedWeightsWarning = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst wIndex = [ 0, 0, 0, 0 ];\r\n\t\t\t\t\tconst Weight = [ 0, 0, 0, 0 ];\r\n\r\n\t\t\t\t\tweights.forEach( function ( weight, weightIndex ) {\r\n\r\n\t\t\t\t\t\tlet currentWeight = weight;\r\n\t\t\t\t\t\tlet currentIndex = weightIndices[ weightIndex ];\r\n\r\n\t\t\t\t\t\tWeight.forEach( function ( comparedWeight, comparedWeightIndex, comparedWeightArray ) {\r\n\r\n\t\t\t\t\t\t\tif ( currentWeight > comparedWeight ) {\r\n\r\n\t\t\t\t\t\t\t\tcomparedWeightArray[ comparedWeightIndex ] = currentWeight;\r\n\t\t\t\t\t\t\t\tcurrentWeight = comparedWeight;\r\n\r\n\t\t\t\t\t\t\t\tconst tmp = wIndex[ comparedWeightIndex ];\r\n\t\t\t\t\t\t\t\twIndex[ comparedWeightIndex ] = currentIndex;\r\n\t\t\t\t\t\t\t\tcurrentIndex = tmp;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tweightIndices = wIndex;\r\n\t\t\t\t\tweights = Weight;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if the weight array is shorter than 4 pad with 0s\r\n\t\t\t\twhile ( weights.length < 4 ) {\r\n\r\n\t\t\t\t\tweights.push( 0 );\r\n\t\t\t\t\tweightIndices.push( 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let i = 0; i < 4; ++ i ) {\r\n\r\n\t\t\t\t\tfaceWeights.push( weights[ i ] );\r\n\t\t\t\t\tfaceWeightIndices.push( weightIndices[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.normal ) {\r\n\r\n\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.normal );\r\n\r\n\t\t\t\tfaceNormals.push( data[ 0 ], data[ 1 ], data[ 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t\tmaterialIndex = getData( polygonVertexIndex, polygonIndex, vertexIndex, geoInfo.material )[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.uv ) {\r\n\r\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, i ) {\r\n\r\n\t\t\t\t\tconst data = getData( polygonVertexIndex, polygonIndex, vertexIndex, uv );\r\n\r\n\t\t\t\t\tif ( faceUVs[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\tfaceUVs[ i ] = [];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfaceUVs[ i ].push( data[ 0 ] );\r\n\t\t\t\t\tfaceUVs[ i ].push( data[ 1 ] );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfaceLength ++;\r\n\r\n\t\t\tif ( endOfFace ) {\r\n\r\n\t\t\t\tscope.genFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength );\r\n\r\n\t\t\t\tpolygonIndex ++;\r\n\t\t\t\tfaceLength = 0;\r\n\r\n\t\t\t\t// reset arrays for the next face\r\n\t\t\t\tfacePositionIndexes = [];\r\n\t\t\t\tfaceNormals = [];\r\n\t\t\t\tfaceColors = [];\r\n\t\t\t\tfaceUVs = [];\r\n\t\t\t\tfaceWeights = [];\r\n\t\t\t\tfaceWeightIndices = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn buffers;\r\n\r\n\t}\r\n\r\n\t// Generate data for a single face in a geometry. If the face is a quad then split it into 2 tris\r\n\tgenFace( buffers, geoInfo, facePositionIndexes, materialIndex, faceNormals, faceColors, faceUVs, faceWeights, faceWeightIndices, faceLength ) {\r\n\r\n\t\tfor ( let i = 2; i < faceLength; i ++ ) {\r\n\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 0 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 1 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ 2 ] ] );\r\n\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 1 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ ( i - 1 ) * 3 + 2 ] ] );\r\n\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 1 ] ] );\r\n\t\t\tbuffers.vertex.push( geoInfo.vertexPositions[ facePositionIndexes[ i * 3 + 2 ] ] );\r\n\r\n\t\t\tif ( geoInfo.skeleton ) {\r\n\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 0 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 1 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 2 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ 3 ] );\r\n\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 1 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 2 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ ( i - 1 ) * 4 + 3 ] );\r\n\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 1 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 2 ] );\r\n\t\t\t\tbuffers.vertexWeights.push( faceWeights[ i * 4 + 3 ] );\r\n\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 0 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 1 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 2 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ 3 ] );\r\n\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 1 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 2 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ ( i - 1 ) * 4 + 3 ] );\r\n\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 1 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 2 ] );\r\n\t\t\t\tbuffers.weightsIndices.push( faceWeightIndices[ i * 4 + 3 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.color ) {\r\n\r\n\t\t\t\tbuffers.colors.push( faceColors[ 0 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ 1 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ 2 ] );\r\n\r\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 1 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ ( i - 1 ) * 3 + 2 ] );\r\n\r\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 1 ] );\r\n\t\t\t\tbuffers.colors.push( faceColors[ i * 3 + 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.material && geoInfo.material.mappingType !== 'AllSame' ) {\r\n\r\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\t\t\t\tbuffers.materialIndex.push( materialIndex );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.normal ) {\r\n\r\n\t\t\t\tbuffers.normal.push( faceNormals[ 0 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ 1 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ 2 ] );\r\n\r\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 1 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ ( i - 1 ) * 3 + 2 ] );\r\n\r\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 1 ] );\r\n\t\t\t\tbuffers.normal.push( faceNormals[ i * 3 + 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geoInfo.uv ) {\r\n\r\n\t\t\t\tgeoInfo.uv.forEach( function ( uv, j ) {\r\n\r\n\t\t\t\t\tif ( buffers.uvs[ j ] === undefined ) buffers.uvs[ j ] = [];\r\n\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 0 ] );\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ 1 ] );\r\n\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 ] );\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ ( i - 1 ) * 2 + 1 ] );\r\n\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 ] );\r\n\t\t\t\t\tbuffers.uvs[ j ].push( faceUVs[ j ][ i * 2 + 1 ] );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\taddMorphTargets( parentGeo, parentGeoNode, morphTargets, preTransform ) {\r\n\r\n\t\tif ( morphTargets.length === 0 ) return;\r\n\r\n\t\tparentGeo.morphTargetsRelative = true;\r\n\r\n\t\tparentGeo.morphAttributes.position = [];\r\n\t\t// parentGeo.morphAttributes.normal = []; // not implemented\r\n\r\n\t\tconst scope = this;\r\n\t\tmorphTargets.forEach( function ( morphTarget ) {\r\n\r\n\t\t\tmorphTarget.rawTargets.forEach( function ( rawTarget ) {\r\n\r\n\t\t\t\tconst morphGeoNode = fbxTree.Objects.Geometry[ rawTarget.geoID ];\r\n\r\n\t\t\t\tif ( morphGeoNode !== undefined ) {\r\n\r\n\t\t\t\t\tscope.genMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, rawTarget.name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// a morph geometry node is similar to a standard  node, and the node is also contained\r\n\t// in FBXTree.Objects.Geometry, however it can only have attributes for position, normal\r\n\t// and a special attribute Index defining which vertices of the original geometry are affected\r\n\t// Normal and position attributes only have data for the vertices that are affected by the morph\r\n\tgenMorphGeometry( parentGeo, parentGeoNode, morphGeoNode, preTransform, name ) {\r\n\r\n\t\tconst vertexIndices = ( parentGeoNode.PolygonVertexIndex !== undefined ) ? parentGeoNode.PolygonVertexIndex.a : [];\r\n\r\n\t\tconst morphPositionsSparse = ( morphGeoNode.Vertices !== undefined ) ? morphGeoNode.Vertices.a : [];\r\n\t\tconst indices = ( morphGeoNode.Indexes !== undefined ) ? morphGeoNode.Indexes.a : [];\r\n\r\n\t\tconst length = parentGeo.attributes.position.count * 3;\r\n\t\tconst morphPositions = new Float32Array( length );\r\n\r\n\t\tfor ( let i = 0; i < indices.length; i ++ ) {\r\n\r\n\t\t\tconst morphIndex = indices[ i ] * 3;\r\n\r\n\t\t\tmorphPositions[ morphIndex ] = morphPositionsSparse[ i * 3 ];\r\n\t\t\tmorphPositions[ morphIndex + 1 ] = morphPositionsSparse[ i * 3 + 1 ];\r\n\t\t\tmorphPositions[ morphIndex + 2 ] = morphPositionsSparse[ i * 3 + 2 ];\r\n\r\n\t\t}\r\n\r\n\t\t// TODO: add morph normal support\r\n\t\tconst morphGeoInfo = {\r\n\t\t\tvertexIndices: vertexIndices,\r\n\t\t\tvertexPositions: morphPositions,\r\n\r\n\t\t};\r\n\r\n\t\tconst morphBuffers = this.genBuffers( morphGeoInfo );\r\n\r\n\t\tconst positionAttribute = new Float32BufferAttribute( morphBuffers.vertex, 3 );\r\n\t\tpositionAttribute.name = name || morphGeoNode.attrName;\r\n\r\n\t\tpositionAttribute.applyMatrix4( preTransform );\r\n\r\n\t\tparentGeo.morphAttributes.position.push( positionAttribute );\r\n\r\n\t}\r\n\r\n\t// Parse normal from FBXTree.Objects.Geometry.LayerElementNormal if it exists\r\n\tparseNormals( NormalNode ) {\r\n\r\n\t\tconst mappingType = NormalNode.MappingInformationType;\r\n\t\tconst referenceType = NormalNode.ReferenceInformationType;\r\n\t\tconst buffer = NormalNode.Normals.a;\r\n\t\tlet indexBuffer = [];\r\n\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\tif ( 'NormalIndex' in NormalNode ) {\r\n\r\n\t\t\t\tindexBuffer = NormalNode.NormalIndex.a;\r\n\r\n\t\t\t} else if ( 'NormalsIndex' in NormalNode ) {\r\n\r\n\t\t\t\tindexBuffer = NormalNode.NormalsIndex.a;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdataSize: 3,\r\n\t\t\tbuffer: buffer,\r\n\t\t\tindices: indexBuffer,\r\n\t\t\tmappingType: mappingType,\r\n\t\t\treferenceType: referenceType\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Parse UVs from FBXTree.Objects.Geometry.LayerElementUV if it exists\r\n\tparseUVs( UVNode ) {\r\n\r\n\t\tconst mappingType = UVNode.MappingInformationType;\r\n\t\tconst referenceType = UVNode.ReferenceInformationType;\r\n\t\tconst buffer = UVNode.UV.a;\r\n\t\tlet indexBuffer = [];\r\n\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\tindexBuffer = UVNode.UVIndex.a;\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdataSize: 2,\r\n\t\t\tbuffer: buffer,\r\n\t\t\tindices: indexBuffer,\r\n\t\t\tmappingType: mappingType,\r\n\t\t\treferenceType: referenceType\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Parse Vertex Colors from FBXTree.Objects.Geometry.LayerElementColor if it exists\r\n\tparseVertexColors( ColorNode ) {\r\n\r\n\t\tconst mappingType = ColorNode.MappingInformationType;\r\n\t\tconst referenceType = ColorNode.ReferenceInformationType;\r\n\t\tconst buffer = ColorNode.Colors.a;\r\n\t\tlet indexBuffer = [];\r\n\t\tif ( referenceType === 'IndexToDirect' ) {\r\n\r\n\t\t\tindexBuffer = ColorNode.ColorIndex.a;\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdataSize: 4,\r\n\t\t\tbuffer: buffer,\r\n\t\t\tindices: indexBuffer,\r\n\t\t\tmappingType: mappingType,\r\n\t\t\treferenceType: referenceType\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Parse mapping and material data in FBXTree.Objects.Geometry.LayerElementMaterial if it exists\r\n\tparseMaterialIndices( MaterialNode ) {\r\n\r\n\t\tconst mappingType = MaterialNode.MappingInformationType;\r\n\t\tconst referenceType = MaterialNode.ReferenceInformationType;\r\n\r\n\t\tif ( mappingType === 'NoMappingInformation' ) {\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdataSize: 1,\r\n\t\t\t\tbuffer: [ 0 ],\r\n\t\t\t\tindices: [ 0 ],\r\n\t\t\t\tmappingType: 'AllSame',\r\n\t\t\t\treferenceType: referenceType\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tconst materialIndexBuffer = MaterialNode.Materials.a;\r\n\r\n\t\t// Since materials are stored as indices, there's a bit of a mismatch between FBX and what\r\n\t\t// we expect.So we create an intermediate buffer that points to the index in the buffer,\r\n\t\t// for conforming with the other functions we've written for other data.\r\n\t\tconst materialIndices = [];\r\n\r\n\t\tfor ( let i = 0; i < materialIndexBuffer.length; ++ i ) {\r\n\r\n\t\t\tmaterialIndices.push( i );\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tdataSize: 1,\r\n\t\t\tbuffer: materialIndexBuffer,\r\n\t\t\tindices: materialIndices,\r\n\t\t\tmappingType: mappingType,\r\n\t\t\treferenceType: referenceType\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// Generate a NurbGeometry from a node in FBXTree.Objects.Geometry\r\n\tparseNurbsGeometry( geoNode ) {\r\n\r\n\t\tif ( NURBSCurve === undefined ) {\r\n\r\n\t\t\tconsole.error( 'THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry.' );\r\n\t\t\treturn new BufferGeometry();\r\n\r\n\t\t}\r\n\r\n\t\tconst order = parseInt( geoNode.Order );\r\n\r\n\t\tif ( isNaN( order ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.FBXLoader: Invalid Order %s given for geometry ID: %s', geoNode.Order, geoNode.id );\r\n\t\t\treturn new BufferGeometry();\r\n\r\n\t\t}\r\n\r\n\t\tconst degree = order - 1;\r\n\r\n\t\tconst knots = geoNode.KnotVector.a;\r\n\t\tconst controlPoints = [];\r\n\t\tconst pointsValues = geoNode.Points.a;\r\n\r\n\t\tfor ( let i = 0, l = pointsValues.length; i < l; i += 4 ) {\r\n\r\n\t\t\tcontrolPoints.push( new Vector4().fromArray( pointsValues, i ) );\r\n\r\n\t\t}\r\n\r\n\t\tlet startKnot, endKnot;\r\n\r\n\t\tif ( geoNode.Form === 'Closed' ) {\r\n\r\n\t\t\tcontrolPoints.push( controlPoints[ 0 ] );\r\n\r\n\t\t} else if ( geoNode.Form === 'Periodic' ) {\r\n\r\n\t\t\tstartKnot = degree;\r\n\t\t\tendKnot = knots.length - 1 - startKnot;\r\n\r\n\t\t\tfor ( let i = 0; i < degree; ++ i ) {\r\n\r\n\t\t\t\tcontrolPoints.push( controlPoints[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst curve = new NURBSCurve( degree, knots, controlPoints, startKnot, endKnot );\r\n\t\tconst points = curve.getPoints( controlPoints.length * 12 );\r\n\r\n\t\treturn new BufferGeometry().setFromPoints( points );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// parse animation data from FBXTree\r\nclass AnimationParser {\r\n\r\n\t// take raw animation clips and turn them into three.js animation clips\r\n\tparse() {\r\n\r\n\t\tconst animationClips = [];\r\n\r\n\t\tconst rawClips = this.parseClips();\r\n\r\n\t\tif ( rawClips !== undefined ) {\r\n\r\n\t\t\tfor ( const key in rawClips ) {\r\n\r\n\t\t\t\tconst rawClip = rawClips[ key ];\r\n\r\n\t\t\t\tconst clip = this.addClip( rawClip );\r\n\r\n\t\t\t\tanimationClips.push( clip );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn animationClips;\r\n\r\n\t}\r\n\r\n\tparseClips() {\r\n\r\n\t\t// since the actual transformation data is stored in FBXTree.Objects.AnimationCurve,\r\n\t\t// if this is undefined we can safely assume there are no animations\r\n\t\tif ( fbxTree.Objects.AnimationCurve === undefined ) return undefined;\r\n\r\n\t\tconst curveNodesMap = this.parseAnimationCurveNodes();\r\n\r\n\t\tthis.parseAnimationCurves( curveNodesMap );\r\n\r\n\t\tconst layersMap = this.parseAnimationLayers( curveNodesMap );\r\n\t\tconst rawClips = this.parseAnimStacks( layersMap );\r\n\r\n\t\treturn rawClips;\r\n\r\n\t}\r\n\r\n\t// parse nodes in FBXTree.Objects.AnimationCurveNode\r\n\t// each AnimationCurveNode holds data for an animation transform for a model (e.g. left arm rotation )\r\n\t// and is referenced by an AnimationLayer\r\n\tparseAnimationCurveNodes() {\r\n\r\n\t\tconst rawCurveNodes = fbxTree.Objects.AnimationCurveNode;\r\n\r\n\t\tconst curveNodesMap = new Map();\r\n\r\n\t\tfor ( const nodeID in rawCurveNodes ) {\r\n\r\n\t\t\tconst rawCurveNode = rawCurveNodes[ nodeID ];\r\n\r\n\t\t\tif ( rawCurveNode.attrName.match( /S|R|T|DeformPercent/ ) !== null ) {\r\n\r\n\t\t\t\tconst curveNode = {\r\n\r\n\t\t\t\t\tid: rawCurveNode.id,\r\n\t\t\t\t\tattr: rawCurveNode.attrName,\r\n\t\t\t\t\tcurves: {},\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tcurveNodesMap.set( curveNode.id, curveNode );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn curveNodesMap;\r\n\r\n\t}\r\n\r\n\t// parse nodes in FBXTree.Objects.AnimationCurve and connect them up to\r\n\t// previously parsed AnimationCurveNodes. Each AnimationCurve holds data for a single animated\r\n\t// axis ( e.g. times and values of x rotation)\r\n\tparseAnimationCurves( curveNodesMap ) {\r\n\r\n\t\tconst rawCurves = fbxTree.Objects.AnimationCurve;\r\n\r\n\t\t// TODO: Many values are identical up to roundoff error, but won't be optimised\r\n\t\t// e.g. position times: [0, 0.4, 0. 8]\r\n\t\t// position values: [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.23538335023477e-7, 93.67518615722656, -0.9982695579528809, 7.235384487103147e-7, 93.67520904541016, -0.9982695579528809]\r\n\t\t// clearly, this should be optimised to\r\n\t\t// times: [0], positions [7.23538335023477e-7, 93.67518615722656, -0.9982695579528809]\r\n\t\t// this shows up in nearly every FBX file, and generally time array is length > 100\r\n\r\n\t\tfor ( const nodeID in rawCurves ) {\r\n\r\n\t\t\tconst animationCurve = {\r\n\r\n\t\t\t\tid: rawCurves[ nodeID ].id,\r\n\t\t\t\ttimes: rawCurves[ nodeID ].KeyTime.a.map( convertFBXTimeToSeconds ),\r\n\t\t\t\tvalues: rawCurves[ nodeID ].KeyValueFloat.a,\r\n\r\n\t\t\t};\r\n\r\n\t\t\tconst relationships = connections.get( animationCurve.id );\r\n\r\n\t\t\tif ( relationships !== undefined ) {\r\n\r\n\t\t\t\tconst animationCurveID = relationships.parents[ 0 ].ID;\r\n\t\t\t\tconst animationCurveRelationship = relationships.parents[ 0 ].relationship;\r\n\r\n\t\t\t\tif ( animationCurveRelationship.match( /X/ ) ) {\r\n\r\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'x' ] = animationCurve;\r\n\r\n\t\t\t\t} else if ( animationCurveRelationship.match( /Y/ ) ) {\r\n\r\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'y' ] = animationCurve;\r\n\r\n\t\t\t\t} else if ( animationCurveRelationship.match( /Z/ ) ) {\r\n\r\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'z' ] = animationCurve;\r\n\r\n\t\t\t\t} else if ( animationCurveRelationship.match( /d|DeformPercent/ ) && curveNodesMap.has( animationCurveID ) ) {\r\n\r\n\t\t\t\t\tcurveNodesMap.get( animationCurveID ).curves[ 'morph' ] = animationCurve;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// parse nodes in FBXTree.Objects.AnimationLayer. Each layers holds references\r\n\t// to various AnimationCurveNodes and is referenced by an AnimationStack node\r\n\t// note: theoretically a stack can have multiple layers, however in practice there always seems to be one per stack\r\n\tparseAnimationLayers( curveNodesMap ) {\r\n\r\n\t\tconst rawLayers = fbxTree.Objects.AnimationLayer;\r\n\r\n\t\tconst layersMap = new Map();\r\n\r\n\t\tfor ( const nodeID in rawLayers ) {\r\n\r\n\t\t\tconst layerCurveNodes = [];\r\n\r\n\t\t\tconst connection = connections.get( parseInt( nodeID ) );\r\n\r\n\t\t\tif ( connection !== undefined ) {\r\n\r\n\t\t\t\t// all the animationCurveNodes used in the layer\r\n\t\t\t\tconst children = connection.children;\r\n\r\n\t\t\t\tchildren.forEach( function ( child, i ) {\r\n\r\n\t\t\t\t\tif ( curveNodesMap.has( child.ID ) ) {\r\n\r\n\t\t\t\t\t\tconst curveNode = curveNodesMap.get( child.ID );\r\n\r\n\t\t\t\t\t\t// check that the curves are defined for at least one axis, otherwise ignore the curveNode\r\n\t\t\t\t\t\tif ( curveNode.curves.x !== undefined || curveNode.curves.y !== undefined || curveNode.curves.z !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tconst modelID = connections.get( child.ID ).parents.filter( function ( parent ) {\r\n\r\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\r\n\r\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\tif ( modelID !== undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID.toString() ];\r\n\r\n\t\t\t\t\t\t\t\t\tif ( rawModel === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered a unused curve.', child );\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tconst node = {\r\n\r\n\t\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\r\n\t\t\t\t\t\t\t\t\t\tID: rawModel.id,\r\n\t\t\t\t\t\t\t\t\t\tinitialPosition: [ 0, 0, 0 ],\r\n\t\t\t\t\t\t\t\t\t\tinitialRotation: [ 0, 0, 0 ],\r\n\t\t\t\t\t\t\t\t\t\tinitialScale: [ 1, 1, 1 ],\r\n\r\n\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\tsceneGraph.traverse( function ( child ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif ( child.ID === rawModel.id ) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tnode.transform = child.matrix;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ( child.userData.transformData ) node.eulerOrder = child.userData.transformData.eulerOrder;\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t\t\t\tif ( ! node.transform ) node.transform = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\t\t// if the animated model is pre rotated, we'll have to apply the pre rotations to every\r\n\t\t\t\t\t\t\t\t\t// animation value as well\r\n\t\t\t\t\t\t\t\t\tif ( 'PreRotation' in rawModel ) node.preRotation = rawModel.PreRotation.value;\r\n\t\t\t\t\t\t\t\t\tif ( 'PostRotation' in rawModel ) node.postRotation = rawModel.PostRotation.value;\r\n\r\n\t\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] ) layerCurveNodes[ i ][ curveNode.attr ] = curveNode;\r\n\r\n\t\t\t\t\t\t} else if ( curveNode.curves.morph !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tif ( layerCurveNodes[ i ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tconst deformerID = connections.get( child.ID ).parents.filter( function ( parent ) {\r\n\r\n\t\t\t\t\t\t\t\t\treturn parent.relationship !== undefined;\r\n\r\n\t\t\t\t\t\t\t\t} )[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\tconst morpherID = connections.get( deformerID ).parents[ 0 ].ID;\r\n\t\t\t\t\t\t\t\tconst geoID = connections.get( morpherID ).parents[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\t// assuming geometry is not used in more than one model\r\n\t\t\t\t\t\t\t\tconst modelID = connections.get( geoID ).parents[ 0 ].ID;\r\n\r\n\t\t\t\t\t\t\t\tconst rawModel = fbxTree.Objects.Model[ modelID ];\r\n\r\n\t\t\t\t\t\t\t\tconst node = {\r\n\r\n\t\t\t\t\t\t\t\t\tmodelName: rawModel.attrName ? PropertyBinding.sanitizeNodeName( rawModel.attrName ) : '',\r\n\t\t\t\t\t\t\t\t\tmorphName: fbxTree.Objects.Deformer[ deformerID ].attrName,\r\n\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tlayerCurveNodes[ i ] = node;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlayerCurveNodes[ i ][ curveNode.attr ] = curveNode;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tlayersMap.set( parseInt( nodeID ), layerCurveNodes );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn layersMap;\r\n\r\n\t}\r\n\r\n\t// parse nodes in FBXTree.Objects.AnimationStack. These are the top level node in the animation\r\n\t// hierarchy. Each Stack node will be used to create a AnimationClip\r\n\tparseAnimStacks( layersMap ) {\r\n\r\n\t\tconst rawStacks = fbxTree.Objects.AnimationStack;\r\n\r\n\t\t// connect the stacks (clips) up to the layers\r\n\t\tconst rawClips = {};\r\n\r\n\t\tfor ( const nodeID in rawStacks ) {\r\n\r\n\t\t\tconst children = connections.get( parseInt( nodeID ) ).children;\r\n\r\n\t\t\tif ( children.length > 1 ) {\r\n\r\n\t\t\t\t// it seems like stacks will always be associated with a single layer. But just in case there are files\r\n\t\t\t\t// where there are multiple layers per stack, we'll display a warning\r\n\t\t\t\tconsole.warn( 'THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst layer = layersMap.get( children[ 0 ].ID );\r\n\r\n\t\t\trawClips[ nodeID ] = {\r\n\r\n\t\t\t\tname: rawStacks[ nodeID ].attrName,\r\n\t\t\t\tlayer: layer,\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\treturn rawClips;\r\n\r\n\t}\r\n\r\n\taddClip( rawClip ) {\r\n\r\n\t\tlet tracks = [];\r\n\r\n\t\tconst scope = this;\r\n\t\trawClip.layer.forEach( function ( rawTracks ) {\r\n\r\n\t\t\ttracks = tracks.concat( scope.generateTracks( rawTracks ) );\r\n\r\n\t\t} );\r\n\r\n\t\treturn new AnimationClip( rawClip.name, - 1, tracks );\r\n\r\n\t}\r\n\r\n\tgenerateTracks( rawTracks ) {\r\n\r\n\t\tconst tracks = [];\r\n\r\n\t\tlet initialPosition = new Vector3();\r\n\t\tlet initialRotation = new Quaternion();\r\n\t\tlet initialScale = new Vector3();\r\n\r\n\t\tif ( rawTracks.transform ) rawTracks.transform.decompose( initialPosition, initialRotation, initialScale );\r\n\r\n\t\tinitialPosition = initialPosition.toArray();\r\n\t\tinitialRotation = new Euler().setFromQuaternion( initialRotation, rawTracks.eulerOrder ).toArray();\r\n\t\tinitialScale = initialScale.toArray();\r\n\r\n\t\tif ( rawTracks.T !== undefined && Object.keys( rawTracks.T.curves ).length > 0 ) {\r\n\r\n\t\t\tconst positionTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.T.curves, initialPosition, 'position' );\r\n\t\t\tif ( positionTrack !== undefined ) tracks.push( positionTrack );\r\n\r\n\t\t}\r\n\r\n\t\tif ( rawTracks.R !== undefined && Object.keys( rawTracks.R.curves ).length > 0 ) {\r\n\r\n\t\t\tconst rotationTrack = this.generateRotationTrack( rawTracks.modelName, rawTracks.R.curves, initialRotation, rawTracks.preRotation, rawTracks.postRotation, rawTracks.eulerOrder );\r\n\t\t\tif ( rotationTrack !== undefined ) tracks.push( rotationTrack );\r\n\r\n\t\t}\r\n\r\n\t\tif ( rawTracks.S !== undefined && Object.keys( rawTracks.S.curves ).length > 0 ) {\r\n\r\n\t\t\tconst scaleTrack = this.generateVectorTrack( rawTracks.modelName, rawTracks.S.curves, initialScale, 'scale' );\r\n\t\t\tif ( scaleTrack !== undefined ) tracks.push( scaleTrack );\r\n\r\n\t\t}\r\n\r\n\t\tif ( rawTracks.DeformPercent !== undefined ) {\r\n\r\n\t\t\tconst morphTrack = this.generateMorphTrack( rawTracks );\r\n\t\t\tif ( morphTrack !== undefined ) tracks.push( morphTrack );\r\n\r\n\t\t}\r\n\r\n\t\treturn tracks;\r\n\r\n\t}\r\n\r\n\tgenerateVectorTrack( modelName, curves, initialValue, type ) {\r\n\r\n\t\tconst times = this.getTimesForAllAxes( curves );\r\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\r\n\r\n\t\treturn new VectorKeyframeTrack( modelName + '.' + type, times, values );\r\n\r\n\t}\r\n\r\n\tgenerateRotationTrack( modelName, curves, initialValue, preRotation, postRotation, eulerOrder ) {\r\n\r\n\t\tif ( curves.x !== undefined ) {\r\n\r\n\t\t\tthis.interpolateRotations( curves.x );\r\n\t\t\tcurves.x.values = curves.x.values.map( MathUtils.degToRad );\r\n\r\n\t\t}\r\n\r\n\t\tif ( curves.y !== undefined ) {\r\n\r\n\t\t\tthis.interpolateRotations( curves.y );\r\n\t\t\tcurves.y.values = curves.y.values.map( MathUtils.degToRad );\r\n\r\n\t\t}\r\n\r\n\t\tif ( curves.z !== undefined ) {\r\n\r\n\t\t\tthis.interpolateRotations( curves.z );\r\n\t\t\tcurves.z.values = curves.z.values.map( MathUtils.degToRad );\r\n\r\n\t\t}\r\n\r\n\t\tconst times = this.getTimesForAllAxes( curves );\r\n\t\tconst values = this.getKeyframeTrackValues( times, curves, initialValue );\r\n\r\n\t\tif ( preRotation !== undefined ) {\r\n\r\n\t\t\tpreRotation = preRotation.map( MathUtils.degToRad );\r\n\t\t\tpreRotation.push( eulerOrder );\r\n\r\n\t\t\tpreRotation = new Euler().fromArray( preRotation );\r\n\t\t\tpreRotation = new Quaternion().setFromEuler( preRotation );\r\n\r\n\t\t}\r\n\r\n\t\tif ( postRotation !== undefined ) {\r\n\r\n\t\t\tpostRotation = postRotation.map( MathUtils.degToRad );\r\n\t\t\tpostRotation.push( eulerOrder );\r\n\r\n\t\t\tpostRotation = new Euler().fromArray( postRotation );\r\n\t\t\tpostRotation = new Quaternion().setFromEuler( postRotation ).invert();\r\n\r\n\t\t}\r\n\r\n\t\tconst quaternion = new Quaternion();\r\n\t\tconst euler = new Euler();\r\n\r\n\t\tconst quaternionValues = [];\r\n\r\n\t\tfor ( let i = 0; i < values.length; i += 3 ) {\r\n\r\n\t\t\teuler.set( values[ i ], values[ i + 1 ], values[ i + 2 ], eulerOrder );\r\n\r\n\t\t\tquaternion.setFromEuler( euler );\r\n\r\n\t\t\tif ( preRotation !== undefined ) quaternion.premultiply( preRotation );\r\n\t\t\tif ( postRotation !== undefined ) quaternion.multiply( postRotation );\r\n\r\n\t\t\tquaternion.toArray( quaternionValues, ( i / 3 ) * 4 );\r\n\r\n\t\t}\r\n\r\n\t\treturn new QuaternionKeyframeTrack( modelName + '.quaternion', times, quaternionValues );\r\n\r\n\t}\r\n\r\n\tgenerateMorphTrack( rawTracks ) {\r\n\r\n\t\tconst curves = rawTracks.DeformPercent.curves.morph;\r\n\t\tconst values = curves.values.map( function ( val ) {\r\n\r\n\t\t\treturn val / 100;\r\n\r\n\t\t} );\r\n\r\n\t\tconst morphNum = sceneGraph.getObjectByName( rawTracks.modelName ).morphTargetDictionary[ rawTracks.morphName ];\r\n\r\n\t\treturn new NumberKeyframeTrack( rawTracks.modelName + '.morphTargetInfluences[' + morphNum + ']', curves.times, values );\r\n\r\n\t}\r\n\r\n\t// For all animated objects, times are defined separately for each axis\r\n\t// Here we'll combine the times into one sorted array without duplicates\r\n\tgetTimesForAllAxes( curves ) {\r\n\r\n\t\tlet times = [];\r\n\r\n\t\t// first join together the times for each axis, if defined\r\n\t\tif ( curves.x !== undefined ) times = times.concat( curves.x.times );\r\n\t\tif ( curves.y !== undefined ) times = times.concat( curves.y.times );\r\n\t\tif ( curves.z !== undefined ) times = times.concat( curves.z.times );\r\n\r\n\t\t// then sort them\r\n\t\ttimes = times.sort( function ( a, b ) {\r\n\r\n\t\t\treturn a - b;\r\n\r\n\t\t} );\r\n\r\n\t\t// and remove duplicates\r\n\t\tif ( times.length > 1 ) {\r\n\r\n\t\t\tlet targetIndex = 1;\r\n\t\t\tlet lastValue = times[ 0 ];\r\n\t\t\tfor ( let i = 1; i < times.length; i ++ ) {\r\n\r\n\t\t\t\tconst currentValue = times[ i ];\r\n\t\t\t\tif ( currentValue !== lastValue ) {\r\n\r\n\t\t\t\t\ttimes[ targetIndex ] = currentValue;\r\n\t\t\t\t\tlastValue = currentValue;\r\n\t\t\t\t\ttargetIndex ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttimes = times.slice( 0, targetIndex );\r\n\r\n\t\t}\r\n\r\n\t\treturn times;\r\n\r\n\t}\r\n\r\n\tgetKeyframeTrackValues( times, curves, initialValue ) {\r\n\r\n\t\tconst prevValue = initialValue;\r\n\r\n\t\tconst values = [];\r\n\r\n\t\tlet xIndex = - 1;\r\n\t\tlet yIndex = - 1;\r\n\t\tlet zIndex = - 1;\r\n\r\n\t\ttimes.forEach( function ( time ) {\r\n\r\n\t\t\tif ( curves.x ) xIndex = curves.x.times.indexOf( time );\r\n\t\t\tif ( curves.y ) yIndex = curves.y.times.indexOf( time );\r\n\t\t\tif ( curves.z ) zIndex = curves.z.times.indexOf( time );\r\n\r\n\t\t\t// if there is an x value defined for this frame, use that\r\n\t\t\tif ( xIndex !== - 1 ) {\r\n\r\n\t\t\t\tconst xValue = curves.x.values[ xIndex ];\r\n\t\t\t\tvalues.push( xValue );\r\n\t\t\t\tprevValue[ 0 ] = xValue;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// otherwise use the x value from the previous frame\r\n\t\t\t\tvalues.push( prevValue[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( yIndex !== - 1 ) {\r\n\r\n\t\t\t\tconst yValue = curves.y.values[ yIndex ];\r\n\t\t\t\tvalues.push( yValue );\r\n\t\t\t\tprevValue[ 1 ] = yValue;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvalues.push( prevValue[ 1 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( zIndex !== - 1 ) {\r\n\r\n\t\t\t\tconst zValue = curves.z.values[ zIndex ];\r\n\t\t\t\tvalues.push( zValue );\r\n\t\t\t\tprevValue[ 2 ] = zValue;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvalues.push( prevValue[ 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn values;\r\n\r\n\t}\r\n\r\n\t// Rotations are defined as Euler angles which can have values  of any size\r\n\t// These will be converted to quaternions which don't support values greater than\r\n\t// PI, so we'll interpolate large rotations\r\n\tinterpolateRotations( curve ) {\r\n\r\n\t\tfor ( let i = 1; i < curve.values.length; i ++ ) {\r\n\r\n\t\t\tconst initialValue = curve.values[ i - 1 ];\r\n\t\t\tconst valuesSpan = curve.values[ i ] - initialValue;\r\n\r\n\t\t\tconst absoluteSpan = Math.abs( valuesSpan );\r\n\r\n\t\t\tif ( absoluteSpan >= 180 ) {\r\n\r\n\t\t\t\tconst numSubIntervals = absoluteSpan / 180;\r\n\r\n\t\t\t\tconst step = valuesSpan / numSubIntervals;\r\n\t\t\t\tlet nextValue = initialValue + step;\r\n\r\n\t\t\t\tconst initialTime = curve.times[ i - 1 ];\r\n\t\t\t\tconst timeSpan = curve.times[ i ] - initialTime;\r\n\t\t\t\tconst interval = timeSpan / numSubIntervals;\r\n\t\t\t\tlet nextTime = initialTime + interval;\r\n\r\n\t\t\t\tconst interpolatedTimes = [];\r\n\t\t\t\tconst interpolatedValues = [];\r\n\r\n\t\t\t\twhile ( nextTime < curve.times[ i ] ) {\r\n\r\n\t\t\t\t\tinterpolatedTimes.push( nextTime );\r\n\t\t\t\t\tnextTime += interval;\r\n\r\n\t\t\t\t\tinterpolatedValues.push( nextValue );\r\n\t\t\t\t\tnextValue += step;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurve.times = inject( curve.times, i, interpolatedTimes );\r\n\t\t\t\tcurve.values = inject( curve.values, i, interpolatedValues );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n// parse an FBX file in ASCII format\r\nclass TextParser {\r\n\r\n\tgetPrevNode() {\r\n\r\n\t\treturn this.nodeStack[ this.currentIndent - 2 ];\r\n\r\n\t}\r\n\r\n\tgetCurrentNode() {\r\n\r\n\t\treturn this.nodeStack[ this.currentIndent - 1 ];\r\n\r\n\t}\r\n\r\n\tgetCurrentProp() {\r\n\r\n\t\treturn this.currentProp;\r\n\r\n\t}\r\n\r\n\tpushStack( node ) {\r\n\r\n\t\tthis.nodeStack.push( node );\r\n\t\tthis.currentIndent += 1;\r\n\r\n\t}\r\n\r\n\tpopStack() {\r\n\r\n\t\tthis.nodeStack.pop();\r\n\t\tthis.currentIndent -= 1;\r\n\r\n\t}\r\n\r\n\tsetCurrentProp( val, name ) {\r\n\r\n\t\tthis.currentProp = val;\r\n\t\tthis.currentPropName = name;\r\n\r\n\t}\r\n\r\n\tparse( text ) {\r\n\r\n\t\tthis.currentIndent = 0;\r\n\r\n\t\tthis.allNodes = new FBXTree();\r\n\t\tthis.nodeStack = [];\r\n\t\tthis.currentProp = [];\r\n\t\tthis.currentPropName = '';\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tconst split = text.split( /[\\r\\n]+/ );\r\n\r\n\t\tsplit.forEach( function ( line, i ) {\r\n\r\n\t\t\tconst matchComment = line.match( /^[\\s\\t]*;/ );\r\n\t\t\tconst matchEmpty = line.match( /^[\\s\\t]*$/ );\r\n\r\n\t\t\tif ( matchComment || matchEmpty ) return;\r\n\r\n\t\t\tconst matchBeginning = line.match( '^\\\\t{' + scope.currentIndent + '}(\\\\w+):(.*){', '' );\r\n\t\t\tconst matchProperty = line.match( '^\\\\t{' + ( scope.currentIndent ) + '}(\\\\w+):[\\\\s\\\\t\\\\r\\\\n](.*)' );\r\n\t\t\tconst matchEnd = line.match( '^\\\\t{' + ( scope.currentIndent - 1 ) + '}}' );\r\n\r\n\t\t\tif ( matchBeginning ) {\r\n\r\n\t\t\t\tscope.parseNodeBegin( line, matchBeginning );\r\n\r\n\t\t\t} else if ( matchProperty ) {\r\n\r\n\t\t\t\tscope.parseNodeProperty( line, matchProperty, split[ ++ i ] );\r\n\r\n\t\t\t} else if ( matchEnd ) {\r\n\r\n\t\t\t\tscope.popStack();\r\n\r\n\t\t\t} else if ( line.match( /^[^\\s\\t}]/ ) ) {\r\n\r\n\t\t\t\t// large arrays are split over multiple lines terminated with a ',' character\r\n\t\t\t\t// if this is encountered the line needs to be joined to the previous line\r\n\t\t\t\tscope.parseNodePropertyContinued( line );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\treturn this.allNodes;\r\n\r\n\t}\r\n\r\n\tparseNodeBegin( line, property ) {\r\n\r\n\t\tconst nodeName = property[ 1 ].trim().replace( /^\"/, '' ).replace( /\"$/, '' );\r\n\r\n\t\tconst nodeAttrs = property[ 2 ].split( ',' ).map( function ( attr ) {\r\n\r\n\t\t\treturn attr.trim().replace( /^\"/, '' ).replace( /\"$/, '' );\r\n\r\n\t\t} );\r\n\r\n\t\tconst node = { name: nodeName };\r\n\t\tconst attrs = this.parseNodeAttr( nodeAttrs );\r\n\r\n\t\tconst currentNode = this.getCurrentNode();\r\n\r\n\t\t// a top node\r\n\t\tif ( this.currentIndent === 0 ) {\r\n\r\n\t\t\tthis.allNodes.add( nodeName, node );\r\n\r\n\t\t} else { // a subnode\r\n\r\n\t\t\t// if the subnode already exists, append it\r\n\t\t\tif ( nodeName in currentNode ) {\r\n\r\n\t\t\t\t// special case Pose needs PoseNodes as an array\r\n\t\t\t\tif ( nodeName === 'PoseNode' ) {\r\n\r\n\t\t\t\t\tcurrentNode.PoseNode.push( node );\r\n\r\n\t\t\t\t} else if ( currentNode[ nodeName ].id !== undefined ) {\r\n\r\n\t\t\t\t\tcurrentNode[ nodeName ] = {};\r\n\t\t\t\t\tcurrentNode[ nodeName ][ currentNode[ nodeName ].id ] = currentNode[ nodeName ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( attrs.id !== '' ) currentNode[ nodeName ][ attrs.id ] = node;\r\n\r\n\t\t\t} else if ( typeof attrs.id === 'number' ) {\r\n\r\n\t\t\t\tcurrentNode[ nodeName ] = {};\r\n\t\t\t\tcurrentNode[ nodeName ][ attrs.id ] = node;\r\n\r\n\t\t\t} else if ( nodeName !== 'Properties70' ) {\r\n\r\n\t\t\t\tif ( nodeName === 'PoseNode' )\tcurrentNode[ nodeName ] = [ node ];\r\n\t\t\t\telse currentNode[ nodeName ] = node;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( typeof attrs.id === 'number' ) node.id = attrs.id;\r\n\t\tif ( attrs.name !== '' ) node.attrName = attrs.name;\r\n\t\tif ( attrs.type !== '' ) node.attrType = attrs.type;\r\n\r\n\t\tthis.pushStack( node );\r\n\r\n\t}\r\n\r\n\tparseNodeAttr( attrs ) {\r\n\r\n\t\tlet id = attrs[ 0 ];\r\n\r\n\t\tif ( attrs[ 0 ] !== '' ) {\r\n\r\n\t\t\tid = parseInt( attrs[ 0 ] );\r\n\r\n\t\t\tif ( isNaN( id ) ) {\r\n\r\n\t\t\t\tid = attrs[ 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet name = '', type = '';\r\n\r\n\t\tif ( attrs.length > 1 ) {\r\n\r\n\t\t\tname = attrs[ 1 ].replace( /^(\\w+)::/, '' );\r\n\t\t\ttype = attrs[ 2 ];\r\n\r\n\t\t}\r\n\r\n\t\treturn { id: id, name: name, type: type };\r\n\r\n\t}\r\n\r\n\tparseNodeProperty( line, property, contentLine ) {\r\n\r\n\t\tlet propName = property[ 1 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\r\n\t\tlet propValue = property[ 2 ].replace( /^\"/, '' ).replace( /\"$/, '' ).trim();\r\n\r\n\t\t// for special case: base64 image data follows \"Content: ,\" line\r\n\t\t//\tContent: ,\r\n\t\t//\t \"/9j/4RDaRXhpZgAATU0A...\"\r\n\t\tif ( propName === 'Content' && propValue === ',' ) {\r\n\r\n\t\t\tpropValue = contentLine.replace( /\"/g, '' ).replace( /,$/, '' ).trim();\r\n\r\n\t\t}\r\n\r\n\t\tconst currentNode = this.getCurrentNode();\r\n\t\tconst parentName = currentNode.name;\r\n\r\n\t\tif ( parentName === 'Properties70' ) {\r\n\r\n\t\t\tthis.parseNodeSpecialProperty( line, propName, propValue );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// Connections\r\n\t\tif ( propName === 'C' ) {\r\n\r\n\t\t\tconst connProps = propValue.split( ',' ).slice( 1 );\r\n\t\t\tconst from = parseInt( connProps[ 0 ] );\r\n\t\t\tconst to = parseInt( connProps[ 1 ] );\r\n\r\n\t\t\tlet rest = propValue.split( ',' ).slice( 3 );\r\n\r\n\t\t\trest = rest.map( function ( elem ) {\r\n\r\n\t\t\t\treturn elem.trim().replace( /^\"/, '' );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tpropName = 'connections';\r\n\t\t\tpropValue = [ from, to ];\r\n\t\t\tappend( propValue, rest );\r\n\r\n\t\t\tif ( currentNode[ propName ] === undefined ) {\r\n\r\n\t\t\t\tcurrentNode[ propName ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Node\r\n\t\tif ( propName === 'Node' ) currentNode.id = propValue;\r\n\r\n\t\t// connections\r\n\t\tif ( propName in currentNode && Array.isArray( currentNode[ propName ] ) ) {\r\n\r\n\t\t\tcurrentNode[ propName ].push( propValue );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( propName !== 'a' ) currentNode[ propName ] = propValue;\r\n\t\t\telse currentNode.a = propValue;\r\n\r\n\t\t}\r\n\r\n\t\tthis.setCurrentProp( currentNode, propName );\r\n\r\n\t\t// convert string to array, unless it ends in ',' in which case more will be added to it\r\n\t\tif ( propName === 'a' && propValue.slice( - 1 ) !== ',' ) {\r\n\r\n\t\t\tcurrentNode.a = parseNumberArray( propValue );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tparseNodePropertyContinued( line ) {\r\n\r\n\t\tconst currentNode = this.getCurrentNode();\r\n\r\n\t\tcurrentNode.a += line;\r\n\r\n\t\t// if the line doesn't end in ',' we have reached the end of the property value\r\n\t\t// so convert the string to an array\r\n\t\tif ( line.slice( - 1 ) !== ',' ) {\r\n\r\n\t\t\tcurrentNode.a = parseNumberArray( currentNode.a );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// parse \"Property70\"\r\n\tparseNodeSpecialProperty( line, propName, propValue ) {\r\n\r\n\t\t// split this\r\n\t\t// P: \"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\",1,1,1\r\n\t\t// into array like below\r\n\t\t// [\"Lcl Scaling\", \"Lcl Scaling\", \"\", \"A\", \"1,1,1\" ]\r\n\t\tconst props = propValue.split( '\",' ).map( function ( prop ) {\r\n\r\n\t\t\treturn prop.trim().replace( /^\\\"/, '' ).replace( /\\s/, '_' );\r\n\r\n\t\t} );\r\n\r\n\t\tconst innerPropName = props[ 0 ];\r\n\t\tconst innerPropType1 = props[ 1 ];\r\n\t\tconst innerPropType2 = props[ 2 ];\r\n\t\tconst innerPropFlag = props[ 3 ];\r\n\t\tlet innerPropValue = props[ 4 ];\r\n\r\n\t\t// cast values where needed, otherwise leave as strings\r\n\t\tswitch ( innerPropType1 ) {\r\n\r\n\t\t\tcase 'int':\r\n\t\t\tcase 'enum':\r\n\t\t\tcase 'bool':\r\n\t\t\tcase 'ULongLong':\r\n\t\t\tcase 'double':\r\n\t\t\tcase 'Number':\r\n\t\t\tcase 'FieldOfView':\r\n\t\t\t\tinnerPropValue = parseFloat( innerPropValue );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'Color':\r\n\t\t\tcase 'ColorRGB':\r\n\t\t\tcase 'Vector3D':\r\n\t\t\tcase 'Lcl_Translation':\r\n\t\t\tcase 'Lcl_Rotation':\r\n\t\t\tcase 'Lcl_Scaling':\r\n\t\t\t\tinnerPropValue = parseNumberArray( innerPropValue );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\t// CAUTION: these props must append to parent's parent\r\n\t\tthis.getPrevNode()[ innerPropName ] = {\r\n\r\n\t\t\t'type': innerPropType1,\r\n\t\t\t'type2': innerPropType2,\r\n\t\t\t'flag': innerPropFlag,\r\n\t\t\t'value': innerPropValue\r\n\r\n\t\t};\r\n\r\n\t\tthis.setCurrentProp( this.getPrevNode(), innerPropName );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Parse an FBX file in Binary format\r\nclass BinaryParser {\r\n\r\n\tparse( buffer ) {\r\n\r\n\t\tconst reader = new BinaryReader( buffer );\r\n\t\treader.skip( 23 ); // skip magic 23 bytes\r\n\r\n\t\tconst version = reader.getUint32();\r\n\r\n\t\tif ( version < 6400 ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.FBXLoader: FBX version not supported, FileVersion: ' + version );\r\n\r\n\t\t}\r\n\r\n\t\tconst allNodes = new FBXTree();\r\n\r\n\t\twhile ( ! this.endOfContent( reader ) ) {\r\n\r\n\t\t\tconst node = this.parseNode( reader, version );\r\n\t\t\tif ( node !== null ) allNodes.add( node.name, node );\r\n\r\n\t\t}\r\n\r\n\t\treturn allNodes;\r\n\r\n\t}\r\n\r\n\t// Check if reader has reached the end of content.\r\n\tendOfContent( reader ) {\r\n\r\n\t\t// footer size: 160bytes + 16-byte alignment padding\r\n\t\t// - 16bytes: magic\r\n\t\t// - padding til 16-byte alignment (at least 1byte?)\r\n\t\t//\t(seems like some exporters embed fixed 15 or 16bytes?)\r\n\t\t// - 4bytes: magic\r\n\t\t// - 4bytes: version\r\n\t\t// - 120bytes: zero\r\n\t\t// - 16bytes: magic\r\n\t\tif ( reader.size() % 16 === 0 ) {\r\n\r\n\t\t\treturn ( ( reader.getOffset() + 160 + 16 ) & ~ 0xf ) >= reader.size();\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn reader.getOffset() + 160 + 16 >= reader.size();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// recursively parse nodes until the end of the file is reached\r\n\tparseNode( reader, version ) {\r\n\r\n\t\tconst node = {};\r\n\r\n\t\t// The first three data sizes depends on version.\r\n\t\tconst endOffset = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\r\n\t\tconst numProperties = ( version >= 7500 ) ? reader.getUint64() : reader.getUint32();\r\n\r\n\t\t( version >= 7500 ) ? reader.getUint64() : reader.getUint32(); // the returned propertyListLen is not used\r\n\r\n\t\tconst nameLen = reader.getUint8();\r\n\t\tconst name = reader.getString( nameLen );\r\n\r\n\t\t// Regards this node as NULL-record if endOffset is zero\r\n\t\tif ( endOffset === 0 ) return null;\r\n\r\n\t\tconst propertyList = [];\r\n\r\n\t\tfor ( let i = 0; i < numProperties; i ++ ) {\r\n\r\n\t\t\tpropertyList.push( this.parseProperty( reader ) );\r\n\r\n\t\t}\r\n\r\n\t\t// Regards the first three elements in propertyList as id, attrName, and attrType\r\n\t\tconst id = propertyList.length > 0 ? propertyList[ 0 ] : '';\r\n\t\tconst attrName = propertyList.length > 1 ? propertyList[ 1 ] : '';\r\n\t\tconst attrType = propertyList.length > 2 ? propertyList[ 2 ] : '';\r\n\r\n\t\t// check if this node represents just a single property\r\n\t\t// like (name, 0) set or (name2, [0, 1, 2]) set of {name: 0, name2: [0, 1, 2]}\r\n\t\tnode.singleProperty = ( numProperties === 1 && reader.getOffset() === endOffset ) ? true : false;\r\n\r\n\t\twhile ( endOffset > reader.getOffset() ) {\r\n\r\n\t\t\tconst subNode = this.parseNode( reader, version );\r\n\r\n\t\t\tif ( subNode !== null ) this.parseSubNode( name, node, subNode );\r\n\r\n\t\t}\r\n\r\n\t\tnode.propertyList = propertyList; // raw property list used by parent\r\n\r\n\t\tif ( typeof id === 'number' ) node.id = id;\r\n\t\tif ( attrName !== '' ) node.attrName = attrName;\r\n\t\tif ( attrType !== '' ) node.attrType = attrType;\r\n\t\tif ( name !== '' ) node.name = name;\r\n\r\n\t\treturn node;\r\n\r\n\t}\r\n\r\n\tparseSubNode( name, node, subNode ) {\r\n\r\n\t\t// special case: child node is single property\r\n\t\tif ( subNode.singleProperty === true ) {\r\n\r\n\t\t\tconst value = subNode.propertyList[ 0 ];\r\n\r\n\t\t\tif ( Array.isArray( value ) ) {\r\n\r\n\t\t\t\tnode[ subNode.name ] = subNode;\r\n\r\n\t\t\t\tsubNode.a = value;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode[ subNode.name ] = value;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( name === 'Connections' && subNode.name === 'C' ) {\r\n\r\n\t\t\tconst array = [];\r\n\r\n\t\t\tsubNode.propertyList.forEach( function ( property, i ) {\r\n\r\n\t\t\t\t// first Connection is FBX type (OO, OP, etc.). We'll discard these\r\n\t\t\t\tif ( i !== 0 ) array.push( property );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( node.connections === undefined ) {\r\n\r\n\t\t\t\tnode.connections = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnode.connections.push( array );\r\n\r\n\t\t} else if ( subNode.name === 'Properties70' ) {\r\n\r\n\t\t\tconst keys = Object.keys( subNode );\r\n\r\n\t\t\tkeys.forEach( function ( key ) {\r\n\r\n\t\t\t\tnode[ key ] = subNode[ key ];\r\n\r\n\t\t\t} );\r\n\r\n\t\t} else if ( name === 'Properties70' && subNode.name === 'P' ) {\r\n\r\n\t\t\tlet innerPropName = subNode.propertyList[ 0 ];\r\n\t\t\tlet innerPropType1 = subNode.propertyList[ 1 ];\r\n\t\t\tconst innerPropType2 = subNode.propertyList[ 2 ];\r\n\t\t\tconst innerPropFlag = subNode.propertyList[ 3 ];\r\n\t\t\tlet innerPropValue;\r\n\r\n\t\t\tif ( innerPropName.indexOf( 'Lcl ' ) === 0 ) innerPropName = innerPropName.replace( 'Lcl ', 'Lcl_' );\r\n\t\t\tif ( innerPropType1.indexOf( 'Lcl ' ) === 0 ) innerPropType1 = innerPropType1.replace( 'Lcl ', 'Lcl_' );\r\n\r\n\t\t\tif ( innerPropType1 === 'Color' || innerPropType1 === 'ColorRGB' || innerPropType1 === 'Vector' || innerPropType1 === 'Vector3D' || innerPropType1.indexOf( 'Lcl_' ) === 0 ) {\r\n\r\n\t\t\t\tinnerPropValue = [\r\n\t\t\t\t\tsubNode.propertyList[ 4 ],\r\n\t\t\t\t\tsubNode.propertyList[ 5 ],\r\n\t\t\t\t\tsubNode.propertyList[ 6 ]\r\n\t\t\t\t];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tinnerPropValue = subNode.propertyList[ 4 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// this will be copied to parent, see above\r\n\t\t\tnode[ innerPropName ] = {\r\n\r\n\t\t\t\t'type': innerPropType1,\r\n\t\t\t\t'type2': innerPropType2,\r\n\t\t\t\t'flag': innerPropFlag,\r\n\t\t\t\t'value': innerPropValue\r\n\r\n\t\t\t};\r\n\r\n\t\t} else if ( node[ subNode.name ] === undefined ) {\r\n\r\n\t\t\tif ( typeof subNode.id === 'number' ) {\r\n\r\n\t\t\t\tnode[ subNode.name ] = {};\r\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tnode[ subNode.name ] = subNode;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( subNode.name === 'PoseNode' ) {\r\n\r\n\t\t\t\tif ( ! Array.isArray( node[ subNode.name ] ) ) {\r\n\r\n\t\t\t\t\tnode[ subNode.name ] = [ node[ subNode.name ] ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode[ subNode.name ].push( subNode );\r\n\r\n\t\t\t} else if ( node[ subNode.name ][ subNode.id ] === undefined ) {\r\n\r\n\t\t\t\tnode[ subNode.name ][ subNode.id ] = subNode;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tparseProperty( reader ) {\r\n\r\n\t\tconst type = reader.getString( 1 );\r\n\t\tlet length;\r\n\r\n\t\tswitch ( type ) {\r\n\r\n\t\t\tcase 'C':\r\n\t\t\t\treturn reader.getBoolean();\r\n\r\n\t\t\tcase 'D':\r\n\t\t\t\treturn reader.getFloat64();\r\n\r\n\t\t\tcase 'F':\r\n\t\t\t\treturn reader.getFloat32();\r\n\r\n\t\t\tcase 'I':\r\n\t\t\t\treturn reader.getInt32();\r\n\r\n\t\t\tcase 'L':\r\n\t\t\t\treturn reader.getInt64();\r\n\r\n\t\t\tcase 'R':\r\n\t\t\t\tlength = reader.getUint32();\r\n\t\t\t\treturn reader.getArrayBuffer( length );\r\n\r\n\t\t\tcase 'S':\r\n\t\t\t\tlength = reader.getUint32();\r\n\t\t\t\treturn reader.getString( length );\r\n\r\n\t\t\tcase 'Y':\r\n\t\t\t\treturn reader.getInt16();\r\n\r\n\t\t\tcase 'b':\r\n\t\t\tcase 'c':\r\n\t\t\tcase 'd':\r\n\t\t\tcase 'f':\r\n\t\t\tcase 'i':\r\n\t\t\tcase 'l':\r\n\r\n\t\t\t\tconst arrayLength = reader.getUint32();\r\n\t\t\t\tconst encoding = reader.getUint32(); // 0: non-compressed, 1: compressed\r\n\t\t\t\tconst compressedLength = reader.getUint32();\r\n\r\n\t\t\t\tif ( encoding === 0 ) {\r\n\r\n\t\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\tcase 'c':\r\n\t\t\t\t\t\t\treturn reader.getBooleanArray( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\t\treturn reader.getFloat64Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'f':\r\n\t\t\t\t\t\t\treturn reader.getFloat32Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\treturn reader.getInt32Array( arrayLength );\r\n\r\n\t\t\t\t\t\tcase 'l':\r\n\t\t\t\t\t\t\treturn reader.getInt64Array( arrayLength );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( typeof fflate === 'undefined' ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.FBXLoader: External library fflate.min.js required.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst data = fflate.unzlibSync( new Uint8Array( reader.getArrayBuffer( compressedLength ) ) ); // eslint-disable-line no-undef\r\n\t\t\t\tconst reader2 = new BinaryReader( data.buffer );\r\n\r\n\t\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\t\tcase 'b':\r\n\t\t\t\t\tcase 'c':\r\n\t\t\t\t\t\treturn reader2.getBooleanArray( arrayLength );\r\n\r\n\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\treturn reader2.getFloat64Array( arrayLength );\r\n\r\n\t\t\t\t\tcase 'f':\r\n\t\t\t\t\t\treturn reader2.getFloat32Array( arrayLength );\r\n\r\n\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\treturn reader2.getInt32Array( arrayLength );\r\n\r\n\t\t\t\t\tcase 'l':\r\n\t\t\t\t\t\treturn reader2.getInt64Array( arrayLength );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error( 'THREE.FBXLoader: Unknown property type ' + type );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass BinaryReader {\r\n\r\n\tconstructor( buffer, littleEndian ) {\r\n\r\n\t\tthis.dv = new DataView( buffer );\r\n\t\tthis.offset = 0;\r\n\t\tthis.littleEndian = ( littleEndian !== undefined ) ? littleEndian : true;\r\n\r\n\t}\r\n\r\n\tgetOffset() {\r\n\r\n\t\treturn this.offset;\r\n\r\n\t}\r\n\r\n\tsize() {\r\n\r\n\t\treturn this.dv.buffer.byteLength;\r\n\r\n\t}\r\n\r\n\tskip( length ) {\r\n\r\n\t\tthis.offset += length;\r\n\r\n\t}\r\n\r\n\t// seems like true/false representation depends on exporter.\r\n\t// true: 1 or 'Y'(=0x59), false: 0 or 'T'(=0x54)\r\n\t// then sees LSB.\r\n\tgetBoolean() {\r\n\r\n\t\treturn ( this.getUint8() & 1 ) === 1;\r\n\r\n\t}\r\n\r\n\tgetBooleanArray( size ) {\r\n\r\n\t\tconst a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getBoolean() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\tgetUint8() {\r\n\r\n\t\tconst value = this.dv.getUint8( this.offset );\r\n\t\tthis.offset += 1;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetInt16() {\r\n\r\n\t\tconst value = this.dv.getInt16( this.offset, this.littleEndian );\r\n\t\tthis.offset += 2;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetInt32() {\r\n\r\n\t\tconst value = this.dv.getInt32( this.offset, this.littleEndian );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetInt32Array( size ) {\r\n\r\n\t\tconst a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getInt32() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\tgetUint32() {\r\n\r\n\t\tconst value = this.dv.getUint32( this.offset, this.littleEndian );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\t// JavaScript doesn't support 64-bit integer so calculate this here\r\n\t// 1 << 32 will return 1 so using multiply operation instead here.\r\n\t// There's a possibility that this method returns wrong value if the value\r\n\t// is out of the range between Number.MAX_SAFE_INTEGER and Number.MIN_SAFE_INTEGER.\r\n\t// TODO: safely handle 64-bit integer\r\n\tgetInt64() {\r\n\r\n\t\tlet low, high;\r\n\r\n\t\tif ( this.littleEndian ) {\r\n\r\n\t\t\tlow = this.getUint32();\r\n\t\t\thigh = this.getUint32();\r\n\r\n\t\t} else {\r\n\r\n\t\t\thigh = this.getUint32();\r\n\t\t\tlow = this.getUint32();\r\n\r\n\t\t}\r\n\r\n\t\t// calculate negative value\r\n\t\tif ( high & 0x80000000 ) {\r\n\r\n\t\t\thigh = ~ high & 0xFFFFFFFF;\r\n\t\t\tlow = ~ low & 0xFFFFFFFF;\r\n\r\n\t\t\tif ( low === 0xFFFFFFFF ) high = ( high + 1 ) & 0xFFFFFFFF;\r\n\r\n\t\t\tlow = ( low + 1 ) & 0xFFFFFFFF;\r\n\r\n\t\t\treturn - ( high * 0x100000000 + low );\r\n\r\n\t\t}\r\n\r\n\t\treturn high * 0x100000000 + low;\r\n\r\n\t}\r\n\r\n\tgetInt64Array( size ) {\r\n\r\n\t\tconst a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getInt64() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\t// Note: see getInt64() comment\r\n\tgetUint64() {\r\n\r\n\t\tlet low, high;\r\n\r\n\t\tif ( this.littleEndian ) {\r\n\r\n\t\t\tlow = this.getUint32();\r\n\t\t\thigh = this.getUint32();\r\n\r\n\t\t} else {\r\n\r\n\t\t\thigh = this.getUint32();\r\n\t\t\tlow = this.getUint32();\r\n\r\n\t\t}\r\n\r\n\t\treturn high * 0x100000000 + low;\r\n\r\n\t}\r\n\r\n\tgetFloat32() {\r\n\r\n\t\tconst value = this.dv.getFloat32( this.offset, this.littleEndian );\r\n\t\tthis.offset += 4;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetFloat32Array( size ) {\r\n\r\n\t\tconst a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getFloat32() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\tgetFloat64() {\r\n\r\n\t\tconst value = this.dv.getFloat64( this.offset, this.littleEndian );\r\n\t\tthis.offset += 8;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetFloat64Array( size ) {\r\n\r\n\t\tconst a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta.push( this.getFloat64() );\r\n\r\n\t\t}\r\n\r\n\t\treturn a;\r\n\r\n\t}\r\n\r\n\tgetArrayBuffer( size ) {\r\n\r\n\t\tconst value = this.dv.buffer.slice( this.offset, this.offset + size );\r\n\t\tthis.offset += size;\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n\tgetString( size ) {\r\n\r\n\t\t// note: safari 9 doesn't support Uint8Array.indexOf; create intermediate array instead\r\n\t\tlet a = [];\r\n\r\n\t\tfor ( let i = 0; i < size; i ++ ) {\r\n\r\n\t\t\ta[ i ] = this.getUint8();\r\n\r\n\t\t}\r\n\r\n\t\tconst nullByte = a.indexOf( 0 );\r\n\t\tif ( nullByte >= 0 ) a = a.slice( 0, nullByte );\r\n\r\n\t\treturn LoaderUtils.decodeText( new Uint8Array( a ) );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// FBXTree holds a representation of the FBX data, returned by the TextParser ( FBX ASCII format)\r\n// and BinaryParser( FBX Binary format)\r\nclass FBXTree {\r\n\r\n\tadd( key, val ) {\r\n\r\n\t\tthis[ key ] = val;\r\n\r\n\t}\r\n\r\n}\r\n\r\n// ************** UTILITY FUNCTIONS **************\r\n\r\nfunction isFbxFormatBinary( buffer ) {\r\n\r\n\tconst CORRECT = 'Kaydara\\u0020FBX\\u0020Binary\\u0020\\u0020\\0';\r\n\r\n\treturn buffer.byteLength >= CORRECT.length && CORRECT === convertArrayBufferToString( buffer, 0, CORRECT.length );\r\n\r\n}\r\n\r\nfunction isFbxFormatASCII( text ) {\r\n\r\n\tconst CORRECT = [ 'K', 'a', 'y', 'd', 'a', 'r', 'a', '\\\\', 'F', 'B', 'X', '\\\\', 'B', 'i', 'n', 'a', 'r', 'y', '\\\\', '\\\\' ];\r\n\r\n\tlet cursor = 0;\r\n\r\n\tfunction read( offset ) {\r\n\r\n\t\tconst result = text[ offset - 1 ];\r\n\t\ttext = text.slice( cursor + offset );\r\n\t\tcursor ++;\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\tfor ( let i = 0; i < CORRECT.length; ++ i ) {\r\n\r\n\t\tconst num = read( 1 );\r\n\t\tif ( num === CORRECT[ i ] ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\nfunction getFbxVersion( text ) {\r\n\r\n\tconst versionRegExp = /FBXVersion: (\\d+)/;\r\n\tconst match = text.match( versionRegExp );\r\n\r\n\tif ( match ) {\r\n\r\n\t\tconst version = parseInt( match[ 1 ] );\r\n\t\treturn version;\r\n\r\n\t}\r\n\r\n\tthrow new Error( 'THREE.FBXLoader: Cannot find the version number for the file given.' );\r\n\r\n}\r\n\r\n// Converts FBX ticks into real time seconds.\r\nfunction convertFBXTimeToSeconds( time ) {\r\n\r\n\treturn time / 46186158000;\r\n\r\n}\r\n\r\nconst dataArray = [];\r\n\r\n// extracts the data from the correct position in the FBX array based on indexing type\r\nfunction getData( polygonVertexIndex, polygonIndex, vertexIndex, infoObject ) {\r\n\r\n\tlet index;\r\n\r\n\tswitch ( infoObject.mappingType ) {\r\n\r\n\t\tcase 'ByPolygonVertex' :\r\n\t\t\tindex = polygonVertexIndex;\r\n\t\t\tbreak;\r\n\t\tcase 'ByPolygon' :\r\n\t\t\tindex = polygonIndex;\r\n\t\t\tbreak;\r\n\t\tcase 'ByVertice' :\r\n\t\t\tindex = vertexIndex;\r\n\t\t\tbreak;\r\n\t\tcase 'AllSame' :\r\n\t\t\tindex = infoObject.indices[ 0 ];\r\n\t\t\tbreak;\r\n\t\tdefault :\r\n\t\t\tconsole.warn( 'THREE.FBXLoader: unknown attribute mapping type ' + infoObject.mappingType );\r\n\r\n\t}\r\n\r\n\tif ( infoObject.referenceType === 'IndexToDirect' ) index = infoObject.indices[ index ];\r\n\r\n\tconst from = index * infoObject.dataSize;\r\n\tconst to = from + infoObject.dataSize;\r\n\r\n\treturn slice( dataArray, infoObject.buffer, from, to );\r\n\r\n}\r\n\r\nconst tempEuler = new Euler();\r\nconst tempVec = new Vector3();\r\n\r\n// generate transformation from FBX transform data\r\n// ref: https://help.autodesk.com/view/FBX/2017/ENU/?guid=__files_GUID_10CDD63C_79C1_4F2D_BB28_AD2BE65A02ED_htm\r\n// ref: http://docs.autodesk.com/FBX/2014/ENU/FBX-SDK-Documentation/index.html?url=cpp_ref/_transformations_2main_8cxx-example.html,topicNumber=cpp_ref__transformations_2main_8cxx_example_htmlfc10a1e1-b18d-4e72-9dc0-70d0f1959f5e\r\nfunction generateTransform( transformData ) {\r\n\r\n\tconst lTranslationM = new Matrix4();\r\n\tconst lPreRotationM = new Matrix4();\r\n\tconst lRotationM = new Matrix4();\r\n\tconst lPostRotationM = new Matrix4();\r\n\r\n\tconst lScalingM = new Matrix4();\r\n\tconst lScalingPivotM = new Matrix4();\r\n\tconst lScalingOffsetM = new Matrix4();\r\n\tconst lRotationOffsetM = new Matrix4();\r\n\tconst lRotationPivotM = new Matrix4();\r\n\r\n\tconst lParentGX = new Matrix4();\r\n\tconst lParentLX = new Matrix4();\r\n\tconst lGlobalT = new Matrix4();\r\n\r\n\tconst inheritType = ( transformData.inheritType ) ? transformData.inheritType : 0;\r\n\r\n\tif ( transformData.translation ) lTranslationM.setPosition( tempVec.fromArray( transformData.translation ) );\r\n\r\n\tif ( transformData.preRotation ) {\r\n\r\n\t\tconst array = transformData.preRotation.map( MathUtils.degToRad );\r\n\t\tarray.push( transformData.eulerOrder );\r\n\t\tlPreRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\r\n\t}\r\n\r\n\tif ( transformData.rotation ) {\r\n\r\n\t\tconst array = transformData.rotation.map( MathUtils.degToRad );\r\n\t\tarray.push( transformData.eulerOrder );\r\n\t\tlRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\r\n\t}\r\n\r\n\tif ( transformData.postRotation ) {\r\n\r\n\t\tconst array = transformData.postRotation.map( MathUtils.degToRad );\r\n\t\tarray.push( transformData.eulerOrder );\r\n\t\tlPostRotationM.makeRotationFromEuler( tempEuler.fromArray( array ) );\r\n\t\tlPostRotationM.invert();\r\n\r\n\t}\r\n\r\n\tif ( transformData.scale ) lScalingM.scale( tempVec.fromArray( transformData.scale ) );\r\n\r\n\t// Pivots and offsets\r\n\tif ( transformData.scalingOffset ) lScalingOffsetM.setPosition( tempVec.fromArray( transformData.scalingOffset ) );\r\n\tif ( transformData.scalingPivot ) lScalingPivotM.setPosition( tempVec.fromArray( transformData.scalingPivot ) );\r\n\tif ( transformData.rotationOffset ) lRotationOffsetM.setPosition( tempVec.fromArray( transformData.rotationOffset ) );\r\n\tif ( transformData.rotationPivot ) lRotationPivotM.setPosition( tempVec.fromArray( transformData.rotationPivot ) );\r\n\r\n\t// parent transform\r\n\tif ( transformData.parentMatrixWorld ) {\r\n\r\n\t\tlParentLX.copy( transformData.parentMatrix );\r\n\t\tlParentGX.copy( transformData.parentMatrixWorld );\r\n\r\n\t}\r\n\r\n\tconst lLRM = lPreRotationM.clone().multiply( lRotationM ).multiply( lPostRotationM );\r\n\t// Global Rotation\r\n\tconst lParentGRM = new Matrix4();\r\n\tlParentGRM.extractRotation( lParentGX );\r\n\r\n\t// Global Shear*Scaling\r\n\tconst lParentTM = new Matrix4();\r\n\tlParentTM.copyPosition( lParentGX );\r\n\r\n\tconst lParentGRSM = lParentTM.clone().invert().multiply( lParentGX );\r\n\tconst lParentGSM = lParentGRM.clone().invert().multiply( lParentGRSM );\r\n\tconst lLSM = lScalingM;\r\n\r\n\tconst lGlobalRS = new Matrix4();\r\n\r\n\tif ( inheritType === 0 ) {\r\n\r\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM ).multiply( lLSM );\r\n\r\n\t} else if ( inheritType === 1 ) {\r\n\r\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lParentGSM ).multiply( lLRM ).multiply( lLSM );\r\n\r\n\t} else {\r\n\r\n\t\tconst lParentLSM = new Matrix4().scale( new Vector3().setFromMatrixScale( lParentLX ) );\r\n\t\tconst lParentLSM_inv = lParentLSM.clone().invert();\r\n\t\tconst lParentGSM_noLocal = lParentGSM.clone().multiply( lParentLSM_inv );\r\n\r\n\t\tlGlobalRS.copy( lParentGRM ).multiply( lLRM ).multiply( lParentGSM_noLocal ).multiply( lLSM );\r\n\r\n\t}\r\n\r\n\tconst lRotationPivotM_inv = lRotationPivotM.clone().invert();\r\n\tconst lScalingPivotM_inv = lScalingPivotM.clone().invert();\r\n\t// Calculate the local transform matrix\r\n\tlet lTransform = lTranslationM.clone().multiply( lRotationOffsetM ).multiply( lRotationPivotM ).multiply( lPreRotationM ).multiply( lRotationM ).multiply( lPostRotationM ).multiply( lRotationPivotM_inv ).multiply( lScalingOffsetM ).multiply( lScalingPivotM ).multiply( lScalingM ).multiply( lScalingPivotM_inv );\r\n\r\n\tconst lLocalTWithAllPivotAndOffsetInfo = new Matrix4().copyPosition( lTransform );\r\n\r\n\tconst lGlobalTranslation = lParentGX.clone().multiply( lLocalTWithAllPivotAndOffsetInfo );\r\n\tlGlobalT.copyPosition( lGlobalTranslation );\r\n\r\n\tlTransform = lGlobalT.clone().multiply( lGlobalRS );\r\n\r\n\t// from global to local\r\n\tlTransform.premultiply( lParentGX.invert() );\r\n\r\n\treturn lTransform;\r\n\r\n}\r\n\r\n// Returns the three.js intrinsic Euler order corresponding to FBX extrinsic Euler order\r\n// ref: http://help.autodesk.com/view/FBX/2017/ENU/?guid=__cpp_ref_class_fbx_euler_html\r\nfunction getEulerOrder( order ) {\r\n\r\n\torder = order || 0;\r\n\r\n\tconst enums = [\r\n\t\t'ZYX', // -> XYZ extrinsic\r\n\t\t'YZX', // -> XZY extrinsic\r\n\t\t'XZY', // -> YZX extrinsic\r\n\t\t'ZXY', // -> YXZ extrinsic\r\n\t\t'YXZ', // -> ZXY extrinsic\r\n\t\t'XYZ', // -> ZYX extrinsic\r\n\t\t//'SphericXYZ', // not possible to support\r\n\t];\r\n\r\n\tif ( order === 6 ) {\r\n\r\n\t\tconsole.warn( 'THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.' );\r\n\t\treturn enums[ 0 ];\r\n\r\n\t}\r\n\r\n\treturn enums[ order ];\r\n\r\n}\r\n\r\n// Parses comma separated list of numbers and returns them an array.\r\n// Used internally by the TextParser\r\nfunction parseNumberArray( value ) {\r\n\r\n\tconst array = value.split( ',' ).map( function ( val ) {\r\n\r\n\t\treturn parseFloat( val );\r\n\r\n\t} );\r\n\r\n\treturn array;\r\n\r\n}\r\n\r\nfunction convertArrayBufferToString( buffer, from, to ) {\r\n\r\n\tif ( from === undefined ) from = 0;\r\n\tif ( to === undefined ) to = buffer.byteLength;\r\n\r\n\treturn LoaderUtils.decodeText( new Uint8Array( buffer, from, to ) );\r\n\r\n}\r\n\r\nfunction append( a, b ) {\r\n\r\n\tfor ( let i = 0, j = a.length, l = b.length; i < l; i ++, j ++ ) {\r\n\r\n\t\ta[ j ] = b[ i ];\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction slice( a, b, from, to ) {\r\n\r\n\tfor ( let i = from, j = 0; i < to; i ++, j ++ ) {\r\n\r\n\t\ta[ j ] = b[ i ];\r\n\r\n\t}\r\n\r\n\treturn a;\r\n\r\n}\r\n\r\n// inject array a2 into array a1 at index\r\nfunction inject( a1, index, a2 ) {\r\n\r\n\treturn a1.slice( 0, index ).concat( a2 ).concat( a1.slice( index ) );\r\n\r\n}\r\n\r\nexport { FBXLoader };","import {\r\n\tVector3,\r\n\tVector4\r\n} from 'three';\r\n\r\n/**\r\n * NURBS utils\r\n *\r\n * See NURBSCurve and NURBSSurface.\r\n **/\r\n\r\n\r\n/**************************************************************\r\n *\tNURBS Utils\r\n **************************************************************/\r\n\r\nclass NURBSUtils {\r\n\r\n\t/*\r\n\tFinds knot vector span.\r\n\tp : degree\r\n\tu : parametric value\r\n\tU : knot vector\r\n\treturns the span\r\n\t*/\r\n\tstatic findSpan( p, u, U ) {\r\n\r\n\t\tconst n = U.length - p - 1;\r\n\r\n\t\tif ( u >= U[ n ] ) {\r\n\r\n\t\t\treturn n - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( u <= U[ p ] ) {\r\n\r\n\t\t\treturn p;\r\n\r\n\t\t}\r\n\r\n\t\tlet low = p;\r\n\t\tlet high = n;\r\n\t\tlet mid = Math.floor( ( low + high ) / 2 );\r\n\r\n\t\twhile ( u < U[ mid ] || u >= U[ mid + 1 ] ) {\r\n\r\n\t\t\tif ( u < U[ mid ] ) {\r\n\r\n\t\t\t\thigh = mid;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlow = mid;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmid = Math.floor( ( low + high ) / 2 );\r\n\r\n\t\t}\r\n\r\n\t\treturn mid;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate basis functions. See The NURBS Book, page 70, algorithm A2.2\r\n\tspan : span in which u lies\r\n\tu    : parametric point\r\n\tp    : degree\r\n\tU    : knot vector\r\n\treturns array[p+1] with basis functions values.\r\n\t*/\r\n\tstatic calcBasisFunctions( span, u, p, U ) {\r\n\r\n\t\tconst N = [];\r\n\t\tconst left = [];\r\n\t\tconst right = [];\r\n\t\tN[ 0 ] = 1.0;\r\n\r\n\t\tfor ( let j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\r\n\t\t\tright[ j ] = U[ span + j ] - u;\r\n\r\n\t\t\tlet saved = 0.0;\r\n\r\n\t\t\tfor ( let r = 0; r < j; ++ r ) {\r\n\r\n\t\t\t\tconst rv = right[ r + 1 ];\r\n\t\t\t\tconst lv = left[ j - r ];\r\n\t\t\t\tconst temp = N[ r ] / ( rv + lv );\r\n\t\t\t\tN[ r ] = saved + rv * temp;\r\n\t\t\t\tsaved = lv * temp;\r\n\r\n\t\t\t }\r\n\r\n\t\t\t N[ j ] = saved;\r\n\r\n\t\t }\r\n\r\n\t\t return N;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate B-Spline curve points. See The NURBS Book, page 82, algorithm A3.1.\r\n\tp : degree of B-Spline\r\n\tU : knot vector\r\n\tP : control points (x, y, z, w)\r\n\tu : parametric point\r\n\treturns point for given u\r\n\t*/\r\n\tstatic calcBSplinePoint( p, U, P, u ) {\r\n\r\n\t\tconst span = this.findSpan( p, u, U );\r\n\t\tconst N = this.calcBasisFunctions( span, u, p, U );\r\n\t\tconst C = new Vector4( 0, 0, 0, 0 );\r\n\r\n\t\tfor ( let j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\tconst point = P[ span - p + j ];\r\n\t\t\tconst Nj = N[ j ];\r\n\t\t\tconst wNj = point.w * Nj;\r\n\t\t\tC.x += point.x * wNj;\r\n\t\t\tC.y += point.y * wNj;\r\n\t\t\tC.z += point.z * wNj;\r\n\t\t\tC.w += point.w * Nj;\r\n\r\n\t\t}\r\n\r\n\t\treturn C;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate basis functions derivatives. See The NURBS Book, page 72, algorithm A2.3.\r\n\tspan : span in which u lies\r\n\tu    : parametric point\r\n\tp    : degree\r\n\tn    : number of derivatives to calculate\r\n\tU    : knot vector\r\n\treturns array[n+1][p+1] with basis functions derivatives\r\n\t*/\r\n\tstatic calcBasisFunctionDerivatives( span, u, p, n, U ) {\r\n\r\n\t\tconst zeroArr = [];\r\n\t\tfor ( let i = 0; i <= p; ++ i )\r\n\t\t\tzeroArr[ i ] = 0.0;\r\n\r\n\t\tconst ders = [];\r\n\r\n\t\tfor ( let i = 0; i <= n; ++ i )\r\n\t\t\tders[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\tconst ndu = [];\r\n\r\n\t\tfor ( let i = 0; i <= p; ++ i )\r\n\t\t\tndu[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\tndu[ 0 ][ 0 ] = 1.0;\r\n\r\n\t\tconst left = zeroArr.slice( 0 );\r\n\t\tconst right = zeroArr.slice( 0 );\r\n\r\n\t\tfor ( let j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\tleft[ j ] = u - U[ span + 1 - j ];\r\n\t\t\tright[ j ] = U[ span + j ] - u;\r\n\r\n\t\t\tlet saved = 0.0;\r\n\r\n\t\t\tfor ( let r = 0; r < j; ++ r ) {\r\n\r\n\t\t\t\tconst rv = right[ r + 1 ];\r\n\t\t\t\tconst lv = left[ j - r ];\r\n\t\t\t\tndu[ j ][ r ] = rv + lv;\r\n\r\n\t\t\t\tconst temp = ndu[ r ][ j - 1 ] / ndu[ j ][ r ];\r\n\t\t\t\tndu[ r ][ j ] = saved + rv * temp;\r\n\t\t\t\tsaved = lv * temp;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tndu[ j ][ j ] = saved;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\tders[ 0 ][ j ] = ndu[ j ][ p ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let r = 0; r <= p; ++ r ) {\r\n\r\n\t\t\tlet s1 = 0;\r\n\t\t\tlet s2 = 1;\r\n\r\n\t\t\tconst a = [];\r\n\t\t\tfor ( let i = 0; i <= p; ++ i ) {\r\n\r\n\t\t\t\ta[ i ] = zeroArr.slice( 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ta[ 0 ][ 0 ] = 1.0;\r\n\r\n\t\t\tfor ( let k = 1; k <= n; ++ k ) {\r\n\r\n\t\t\t\tlet d = 0.0;\r\n\t\t\t\tconst rk = r - k;\r\n\t\t\t\tconst pk = p - k;\r\n\r\n\t\t\t\tif ( r >= k ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ 0 ] = a[ s1 ][ 0 ] / ndu[ pk + 1 ][ rk ];\r\n\t\t\t\t\td = a[ s2 ][ 0 ] * ndu[ rk ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst j1 = ( rk >= - 1 ) ? 1 : - rk;\r\n\t\t\t\tconst j2 = ( r - 1 <= pk ) ? k - 1 : p - r;\r\n\r\n\t\t\t\tfor ( let j = j1; j <= j2; ++ j ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ j ] = ( a[ s1 ][ j ] - a[ s1 ][ j - 1 ] ) / ndu[ pk + 1 ][ rk + j ];\r\n\t\t\t\t\td += a[ s2 ][ j ] * ndu[ rk + j ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( r <= pk ) {\r\n\r\n\t\t\t\t\ta[ s2 ][ k ] = - a[ s1 ][ k - 1 ] / ndu[ pk + 1 ][ r ];\r\n\t\t\t\t\td += a[ s2 ][ k ] * ndu[ r ][ pk ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tders[ k ][ r ] = d;\r\n\r\n\t\t\t\tconst j = s1;\r\n\t\t\t\ts1 = s2;\r\n\t\t\t\ts2 = j;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet r = p;\r\n\r\n\t\tfor ( let k = 1; k <= n; ++ k ) {\r\n\r\n\t\t\tfor ( let j = 0; j <= p; ++ j ) {\r\n\r\n\t\t\t\tders[ k ][ j ] *= r;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tr *= p - k;\r\n\r\n\t\t}\r\n\r\n\t\treturn ders;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\t\tCalculate derivatives of a B-Spline. See The NURBS Book, page 93, algorithm A3.2.\r\n\t\tp  : degree\r\n\t\tU  : knot vector\r\n\t\tP  : control points\r\n\t\tu  : Parametric points\r\n\t\tnd : number of derivatives\r\n\t\treturns array[d+1] with derivatives\r\n\t\t*/\r\n\tstatic calcBSplineDerivatives( p, U, P, u, nd ) {\r\n\r\n\t\tconst du = nd < p ? nd : p;\r\n\t\tconst CK = [];\r\n\t\tconst span = this.findSpan( p, u, U );\r\n\t\tconst nders = this.calcBasisFunctionDerivatives( span, u, p, du, U );\r\n\t\tconst Pw = [];\r\n\r\n\t\tfor ( let i = 0; i < P.length; ++ i ) {\r\n\r\n\t\t\tconst point = P[ i ].clone();\r\n\t\t\tconst w = point.w;\r\n\r\n\t\t\tpoint.x *= w;\r\n\t\t\tpoint.y *= w;\r\n\t\t\tpoint.z *= w;\r\n\r\n\t\t\tPw[ i ] = point;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let k = 0; k <= du; ++ k ) {\r\n\r\n\t\t\tconst point = Pw[ span - p ].clone().multiplyScalar( nders[ k ][ 0 ] );\r\n\r\n\t\t\tfor ( let j = 1; j <= p; ++ j ) {\r\n\r\n\t\t\t\tpoint.add( Pw[ span - p + j ].clone().multiplyScalar( nders[ k ][ j ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tCK[ k ] = point;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let k = du + 1; k <= nd + 1; ++ k ) {\r\n\r\n\t\t\tCK[ k ] = new Vector4( 0, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\treturn CK;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate \"K over I\"\r\n\treturns k!/(i!(k-i)!)\r\n\t*/\r\n\tstatic calcKoverI( k, i ) {\r\n\r\n\t\tlet nom = 1;\r\n\r\n\t\tfor ( let j = 2; j <= k; ++ j ) {\r\n\r\n\t\t\tnom *= j;\r\n\r\n\t\t}\r\n\r\n\t\tlet denom = 1;\r\n\r\n\t\tfor ( let j = 2; j <= i; ++ j ) {\r\n\r\n\t\t\tdenom *= j;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let j = 2; j <= k - i; ++ j ) {\r\n\r\n\t\t\tdenom *= j;\r\n\r\n\t\t}\r\n\r\n\t\treturn nom / denom;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate derivatives (0-nd) of rational curve. See The NURBS Book, page 127, algorithm A4.2.\r\n\tPders : result of function calcBSplineDerivatives\r\n\treturns array with derivatives for rational curve.\r\n\t*/\r\n\tstatic calcRationalCurveDerivatives( Pders ) {\r\n\r\n\t\tconst nd = Pders.length;\r\n\t\tconst Aders = [];\r\n\t\tconst wders = [];\r\n\r\n\t\tfor ( let i = 0; i < nd; ++ i ) {\r\n\r\n\t\t\tconst point = Pders[ i ];\r\n\t\t\tAders[ i ] = new Vector3( point.x, point.y, point.z );\r\n\t\t\twders[ i ] = point.w;\r\n\r\n\t\t}\r\n\r\n\t\tconst CK = [];\r\n\r\n\t\tfor ( let k = 0; k < nd; ++ k ) {\r\n\r\n\t\t\tconst v = Aders[ k ].clone();\r\n\r\n\t\t\tfor ( let i = 1; i <= k; ++ i ) {\r\n\r\n\t\t\t\tv.sub( CK[ k - i ].clone().multiplyScalar( this.calcKoverI( k, i ) * wders[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tCK[ k ] = v.divideScalar( wders[ 0 ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn CK;\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate NURBS curve derivatives. See The NURBS Book, page 127, algorithm A4.2.\r\n\tp  : degree\r\n\tU  : knot vector\r\n\tP  : control points in homogeneous space\r\n\tu  : parametric points\r\n\tnd : number of derivatives\r\n\treturns array with derivatives.\r\n\t*/\r\n\tstatic calcNURBSDerivatives( p, U, P, u, nd ) {\r\n\r\n\t\tconst Pders = this.calcBSplineDerivatives( p, U, P, u, nd );\r\n\t\treturn this.calcRationalCurveDerivatives( Pders );\r\n\r\n\t}\r\n\r\n\r\n\t/*\r\n\tCalculate rational B-Spline surface point. See The NURBS Book, page 134, algorithm A4.3.\r\n\tp1, p2 : degrees of B-Spline surface\r\n\tU1, U2 : knot vectors\r\n\tP      : control points (x, y, z, w)\r\n\tu, v   : parametric values\r\n\treturns point for given (u, v)\r\n\t*/\r\n\tstatic calcSurfacePoint( p, q, U, V, P, u, v, target ) {\r\n\r\n\t\tconst uspan = this.findSpan( p, u, U );\r\n\t\tconst vspan = this.findSpan( q, v, V );\r\n\t\tconst Nu = this.calcBasisFunctions( uspan, u, p, U );\r\n\t\tconst Nv = this.calcBasisFunctions( vspan, v, q, V );\r\n\t\tconst temp = [];\r\n\r\n\t\tfor ( let l = 0; l <= q; ++ l ) {\r\n\r\n\t\t\ttemp[ l ] = new Vector4( 0, 0, 0, 0 );\r\n\t\t\tfor ( let k = 0; k <= p; ++ k ) {\r\n\r\n\t\t\t\tconst point = P[ uspan - p + k ][ vspan - q + l ].clone();\r\n\t\t\t\tconst w = point.w;\r\n\t\t\t\tpoint.x *= w;\r\n\t\t\t\tpoint.y *= w;\r\n\t\t\t\tpoint.z *= w;\r\n\t\t\t\ttemp[ l ].add( point.multiplyScalar( Nu[ k ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst Sw = new Vector4( 0, 0, 0, 0 );\r\n\t\tfor ( let l = 0; l <= q; ++ l ) {\r\n\r\n\t\t\tSw.add( temp[ l ].multiplyScalar( Nv[ l ] ) );\r\n\r\n\t\t}\r\n\r\n\t\tSw.divideScalar( Sw.w );\r\n\t\ttarget.set( Sw.x, Sw.y, Sw.z );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { NURBSUtils };","import {\r\n\tCurve,\r\n\tVector3,\r\n\tVector4\r\n} from 'three';\r\nimport { NURBSUtils } from './NURBSUtils.js';\r\n\r\n/**\r\n * NURBS curve object\r\n *\r\n * Derives from Curve, overriding getPoint and getTangent.\r\n *\r\n * Implementation is based on (x, y [, z=0 [, w=1]]) control points with w=weight.\r\n *\r\n **/\r\n\r\nclass NURBSCurve extends Curve {\r\n\r\n\tconstructor(\r\n\t\tdegree,\r\n\t\tknots /* array of reals */,\r\n\t\tcontrolPoints /* array of Vector(2|3|4) */,\r\n\t\tstartKnot /* index in knots */,\r\n\t\tendKnot /* index in knots */\r\n\t) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.degree = degree;\r\n\t\tthis.knots = knots;\r\n\t\tthis.controlPoints = [];\r\n\t\t// Used by periodic NURBS to remove hidden spans\r\n\t\tthis.startKnot = startKnot || 0;\r\n\t\tthis.endKnot = endKnot || ( this.knots.length - 1 );\r\n\r\n\t\tfor ( let i = 0; i < controlPoints.length; ++ i ) {\r\n\r\n\t\t\t// ensure Vector4 for control points\r\n\t\t\tconst point = controlPoints[ i ];\r\n\t\t\tthis.controlPoints[ i ] = new Vector4( point.x, point.y, point.z, point.w );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetPoint( t, optionalTarget = new Vector3() ) {\r\n\r\n\t\tconst point = optionalTarget;\r\n\r\n\t\tconst u = this.knots[ this.startKnot ] + t * ( this.knots[ this.endKnot ] - this.knots[ this.startKnot ] ); // linear mapping t->u\r\n\r\n\t\t// following results in (wx, wy, wz, w) homogeneous point\r\n\t\tconst hpoint = NURBSUtils.calcBSplinePoint( this.degree, this.knots, this.controlPoints, u );\r\n\r\n\t\tif ( hpoint.w !== 1.0 ) {\r\n\r\n\t\t\t// project to 3D space: (wx, wy, wz, w) -> (x, y, z, 1)\r\n\t\t\thpoint.divideScalar( hpoint.w );\r\n\r\n\t\t}\r\n\r\n\t\treturn point.set( hpoint.x, hpoint.y, hpoint.z );\r\n\r\n\t}\r\n\r\n\tgetTangent( t, optionalTarget = new Vector3() ) {\r\n\r\n\t\tconst tangent = optionalTarget;\r\n\r\n\t\tconst u = this.knots[ 0 ] + t * ( this.knots[ this.knots.length - 1 ] - this.knots[ 0 ] );\r\n\t\tconst ders = NURBSUtils.calcNURBSDerivatives( this.degree, this.knots, this.controlPoints, u, 1 );\r\n\t\ttangent.copy( ders[ 1 ] ).normalize();\r\n\r\n\t\treturn tangent;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { NURBSCurve };","import * as THREE from \"three\";\r\nimport { FBXLoader } from \"../three/loaders/FBXLoader\";\r\nimport { OrbitControls } from \"../three/controls/OrbitControls\";\r\n\r\nlet camera, scene, renderer;\r\nconst clock = new THREE.Clock();\r\nlet mixer;\r\n\r\nfunction onWindowResize() {\r\n    camera.aspect = window.innerWidth / window.innerHeight;\r\n    camera.updateProjectionMatrix();\r\n    renderer.setSize( window.innerWidth, window.innerHeight );\r\n\r\n}\r\nexport function init() {\r\n    let canvas = document.getElementById('renderer');\r\n    let w = window.innerWidth*0.8;\r\n    let h = window.innerHeight*0.8;\r\n    \r\n    camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );\r\n    camera.position.set( 100, 200, 300 );\r\n\r\n    scene = new THREE.Scene();\r\n    scene.background = new THREE.Color( 0xa0a0a0 );\r\n    scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 );\r\n\r\n    const hemiLight = new THREE.HemisphereLight( 0xffffff, 0x444444 );\r\n    hemiLight.position.set( 0, 200, 0 );\r\n    scene.add( hemiLight );\r\n\r\n    const dirLight = new THREE.DirectionalLight( 0xffffff );\r\n    dirLight.position.set( 0, 200, 100 );\r\n    dirLight.castShadow = true;\r\n    dirLight.shadow.camera.top = 180;\r\n    dirLight.shadow.camera.bottom = - 100;\r\n    dirLight.shadow.camera.left = - 120;\r\n    dirLight.shadow.camera.right = 120;\r\n    scene.add( dirLight );\r\n\r\n    // scene.add( new THREE.CameraHelper( dirLight.shadow.camera ) );\r\n\r\n    // ground\r\n    const mesh = new THREE.Mesh( new THREE.PlaneGeometry( 2000, 2000 ), new THREE.MeshPhongMaterial( { color: 0x999999, depthWrite: false } ) );\r\n    mesh.rotation.x = - Math.PI / 2;\r\n    mesh.receiveShadow = true;\r\n    scene.add( mesh );\r\n\r\n    const grid = new THREE.GridHelper( 2000, 20, 0x000000, 0x000000 );\r\n    grid.material.opacity = 0.2;\r\n    grid.material.transparent = true;\r\n    scene.add( grid );\r\n\r\n    // model\r\n    const loader = new FBXLoader();\r\n    loader.load( 'assets/fbx/SarborV2.fbx', function ( object ) {\r\n        mixer = new THREE.AnimationMixer( object );\r\n        object.animations.forEach((e) => {\r\n            console.log(e.name);\r\n        });\r\n        const action = mixer.clipAction( object.animations[object.animations.length - 1] );\r\n        action.play();\r\n        object.traverse( function ( child ) {\r\n            if ( child.isMesh ) {\r\n                child.castShadow = true;\r\n                child.receiveShadow = true;\r\n            }\r\n        } );\r\n        scene.add( object );\r\n    } );\r\n    renderer = new THREE.WebGLRenderer( { canvas: canvas, antialias: true } );\r\n    renderer.setPixelRatio( window.devicePixelRatio );\r\n    renderer.setSize( w, h );\r\n    renderer.shadowMap.enabled = true;\r\n    const controls = new OrbitControls( camera, renderer.domElement );\r\n    controls.target.set( 0, 100, 0 );\r\n    controls.update();\r\n    window.addEventListener( 'resize', onWindowResize );\r\n}\r\n\r\nexport function animate() {\r\n    requestAnimationFrame( animate );\r\n    const delta = clock.getDelta();\r\n    if ( mixer ) mixer.update( delta );\r\n    renderer.render( scene, camera );\r\n}","import {\r\n\tEventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tSpherical,\r\n\tTOUCH,\r\n\tVector2,\r\n\tVector3\r\n} from 'three';\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one-finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\r\n\r\nconst _changeEvent = { type: 'change' };\r\nconst _startEvent = { type: 'start' };\r\nconst _endEvent = { type: 'end' };\r\n\r\nclass OrbitControls extends EventDispatcher {\r\n\r\n\tconstructor( object, domElement ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\r\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\r\n\r\n\t\tthis.object = object;\r\n\t\tthis.domElement = domElement;\r\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\r\n\r\n\t\t// Set to false to disable this control\r\n\t\tthis.enabled = true;\r\n\r\n\t\t// \"target\" sets the location of focus, where the object orbits around\r\n\t\tthis.target = new Vector3();\r\n\r\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\t\tthis.minDistance = 0;\r\n\t\tthis.maxDistance = Infinity;\r\n\r\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\t\tthis.minZoom = 0;\r\n\t\tthis.maxZoom = Infinity;\r\n\r\n\t\t// How far you can orbit vertically, upper and lower limits.\r\n\t\t// Range is 0 to Math.PI radians.\r\n\t\tthis.minPolarAngle = 0; // radians\r\n\t\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t\t// How far you can orbit horizontally, upper and lower limits.\r\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\r\n\t\tthis.minAzimuthAngle = - Infinity; // radians\r\n\t\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t\t// Set to true to enable damping (inertia)\r\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.enableDamping = false;\r\n\t\tthis.dampingFactor = 0.05;\r\n\r\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t\t// Set to false to disable zooming\r\n\t\tthis.enableZoom = true;\r\n\t\tthis.zoomSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable rotating\r\n\t\tthis.enableRotate = true;\r\n\t\tthis.rotateSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable panning\r\n\t\tthis.enablePan = true;\r\n\t\tthis.panSpeed = 1.0;\r\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\r\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\r\n\r\n\t\t// Set to true to automatically rotate around the target\r\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.autoRotate = false;\r\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\r\n\r\n\t\t// The four arrow keys\r\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\r\n\r\n\t\t// Mouse buttons\r\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\r\n\r\n\t\t// Touch fingers\r\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\r\n\r\n\t\t// for reset\r\n\t\tthis.target0 = this.target.clone();\r\n\t\tthis.position0 = this.object.position.clone();\r\n\t\tthis.zoom0 = this.object.zoom;\r\n\r\n\t\t// the target DOM element for key events\r\n\t\tthis._domElementKeyEvents = null;\r\n\r\n\t\t//\r\n\t\t// public methods\r\n\t\t//\r\n\r\n\t\tthis.getPolarAngle = function () {\r\n\r\n\t\t\treturn spherical.phi;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getAzimuthalAngle = function () {\r\n\r\n\t\t\treturn spherical.theta;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getDistance = function () {\r\n\r\n\t\t\treturn this.object.position.distanceTo( this.target );\r\n\r\n\t\t};\r\n\r\n\t\tthis.listenToKeyEvents = function ( domElement ) {\r\n\r\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\r\n\t\t\tthis._domElementKeyEvents = domElement;\r\n\r\n\t\t};\r\n\r\n\t\tthis.saveState = function () {\r\n\r\n\t\t\tscope.target0.copy( scope.target );\r\n\t\t\tscope.position0.copy( scope.object.position );\r\n\t\t\tscope.zoom0 = scope.object.zoom;\r\n\r\n\t\t};\r\n\r\n\t\tthis.reset = function () {\r\n\r\n\t\t\tscope.target.copy( scope.target0 );\r\n\t\t\tscope.object.position.copy( scope.position0 );\r\n\t\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tscope.dispatchEvent( _changeEvent );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t};\r\n\r\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\t\tthis.update = function () {\r\n\r\n\t\t\tconst offset = new Vector3();\r\n\r\n\t\t\t// so camera.up is the orbit axis\r\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\r\n\t\t\tconst quatInverse = quat.clone().invert();\r\n\r\n\t\t\tconst lastPosition = new Vector3();\r\n\t\t\tconst lastQuaternion = new Quaternion();\r\n\r\n\t\t\tconst twoPI = 2 * Math.PI;\r\n\r\n\t\t\treturn function update() {\r\n\r\n\t\t\t\tconst position = scope.object.position;\r\n\r\n\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\r\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\t\toffset.applyQuaternion( quat );\r\n\r\n\t\t\t\t// angle from z-axis around y-axis\r\n\t\t\t\tspherical.setFromVector3( offset );\r\n\r\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\r\n\r\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( scope.enableDamping ) {\r\n\r\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\r\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// restrict theta to be between desired limits\r\n\r\n\t\t\t\tlet min = scope.minAzimuthAngle;\r\n\t\t\t\tlet max = scope.maxAzimuthAngle;\r\n\r\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\r\n\r\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\r\n\r\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\r\n\r\n\t\t\t\t\tif ( min <= max ) {\r\n\r\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\r\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\r\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// restrict phi to be between desired limits\r\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\r\n\r\n\t\t\t\tspherical.makeSafe();\r\n\r\n\r\n\t\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t\t// restrict radius to be between desired limits\r\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\r\n\r\n\t\t\t\t// move target to panned location\r\n\r\n\t\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tscope.target.add( panOffset );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\toffset.setFromSpherical( spherical );\r\n\r\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\t\toffset.applyQuaternion( quatInverse );\r\n\r\n\t\t\t\tposition.copy( scope.target ).add( offset );\r\n\r\n\t\t\t\tscope.object.lookAt( scope.target );\r\n\r\n\t\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\r\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\r\n\r\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscale = 1;\r\n\r\n\t\t\t\t// update condition is:\r\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\t\tif ( zoomChanged ||\r\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\r\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\r\n\r\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\tlastPosition.copy( scope.object.position );\r\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\r\n\t\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tthis.dispose = function () {\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\r\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\r\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\r\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\r\n\r\n\r\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\r\n\r\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// internals\r\n\t\t//\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tconst STATE = {\r\n\t\t\tNONE: - 1,\r\n\t\t\tROTATE: 0,\r\n\t\t\tDOLLY: 1,\r\n\t\t\tPAN: 2,\r\n\t\t\tTOUCH_ROTATE: 3,\r\n\t\t\tTOUCH_PAN: 4,\r\n\t\t\tTOUCH_DOLLY_PAN: 5,\r\n\t\t\tTOUCH_DOLLY_ROTATE: 6\r\n\t\t};\r\n\r\n\t\tlet state = STATE.NONE;\r\n\r\n\t\tconst EPS = 0.000001;\r\n\r\n\t\t// current position in spherical coordinates\r\n\t\tconst spherical = new Spherical();\r\n\t\tconst sphericalDelta = new Spherical();\r\n\r\n\t\tlet scale = 1;\r\n\t\tconst panOffset = new Vector3();\r\n\t\tlet zoomChanged = false;\r\n\r\n\t\tconst rotateStart = new Vector2();\r\n\t\tconst rotateEnd = new Vector2();\r\n\t\tconst rotateDelta = new Vector2();\r\n\r\n\t\tconst panStart = new Vector2();\r\n\t\tconst panEnd = new Vector2();\r\n\t\tconst panDelta = new Vector2();\r\n\r\n\t\tconst dollyStart = new Vector2();\r\n\t\tconst dollyEnd = new Vector2();\r\n\t\tconst dollyDelta = new Vector2();\r\n\r\n\t\tconst pointers = [];\r\n\t\tconst pointerPositions = {};\r\n\r\n\t\tfunction getAutoRotationAngle() {\r\n\r\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getZoomScale() {\r\n\r\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\r\n\r\n\t\t}\r\n\r\n\t\tfunction rotateLeft( angle ) {\r\n\r\n\t\t\tsphericalDelta.theta -= angle;\r\n\r\n\t\t}\r\n\r\n\t\tfunction rotateUp( angle ) {\r\n\r\n\t\t\tsphericalDelta.phi -= angle;\r\n\r\n\t\t}\r\n\r\n\t\tconst panLeft = function () {\r\n\r\n\t\t\tconst v = new Vector3();\r\n\r\n\t\t\treturn function panLeft( distance, objectMatrix ) {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\r\n\t\t\t\tv.multiplyScalar( - distance );\r\n\r\n\t\t\t\tpanOffset.add( v );\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tconst panUp = function () {\r\n\r\n\t\t\tconst v = new Vector3();\r\n\r\n\t\t\treturn function panUp( distance, objectMatrix ) {\r\n\r\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\r\n\r\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\r\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tv.multiplyScalar( distance );\r\n\r\n\t\t\t\tpanOffset.add( v );\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\t// deltaX and deltaY are in pixels; right and down are positive\r\n\t\tconst pan = function () {\r\n\r\n\t\t\tconst offset = new Vector3();\r\n\r\n\t\t\treturn function pan( deltaX, deltaY ) {\r\n\r\n\t\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t// perspective\r\n\t\t\t\t\tconst position = scope.object.position;\r\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\t\t\t\t\tlet targetDistance = offset.length();\r\n\r\n\t\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\r\n\r\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\r\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\r\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\t// orthographic\r\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\r\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\r\n\t\t\t\t\tscope.enablePan = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tfunction dollyOut( dollyScale ) {\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tscale /= dollyScale;\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\t\tscope.enableZoom = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction dollyIn( dollyScale ) {\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tscale *= dollyScale;\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\t\tscope.enableZoom = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// event callbacks - update the object state\r\n\t\t//\r\n\r\n\t\tfunction handleMouseDownRotate( event ) {\r\n\r\n\t\t\trotateStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseDownDolly( event ) {\r\n\r\n\t\t\tdollyStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseDownPan( event ) {\r\n\r\n\t\t\tpanStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMoveRotate( event ) {\r\n\r\n\t\t\trotateEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMoveDolly( event ) {\r\n\r\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMovePan( event ) {\r\n\r\n\t\t\tpanEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\t\tpanStart.copy( panEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseUp( /*event*/ ) {\r\n\r\n\t\t\t// no-op\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseWheel( event ) {\r\n\r\n\t\t\tif ( event.deltaY < 0 ) {\r\n\r\n\t\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t\t} else if ( event.deltaY > 0 ) {\r\n\r\n\t\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleKeyDown( event ) {\r\n\r\n\t\t\tlet needsUpdate = false;\r\n\r\n\t\t\tswitch ( event.code ) {\r\n\r\n\t\t\t\tcase scope.keys.UP:\r\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( needsUpdate ) {\r\n\r\n\t\t\t\t// prevent the browser from scrolling on cursor keys\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartRotate() {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\r\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\r\n\r\n\t\t\t\trotateStart.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartPan() {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\r\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\r\n\r\n\t\t\t\tpanStart.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDolly() {\r\n\r\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\r\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\r\n\r\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\tdollyStart.set( 0, distance );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDollyPan() {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\r\n\r\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDollyRotate() {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\r\n\r\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveRotate( event ) {\r\n\r\n\t\t\tif ( pointers.length == 1 ) {\r\n\r\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\r\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\r\n\r\n\t\t\t\trotateEnd.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMovePan( event ) {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\r\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\r\n\r\n\t\t\t\tpanEnd.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\t\tpanStart.copy( panEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDolly( event ) {\r\n\r\n\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\tconst dx = event.pageX - position.x;\r\n\t\t\tconst dy = event.pageY - position.y;\r\n\r\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\tdollyEnd.set( 0, distance );\r\n\r\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\r\n\r\n\t\t\tdollyOut( dollyDelta.y );\r\n\r\n\t\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDollyPan( event ) {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDollyRotate( event ) {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchEnd( /*event*/ ) {\r\n\r\n\t\t\t// no-op\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// event handlers - FSM: listen for events and reset state\r\n\t\t//\r\n\r\n\t\tfunction onPointerDown( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( pointers.length === 0 ) {\r\n\r\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\r\n\r\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\r\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\taddPointer( event );\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchStart( event );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseDown( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerMove( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchMove( event );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseMove( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerUp( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchEnd();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseUp( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tremovePointer( event );\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( pointers.length === 0 ) {\r\n\r\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\r\n\r\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\r\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerCancel( event ) {\r\n\r\n\t\t\tremovePointer( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseDown( event ) {\r\n\r\n\t\t\tlet mouseAction;\r\n\r\n\t\t\tswitch ( event.button ) {\r\n\r\n\t\t\t\tcase 0:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tmouseAction = - 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( mouseAction ) {\r\n\r\n\t\t\t\tcase MOUSE.DOLLY:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownDolly( event );\r\n\r\n\t\t\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MOUSE.ROTATE:\r\n\r\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MOUSE.PAN:\r\n\r\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tswitch ( state ) {\r\n\r\n\t\t\t\tcase STATE.ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMoveRotate( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.DOLLY:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMoveDolly( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.PAN:\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMovePan( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseUp( event ) {\r\n\r\n\t\t\thandleMouseUp( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseWheel( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\thandleMouseWheel( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onKeyDown( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\r\n\r\n\t\t\thandleKeyDown( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchStart( event ) {\r\n\r\n\t\t\ttrackPointer( event );\r\n\r\n\t\t\tswitch ( pointers.length ) {\r\n\r\n\t\t\t\tcase 1:\r\n\r\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\r\n\r\n\t\t\t\t\t\tcase TOUCH.ROTATE:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartRotate();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase TOUCH.PAN:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartPan();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\r\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\r\n\r\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchMove( event ) {\r\n\r\n\t\t\ttrackPointer( event );\r\n\r\n\t\t\tswitch ( state ) {\r\n\r\n\t\t\t\tcase STATE.TOUCH_ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveRotate( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_PAN:\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMovePan( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveDollyPan( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd( event ) {\r\n\r\n\t\t\thandleTouchEnd( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tfunction onContextMenu( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t}\r\n\r\n\t\tfunction addPointer( event ) {\r\n\r\n\t\t\tpointers.push( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction removePointer( event ) {\r\n\r\n\t\t\tdelete pointerPositions[ event.pointerId ];\r\n\r\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\r\n\r\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\r\n\r\n\t\t\t\t\tpointers.splice( i, 1 );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction trackPointer( event ) {\r\n\r\n\t\t\tlet position = pointerPositions[ event.pointerId ];\r\n\r\n\t\t\tif ( position === undefined ) {\r\n\r\n\t\t\t\tposition = new Vector2();\r\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tposition.set( event.pageX, event.pageY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction getSecondPointerPosition( event ) {\r\n\r\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\r\n\r\n\t\t\treturn pointerPositions[ pointer.pointerId ];\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\r\n\r\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\r\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\r\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\r\n\r\n\t\t// force an update at start\r\n\r\n\t\tthis.update();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n// This is very similar to OrbitControls, another set of touch behavior\r\n//\r\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - left mouse, or arrow keys / touch: one-finger move\r\n\r\nclass MapControls extends OrbitControls {\r\n\r\n\tconstructor( object, domElement ) {\r\n\r\n\t\tsuper( object, domElement );\r\n\r\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\r\n\r\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\r\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\r\n\r\n\t\tthis.touches.ONE = TOUCH.PAN;\r\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { OrbitControls, MapControls };","import React, { Component } from \"react\";\r\nimport styled from 'styled-components';\r\nimport tw from 'twin.macro';\r\nimport { init, animate } from \"../scenes/sabor\";\r\n\r\nconst Container = styled.div`\r\n    min-height: 300px;\r\n    ${tw`\r\n        flex\r\n        flex-col\r\n        w-full\r\n        h-full\r\n        items-center\r\n        overflow-x-hidden\r\n    `}\r\n`;\r\n\r\nconst Canvas = styled.canvas`\r\n    ${tw`\r\n        min-w-full\r\n        min-h-full\r\n    `}\r\n`;\r\n\r\nclass SaborSceneComponent extends Component {\r\n    componentDidMount() {\r\n      init();\r\n      animate();\r\n    }\r\n    render() {\r\n      return (\r\n        <Container>\r\n            <Canvas id='renderer'></Canvas>\r\n        </Container>\r\n      )\r\n    }\r\n  }\r\n  \r\n  export default function SaborScene() {\r\n    return <SaborSceneComponent />\r\n  }","import React from \"react\";\nimport './App.css';\nimport SaborScene from \"./components/saborScene\";\n\nexport default function App() {\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <SaborScene />\n        <p>\n          Site is under constructions. <br/>Create with <code>React.js</code> and <code>Three.js</code>\n        </p>\n      </header>\n    </div>\n  )\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}